!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const a=new Promise(async(e,t)=>{let n=await Glue({appManager:"full",layouts:"full"});window.glue=n,e(n)}),o=new rxjs.BehaviorSubject([]),i=new rxjs.BehaviorSubject([]),s=new rxjs.BehaviorSubject(null),l=new rxjs.BehaviorSubject(null),r=new rxjs.BehaviorSubject(null);window.glue42gd||(window.glue42gd={});window.glue42gd.user,window.glue42gd.version,window.glue42gd.gwURL;function c(){u(),glue.appManager.onAppAdded(u),glue.appManager.onAppRemoved(u),glue.appManager.onAppChanged(u),glue.appManager.onInstanceStarted(u),glue.appManager.onInstanceStopped(u)}function u(){o.next(glue.appManager.applications())}function p(){d(),glue.layouts.onAdded(d),glue.layouts.onRemoved(d),glue.layouts.onChanged(d),glue.layouts.onRenamed(d)}function d(){i.next(glue.layouts.list())}function m(){glue.agm.subscribe("T42.Notifications.Counter").then(e=>{e.onData(({data:e})=>{s.next(e.count)})})}function g(){glue.contexts.subscribe("Connect.Themes",e=>{console.log(e),l.next(e)})}function h(){glue.windows.my().onBoundsChanged(()=>{r.next(glue.windows.my().bounds)})}async function f(e){await a;let t=glue.appManager.application(e);if(!t)throw new Error(`Cannot find app with name "${e}"`);t.start()}a.then(e=>{c(),p(),m(),g(),h()});const v=new rxjs.BehaviorSubject([]);function w(){let e=v.value;document.querySelectorAll("#search-results>li").forEach(t=>{let n=t.getAttribute("app-name");e.includes(n)?t.classList.add("fav-app"):t.classList.remove("fav-app")})}!function(){null===localStorage.getItem("favorite-apps")&&localStorage.setItem("favorite-apps","[]");let e=JSON.parse(localStorage.getItem("favorite-apps"));v.next(e)}();let b;try{b=JSON.parse(localStorage.getItem("toolbar-settings"))}catch(e){b={}}let y=Object.assign({showHiddenApps:!1},b);function L(e,t){console.info("set setting",e,t),y[e]=t,localStorage.setItem("toolbar-settings",JSON.stringify(y))}function x(e){return y[e]}y.showHiddenApps=!1,y.showTutorial=!1!==y.showTutorial;const M=new rxjs.BehaviorSubject("");let{filter:j,map:E,distinctUntilChanged:S,combineLatest:A}=rxjs.operators;const k=o.pipe(j(e=>e.length>0)).pipe(S(void 0,e=>e.map(e=>e.title+e.instances.map(e=>e.id).join()).join()+JSON.stringify(y))).pipe(E(e=>e.filter(e=>function(e){let t=!0;x("showHiddenApps")||!e.hidden&&!e.autoStart||(t=!1);return t}(e)))).pipe(E(e=>e)).pipe(E(e=>e.sort(O))),T=k.pipe(A(M)).pipe(E(([e,t])=>{let n=t.toLowerCase().trim();return e.filter(e=>e.title.toLowerCase().indexOf(n)>=0)})),$=k.pipe(E(e=>e.filter(e=>e.instances.length>0)));function O(e,t){let n=e.userProperties.appManagerOrder,a=t.userProperties.appManagerOrder;return n&&!a?-1:!n&&a?1:n&&a&&n!==a?n-a:e.title.localeCompare(t.title)}function B(){q("#search-results").addEventListener("click",e=>{let t=e.path.reduce((e,t)=>t.getAttribute&&t.getAttribute("app-name")?t.getAttribute("app-name"):e,"");if(e.target.matches(".add-favorite, .add-favorite *")){v.value.includes(t)?function(e){console.log("removing favorite app");let t=v.value.slice();t=t.filter(t=>t!==e),v.next(t),localStorage.setItem("favorite-apps",JSON.stringify(t)),w()}(t):function(e){console.log("adding app to favorite ",e);let t=v.value.slice();t.push(e),v.next(t),localStorage.setItem("favorite-apps",JSON.stringify(t)),w()}(t)}else{if(f(t),e.ctrlKey)return;M.next(""),q("#app-search").value=""}})}function C(e,t={}){let{favoriteBtn:n}=t;return`\n    <li class="nav-item ${e.instances.length>0?"app-active":""}"" app-name="${e.name}">\n      <div class="nav-link action-menu">\n        ${H(e)}\n        ${e.instances.length>0?'\x3c!--<span class="icon-size-24 active-app text-success"><i class="icon-dot mr-2 "></i></span>--\x3e':""}\n        <span class="title-app">${e.title||e.name}</span>`+(n?'\n        <div class="action-menu-tool">\n          <button class="btn btn-icon secondary add-favorite">\n          <i class="icon-star-empty-1" draggable="false"></i>\n          <i class="icon-star-full" draggable="false"></i>\n          </button>\n        </div>':"")+"</div>\n    </li>"}function H(e={}){return e.icon?`<img src="${e.icon}" draggable="false" style="width:16px;"/>`:'<span class="icon-size-16">\n    <i class="icon-app" draggable="false"></i>\n  </span>'}let z,N=new rxjs.BehaviorSubject(!1),I=new rxjs.BehaviorSubject(!1),P=new rxjs.BehaviorSubject(!1),_=new rxjs.BehaviorSubject(!1);q(".layouts-nav").addEventListener("mouseenter",e=>{e.target.matches&&e.target.matches(".horizontal .layouts-nav, .horizontal .layouts-nav *")&&(z=setTimeout(()=>{D(),I.next(!0)},300))}),q(".layouts-nav").addEventListener("mouseleave",e=>{e.target.matches&&e.target.matches(".horizontal .layouts-nav, .horizontal .layouts-nav *")&&(I.next(!1),z&&clearInterval(z))});let R=new rxjs.BehaviorSubject({width:Math.round(q(".app").offsetWidth),height:Math.round(q(".app").offsetHeight),left:200,top:50});function D(){if(q(".has-drawer"))return;let e=_.value,t=P.value;return e&&!q(".view-port.horizontal")&&document.body.classList.add("open-left"),t&&q(".view-port.horizontal")&&document.body.classList.add("open-top"),e||document.body.classList.remove("open-left"),t||document.body.classList.remove("open-top"),new Promise((e,t)=>{setTimeout(()=>{e()})})}window.appBoundsObs=R,r.pipe(rxjs.operators.skip(1)).subscribe(e=>{console.log("bounds changed"),q(".view-port").classList.add("expand"),q(".app").classList.add("expand-wrapper")}),r.pipe(rxjs.operators.filter(e=>e)).pipe(rxjs.operators.combineLatest(R)).subscribe(([e,t])=>{const n=glue42gd.monitors,a=q(".view-port").getBoundingClientRect();let o={left:e.left+a.left,top:e.top+a.top,height:a.height,width:a.width},i=(s=o,n.map(e=>{const{left:t,top:n,workingAreaWidth:a,workingAreaHeight:o}=e;return{monitor:e,totalOverlap:function(e,t){const n=e.left,a=e.top,o=n+e.width,i=a+e.height,s=t.left,l=t.top,r=s+t.width,c=l+t.height,u=Math.max(0,Math.min(o,r)-Math.max(n,s)),p=Math.max(0,Math.min(i,c)-Math.max(a,l));return u*p}({left:t,top:n,width:a,height:o},s)}}).sort((e,t)=>t.totalOverlap-e.totalOverlap)[0].monitor);var s;if(i)if(q(".view-port").classList.contains("horizontal")){let e=o.top+o.height+300>i.workingAreaTop+i.workingAreaHeight;P.next(e),e&&_.next(!1)}else{let e=o.left+500>i.left+i.width;_.next(e),e&&P.next(!1)}}),R.pipe(rxjs.operators.combineLatest(N,I)).subscribe(([e,t,n])=>{!function(e,t,n){let o=[];if(e=q(".app").getBoundingClientRect(),o.push({top:Math.round(e.top),left:Math.round(e.left),width:Math.round(e.width),height:Math.round(e.height)}),q(".view-port.horizontal")&&t){let{top:e,left:t,width:n,height:a}=q("#menu-top").getBoundingClientRect();e=Math.round(e),t=Math.round(t),n=Math.round(n),a=Math.round(a),o.push({top:e,left:t,width:n,height:a})}if(n){let{top:e,left:t,width:n,height:a}=q(".layout-menu-tool").getBoundingClientRect();e=Math.round(e),t=Math.round(t),n=Math.round(n),a=Math.round(a),o.push({top:e,left:t,width:n,height:a})}!async function(e){await a,window.glue.agm.invoke("T42.Wnd.Execute",{command:"updateVisibleAreas",windowId:glue.windows.my().id,options:{areas:e}})}(o)}(e,t,n)});let J,W;function U(){q("#notification-panel").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),async function(){await a,glue.agm.invoke("T42.Notifications.Show")}()}),function(){J=!!q(".view-port.vertical"),q("#toggle .mode").innerHTML=J?"horizontal":"vertical",!1===x("vertical")&&a.then(()=>{q("#toggle").click()});q("#toggle").addEventListener("click",()=>{q(".app").classList.add("switching-orientation"),J=!J,L("vertical",J),q("#toggle .mode").innerHTML=J?"horizontal":"vertical",q(".view-port").classList.add(J?"vertical":"horizontal"),q(".view-port").classList.remove(J?"horizontal":"vertical"),q(".app").classList.add(J?"d-inline-flex":"h"),q(".app").classList.remove(J?"h":"d-inline-flex"),qa("[column]").forEach(e=>{J?e.classList.add("flex-column"):e.classList.remove("flex-column")}),J?document.body.classList.remove("open-top"):document.body.classList.remove("open-left"),setTimeout(()=>{q(".app").classList.remove("switching-orientation")})})}(),q(".theme-select").addEventListener("click",e=>{e.target.matches('input.select_input[type="radio"]')&&async function(e){glue.contexts.update("Connect.Themes",{selected:e})}(e.target.getAttribute("theme-name"))}),l.subscribe(e=>{if(e){e.all.forEach(e=>{q("html").classList.remove(e.name)}),q("html").classList.add(e.selected);let t="";e.all.forEach(n=>{t+=`<li class="select_option">\n          <input class="select_input" type="radio" name="theme" id="theme-${n.name}" theme-name="${n.name}" ${n.name===e.selected?"checked":""}/>\n          <label class="select_label" for="theme-${n.name}">${n.displayName}</label></li>`}),q(".theme-select .select_options").innerHTML=t}}),q(".gd-version").innerText=glue42gd.version,q(".gw-url").innerText=glue42gd.gwURL,q(".username").innerText=glue42gd.user,a.then(e=>{q(".glue-js-version").innerText=e.version}),function(){x("showTutorial")?q("#settings-content .show-tutorial").setAttribute("checked",!0):q("#settings-content .show-tutorial").removeAttribute("checked");q("#settings-content .show-tutorial").addEventListener("change",e=>L("showTutorial",e.srcElement.checked))}(),q("#shutdown").addEventListener("click",()=>{!async function(){await a,glue.appManager.exit()}()}),document.addEventListener("click",async e=>{if(e.target.matches('[menu-button-id="apps"], [menu-button-id="apps"] *')&&e.altKey)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),L("showHiddenApps",!x("showHiddenApps")),void async function(){await a,u()}();if(e.target.matches("[menu-button-id], [menu-button-id] *")){let n=e.path.find(e=>e.getAttribute("menu-button-id")).getAttribute("menu-button-id");qa(`[menu-id]:not([menu-id="${n}"])`).forEach(e=>{e.classList.add("hide")}),qa(`[menu-id]:not([menu-button-id="${n}"]) .chavron`).forEach(e=>{e.classList.remove("chavron-rotate")});let a=q(`[menu-id="${n}"]`);a.classList.contains("hide")&&await D(),a.addEventListener("transitionend",G),a.classList.toggle("hide"),t=n,qa(`[menu-button-id="${t}"] .chavron`).forEach(e=>e.classList.toggle("chavron-rotate")),qa(`[menu-button-id="${t}"] > a`).forEach(e=>e.classList.toggle("active")),qa(`[menu-button-id]:not([menu-button-id="${t}"]) .chavron`).forEach(e=>e.classList.remove("chavron-rotate")),qa(`[menu-button-id]:not([menu-button-id="${t}"]) > a`).forEach(e=>e.classList.remove("active")),q(".toggle-content:not(.hide)")?q(".app").classList.add("has-drawer"):q(".app").classList.remove("has-drawer")}else if(e.target.matches("#fav-apps .nav-item, #fav-apps .nav-item *")){let t=e.path.find(e=>e.classList&&e.classList.contains("nav-item")),n=t.getAttribute("app-name");t.classList.contains("app-active")?async function(e){await a,glue.appManager.application(e).instances.forEach(e=>e.activate())}(n):f(n)}var t}),document.addEventListener("click",e=>{if(e.target.matches(".close-drawer, .close-drawer *")){let t=e.path.find(e=>e&&e.getAttribute("menu-id")),n=t&&t.getAttribute("menu-id");n&&q(`[menu-button-id="${n}"]`).click()}}),async function(){let e;q("#fav-apps").addEventListener("mousewheel",e=>{q(".horizontal")&&(q("#fav-apps").scrollLeft+=Math.round(.8*e.deltaY),e.preventDefault())}),q(".app").addEventListener("mouseenter",async t=>{q(".view-port").classList.add("expand"),q(".app").classList.add("expand-wrapper"),e&&clearTimeout(e)}),q(".app").addEventListener("mouseleave",t=>{let{offsetWidth:n,offsetHeight:a}=q(".view-port");t.x<n+50&&t.x>50&&t.y<a+50-6&&t.y>50&&console.error("fake leave"),qa(".toggle-content:not(.hide)").length>0||qa(".dropdown-menu.show").length>0||(e=setTimeout(async()=>{await D(),q(".view-port").classList.remove("expand"),q(".app").classList.remove("expand-wrapper"),qa(".toggle-content").forEach(e=>e.classList.add("hide"))},500))})}(),document.addEventListener("click",e=>{e.target.matches('.modal [data-dismiss="modal"], .modal [data-dismiss="modal"] *')&&e.path.find(e=>e.classList.contains("modal")).classList.remove("show")})}function G(e){if(!e.propertyName||"width"!==e.propertyName)return;let t=e.srcElement;if(t.removeEventListener("transitionend",G),!t.classList.contains("hide")){let e=t.querySelector("input[autofocus]");e&&e.focus()}}function K(){q("#layout-load>ul").addEventListener("click",e=>{const t=e.path.find(e=>e.getAttribute&&e.getAttribute("layout-name"));if(!t)return;const n=t.getAttribute("layout-name"),o=t.getAttribute("layout-type");e.target.matches(".delete-layout, .delete-layout *")?(t.classList.add("show-actions"),t.classList.add("active")):e.target.matches(".layout-menu-tool, .layout-menu-tool *")?(e.target.matches(".layout-menu-tool .delete")&&async function(e,t){await a,glue.layouts.remove(e,t)}(o,n),t.classList.remove("show-actions"),t.classList.remove("active")):async function(e,t){await a,"Global"===e?glue.layouts.restore({name:t}):glue42gd.canvas.openWorkspace(t)}(o,n)})}function V(){var e;!async function(e){await a,glue.layouts.save({name:e})}((e=q("#layout-save-name").value,e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"))),q("#layout-save-name").value="",q("#layout-content").classList.add("hide"),q("#layout-load").classList.remove("hide")}!function(){let e=i.pipe(rxjs.operators.map(e=>e.map(e=>({name:e.name,type:e.type})).filter(e=>["Global","Swimlane"].includes(e.type))));const t=rxjs.fromEvent(q("#layout-search"),"keyup").pipe(rxjs.operators.map(e=>e.srcElement.value.toString().toLowerCase().trim())).pipe(rxjs.operators.distinctUntilChanged()).pipe(rxjs.operators.startWith(""));W=e.pipe(rxjs.operators.combineLatest(t)).pipe(rxjs.operators.map(([e,t])=>e.filter(e=>e.name.toLowerCase().includes(t))))}();document.addEventListener("DOMContentLoaded",()=>{console.log("window loaded"),T.subscribe(e=>{let t="";e.length>0?(e.forEach(e=>t+=C(e,{favoriteBtn:!0})),q("#search-results").innerHTML=t):q("#search-results").innerHTML='<li class="text-center pt-3">No applications</li>',w()}),$.subscribe(e=>{let t="";e.length>0?(e.forEach(e=>t+=C(e,{favoriteBtn:!1})),q("#running-apps").innerHTML=t):q("#running-apps").innerHTML='<li class="text-center pt-3">No running applications</li><li class="text-center pt-3"><button class="btn btn-secondary" menu-button-id="apps">Start application</button></li>'}),W.subscribe(e=>{let t="";e.length>0?(e.forEach(e=>t+=function(e){return`\n  <li class="nav-item" layout-name="${e.name}" layout-type="${e.type}">\n    <div class="nav-link action-menu">\n      <i class="icon-03-context-viewer ml-2 mr-4"></i>\n      <span>${e.name}${"Swimlane"===e.type?" (Swimlane)":""}</span>\n      <div class="action-menu-tool delete-layout">\n        <button class="btn btn-icon secondary" id="menu-tool-4">\n          <i class="icon-trash-empty"></i>\n        </button>\n      </div>\n    </div>\n    <div class="layout-menu-tool">\n      <div class="delete">Delete</div>\n      <div class="cancel">Cancel</div>\n    </div>\n  </li>\n\n  `}(e)),q("#layout-load>ul").innerHTML=t):q("#layout-load>ul").innerHTML='<li class="text-center w-100 pt-3">No Layouts Saved</li><li class="text-center w-100 pt-3"><button class="btn btn-secondary" menu-button-id="layout-save">Add Layouts</button></li>'}),v.pipe(rxjs.operators.combineLatest(k)).subscribe(([e,t])=>{let n="",a=e.filter(e=>t.find(t=>t.name===e));a.length>0?a.forEach(e=>{let a=t.find(t=>t.name===e);var o;a&&(n+=(o=a)?`\n  <li class="nav-item ${o.instances.length>0?"app-active":""}" app-name="${o.name}">\n    <a class="nav-link" href="#" draggable="false" title="${o.title}">\n      ${H(o)}\n      <span class="text-animation">${o.title}</span>\n    </a>\n  </li>\n  `:"")}):n='<li class="text-center pt-3">No favorite apps</li>',q("#fav-apps").innerHTML=n}),s.subscribe(e=>{null!==e&&(q("#notifications-count").innerHTML=e,0===e?q("#notifications-count").classList.add("empty"):q("#notifications-count").classList.remove("empty"))}),new ResizeObserver(e=>{R.next(!0)}).observe(q(".app")),B(),q("#app-search").addEventListener("keyup",e=>{M.next(e.target.value)}),K(),q("#layout-save-btn").addEventListener("click",V),q("#layout-save-name").addEventListener("keyup",e=>"Enter"===e.key?V():null),document.addEventListener("click",e=>{if(e.target.matches("[dropdown-button-id], [dropdown-button-id] *")){D();let t=e.path.find(e=>e.getAttribute("dropdown-button-id")).getAttribute("dropdown-button-id"),n=q(`[dropdown-id="${t}"]`);n.classList.toggle("show"),N.next(n.classList.contains("show"))}else qa("[dropdown-id].show").forEach(e=>e.classList.remove("show")),N.next(!1)}),U(),async function(){await a,glue.hotkeys.register("Ctrl+Alt+T",()=>{glue.windows.my().focus()})}()})}]);