{"version":3,"file":"workspaces.umd.min.js","sources":["../node_modules/callback-registry/lib/index.js","../node_modules/decoder-validate/dist/index.es5.js","../src/shared/decoders.ts","../src/communication/constants.ts","../src/controllers/enterprise.ts","../src/communication/bridge.ts","../src/shared/promisePlus.ts","../src/communication/interop-transport.ts","../src/builders/parentBuilder.ts","../src/builders/baseBuilder.ts","../src/builders/workspaceBuilder.ts","../src/models/row.ts","../src/models/column.ts","../src/models/group.ts","../src/models/workspace.ts","../src/models/window.ts","../src/models/frame.ts","../src/shared/privateDataManager.ts","../src/models/base/base.ts","../src/controllers/core.ts","../src/communication/core-frame-utils.ts","../src/controllers/base.ts","../src/shared/ioc.ts","../src/main.ts","../src/index.ts"],"sourcesContent":["\"use strict\";\r\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\n;\r\ncreateRegistry.default = createRegistry;\r\nmodule.exports = createRegistry;\r\n//# sourceMappingURL=index.js.map","/**\r\n * Wraps values in an `Ok` type.\r\n *\r\n * Example: `ok(5) // => {ok: true, result: 5}`\r\n */\r\nvar ok = function (result) { return ({ ok: true, result: result }); };\r\n/**\r\n * Typeguard for `Ok`.\r\n */\r\nvar isOk = function (r) { return r.ok === true; };\r\n/**\r\n * Wraps errors in an `Err` type.\r\n *\r\n * Example: `err('on fire') // => {ok: false, error: 'on fire'}`\r\n */\r\nvar err = function (error) { return ({ ok: false, error: error }); };\r\n/**\r\n * Typeguard for `Err`.\r\n */\r\nvar isErr = function (r) { return r.ok === false; };\r\n/**\r\n * Create a `Promise` that either resolves with the result of `Ok` or rejects\r\n * with the error of `Err`.\r\n */\r\nvar asPromise = function (r) {\r\n    return r.ok === true ? Promise.resolve(r.result) : Promise.reject(r.error);\r\n};\r\n/**\r\n * Unwraps a `Result` and returns either the result of an `Ok`, or\r\n * `defaultValue`.\r\n *\r\n * Example:\r\n * ```\r\n * Result.withDefault(5, number().run(json))\r\n * ```\r\n *\r\n * It would be nice if `Decoder` had an instance method that mirrored this\r\n * function. Such a method would look something like this:\r\n * ```\r\n * class Decoder<A> {\r\n *   runWithDefault = (defaultValue: A, json: any): A =>\r\n *     Result.withDefault(defaultValue, this.run(json));\r\n * }\r\n *\r\n * number().runWithDefault(5, json)\r\n * ```\r\n * Unfortunately, the type of `defaultValue: A` on the method causes issues\r\n * with type inference on  the `object` decoder in some situations. While these\r\n * inference issues can be solved by providing the optional type argument for\r\n * `object`s, the extra trouble and confusion doesn't seem worth it.\r\n */\r\nvar withDefault = function (defaultValue, r) {\r\n    return r.ok === true ? r.result : defaultValue;\r\n};\r\n/**\r\n * Return the successful result, or throw an error.\r\n */\r\nvar withException = function (r) {\r\n    if (r.ok === true) {\r\n        return r.result;\r\n    }\r\n    else {\r\n        throw r.error;\r\n    }\r\n};\r\n/**\r\n * Given an array of `Result`s, return the successful values.\r\n */\r\nvar successes = function (results) {\r\n    return results.reduce(function (acc, r) { return (r.ok === true ? acc.concat(r.result) : acc); }, []);\r\n};\r\n/**\r\n * Apply `f` to the result of an `Ok`, or pass the error through.\r\n */\r\nvar map = function (f, r) {\r\n    return r.ok === true ? ok(f(r.result)) : r;\r\n};\r\n/**\r\n * Apply `f` to the result of two `Ok`s, or pass an error through. If both\r\n * `Result`s are errors then the first one is returned.\r\n */\r\nvar map2 = function (f, ar, br) {\r\n    return ar.ok === false ? ar :\r\n        br.ok === false ? br :\r\n            ok(f(ar.result, br.result));\r\n};\r\n/**\r\n * Apply `f` to the error of an `Err`, or pass the success through.\r\n */\r\nvar mapError = function (f, r) {\r\n    return r.ok === true ? r : err(f(r.error));\r\n};\r\n/**\r\n * Chain together a sequence of computations that may fail, similar to a\r\n * `Promise`. If the first computation fails then the error will propagate\r\n * through. If it succeeds, then `f` will be applied to the value, returning a\r\n * new `Result`.\r\n */\r\nvar andThen = function (f, r) {\r\n    return r.ok === true ? f(r.result) : r;\r\n};\r\n\n\nvar result = Object.freeze({\n\tok: ok,\n\tisOk: isOk,\n\terr: err,\n\tisErr: isErr,\n\tasPromise: asPromise,\n\twithDefault: withDefault,\n\twithException: withException,\n\tsuccesses: successes,\n\tmap: map,\n\tmap2: map2,\n\tmapError: mapError,\n\tandThen: andThen\n});\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nfunction isEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a === null && b === null) {\r\n        return true;\r\n    }\r\n    if (typeof (a) !== typeof (b)) {\r\n        return false;\r\n    }\r\n    if (typeof (a) === 'object') {\r\n        // Array\r\n        if (Array.isArray(a)) {\r\n            if (!Array.isArray(b)) {\r\n                return false;\r\n            }\r\n            if (a.length !== b.length) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (!isEqual(a[i], b[i])) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        // Hash table\r\n        var keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!b.hasOwnProperty(keys[i])) {\r\n                return false;\r\n            }\r\n            if (!isEqual(a[keys[i]], b[keys[i]])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n/**\r\n * Type guard for `DecoderError`. One use case of the type guard is in the\r\n * `catch` of a promise. Typescript types the error argument of `catch` as\r\n * `any`, so when dealing with a decoder as a promise you may need to\r\n * distinguish between a `DecoderError` and an error string.\r\n */\r\nvar isDecoderError = function (a) {\r\n    return a.kind === 'DecoderError' && typeof a.at === 'string' && typeof a.message === 'string';\r\n};\r\n/*\r\n * Helpers\r\n */\r\nvar isJsonArray = function (json) { return Array.isArray(json); };\r\nvar isJsonObject = function (json) {\r\n    return typeof json === 'object' && json !== null && !isJsonArray(json);\r\n};\r\nvar typeString = function (json) {\r\n    switch (typeof json) {\r\n        case 'string':\r\n            return 'a string';\r\n        case 'number':\r\n            return 'a number';\r\n        case 'boolean':\r\n            return 'a boolean';\r\n        case 'undefined':\r\n            return 'undefined';\r\n        case 'object':\r\n            if (json instanceof Array) {\r\n                return 'an array';\r\n            }\r\n            else if (json === null) {\r\n                return 'null';\r\n            }\r\n            else {\r\n                return 'an object';\r\n            }\r\n        default:\r\n            return JSON.stringify(json);\r\n    }\r\n};\r\nvar expectedGot = function (expected, got) {\r\n    return \"expected \" + expected + \", got \" + typeString(got);\r\n};\r\nvar printPath = function (paths) {\r\n    return paths.map(function (path) { return (typeof path === 'string' ? \".\" + path : \"[\" + path + \"]\"); }).join('');\r\n};\r\nvar prependAt = function (newAt, _a) {\r\n    var at = _a.at, rest = __rest(_a, [\"at\"]);\r\n    return (__assign({ at: newAt + (at || '') }, rest));\r\n};\r\n/**\r\n * Decoders transform json objects with unknown structure into known and\r\n * verified forms. You can create objects of type `Decoder<A>` with either the\r\n * primitive decoder functions, such as `boolean()` and `string()`, or by\r\n * applying higher-order decoders to the primitives, such as `array(boolean())`\r\n * or `dict(string())`.\r\n *\r\n * Each of the decoder functions are available both as a static method on\r\n * `Decoder` and as a function alias -- for example the string decoder is\r\n * defined at `Decoder.string()`, but is also aliased to `string()`. Using the\r\n * function aliases exported with the library is recommended.\r\n *\r\n * `Decoder` exposes a number of 'run' methods, which all decode json in the\r\n * same way, but communicate success and failure in different ways. The `map`\r\n * and `andThen` methods modify decoders without having to call a 'run' method.\r\n *\r\n * Alternatively, the main decoder `run()` method returns an object of type\r\n * `Result<A, DecoderError>`. This library provides a number of helper\r\n * functions for dealing with the `Result` type, so you can do all the same\r\n * things with a `Result` as with the decoder methods.\r\n */\r\nvar Decoder = /** @class */ (function () {\r\n    /**\r\n     * The Decoder class constructor is kept private to separate the internal\r\n     * `decode` function from the external `run` function. The distinction\r\n     * between the two functions is that `decode` returns a\r\n     * `Partial<DecoderError>` on failure, which contains an unfinished error\r\n     * report. When `run` is called on a decoder, the relevant series of `decode`\r\n     * calls is made, and then on failure the resulting `Partial<DecoderError>`\r\n     * is turned into a `DecoderError` by filling in the missing information.\r\n     *\r\n     * While hiding the constructor may seem restrictive, leveraging the\r\n     * provided decoder combinators and helper functions such as\r\n     * `andThen` and `map` should be enough to build specialized decoders as\r\n     * needed.\r\n     */\r\n    function Decoder(decode) {\r\n        var _this = this;\r\n        this.decode = decode;\r\n        /**\r\n         * Run the decoder and return a `Result` with either the decoded value or a\r\n         * `DecoderError` containing the json input, the location of the error, and\r\n         * the error message.\r\n         *\r\n         * Examples:\r\n         * ```\r\n         * number().run(12)\r\n         * // => {ok: true, result: 12}\r\n         *\r\n         * string().run(9001)\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {\r\n         * //     kind: 'DecoderError',\r\n         * //     input: 9001,\r\n         * //     at: 'input',\r\n         * //     message: 'expected a string, got 9001'\r\n         * //   }\r\n         * // }\r\n         * ```\r\n         */\r\n        this.run = function (json) {\r\n            return mapError(function (error) { return ({\r\n                kind: 'DecoderError',\r\n                input: json,\r\n                at: 'input' + (error.at || ''),\r\n                message: error.message || ''\r\n            }); }, _this.decode(json));\r\n        };\r\n        /**\r\n         * Run the decoder as a `Promise`.\r\n         */\r\n        this.runPromise = function (json) { return asPromise(_this.run(json)); };\r\n        /**\r\n         * Run the decoder and return the value on success, or throw an exception\r\n         * with a formatted error string.\r\n         */\r\n        this.runWithException = function (json) { return withException(_this.run(json)); };\r\n        /**\r\n         * Construct a new decoder that applies a transformation to the decoded\r\n         * result. If the decoder succeeds then `f` will be applied to the value. If\r\n         * it fails the error will propagated through.\r\n         *\r\n         * Example:\r\n         * ```\r\n         * number().map(x => x * 5).run(10)\r\n         * // => {ok: true, result: 50}\r\n         * ```\r\n         */\r\n        this.map = function (f) {\r\n            return new Decoder(function (json) { return map(f, _this.decode(json)); });\r\n        };\r\n        /**\r\n         * Chain together a sequence of decoders. The first decoder will run, and\r\n         * then the function will determine what decoder to run second. If the result\r\n         * of the first decoder succeeds then `f` will be applied to the decoded\r\n         * value. If it fails the error will propagate through.\r\n         *\r\n         * This is a very powerful method -- it can act as both the `map` and `where`\r\n         * methods, can improve error messages for edge cases, and can be used to\r\n         * make a decoder for custom types.\r\n         *\r\n         * Example of adding an error message:\r\n         * ```\r\n         * const versionDecoder = valueAt(['version'], number());\r\n         * const infoDecoder3 = object({a: boolean()});\r\n         *\r\n         * const decoder = versionDecoder.andThen(version => {\r\n         *   switch (version) {\r\n         *     case 3:\r\n         *       return infoDecoder3;\r\n         *     default:\r\n         *       return fail(`Unable to decode info, version ${version} is not supported.`);\r\n         *   }\r\n         * });\r\n         *\r\n         * decoder.run({version: 3, a: true})\r\n         * // => {ok: true, result: {a: true}}\r\n         *\r\n         * decoder.run({version: 5, x: 'abc'})\r\n         * // =>\r\n         * // {\r\n         * //   ok: false,\r\n         * //   error: {... message: 'Unable to decode info, version 5 is not supported.'}\r\n         * // }\r\n         * ```\r\n         *\r\n         * Example of decoding a custom type:\r\n         * ```\r\n         * // nominal type for arrays with a length of at least one\r\n         * type NonEmptyArray<T> = T[] & { __nonEmptyArrayBrand__: void };\r\n         *\r\n         * const nonEmptyArrayDecoder = <T>(values: Decoder<T>): Decoder<NonEmptyArray<T>> =>\r\n         *   array(values).andThen(arr =>\r\n         *     arr.length > 0\r\n         *       ? succeed(createNonEmptyArray(arr))\r\n         *       : fail(`expected a non-empty array, got an empty array`)\r\n         *   );\r\n         * ```\r\n         */\r\n        this.andThen = function (f) {\r\n            return new Decoder(function (json) {\r\n                return andThen(function (value) { return f(value).decode(json); }, _this.decode(json));\r\n            });\r\n        };\r\n        /**\r\n         * Add constraints to a decoder _without_ changing the resulting type. The\r\n         * `test` argument is a predicate function which returns true for valid\r\n         * inputs. When `test` fails on an input, the decoder fails with the given\r\n         * `errorMessage`.\r\n         *\r\n         * ```\r\n         * const chars = (length: number): Decoder<string> =>\r\n         *   string().where(\r\n         *     (s: string) => s.length === length,\r\n         *     `expected a string of length ${length}`\r\n         *   );\r\n         *\r\n         * chars(5).run('12345')\r\n         * // => {ok: true, result: '12345'}\r\n         *\r\n         * chars(2).run('HELLO')\r\n         * // => {ok: false, error: {... message: 'expected a string of length 2'}}\r\n         *\r\n         * chars(12).run(true)\r\n         * // => {ok: false, error: {... message: 'expected a string, got a boolean'}}\r\n         * ```\r\n         */\r\n        this.where = function (test, errorMessage) {\r\n            return _this.andThen(function (value) { return (test(value) ? Decoder.succeed(value) : Decoder.fail(errorMessage)); });\r\n        };\r\n    }\r\n    /**\r\n     * Decoder primitive that validates strings, and fails on all other input.\r\n     */\r\n    Decoder.string = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'string'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a string', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates numbers, and fails on all other input.\r\n     */\r\n    Decoder.number = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'number'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a number', json) });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder primitive that validates booleans, and fails on all other input.\r\n     */\r\n    Decoder.boolean = function () {\r\n        return new Decoder(function (json) {\r\n            return typeof json === 'boolean'\r\n                ? ok(json)\r\n                : err({ message: expectedGot('a boolean', json) });\r\n        });\r\n    };\r\n    Decoder.constant = function (value) {\r\n        return new Decoder(function (json) {\r\n            return isEqual(json, value)\r\n                ? ok(value)\r\n                : err({ message: \"expected \" + JSON.stringify(value) + \", got \" + JSON.stringify(json) });\r\n        });\r\n    };\r\n    Decoder.object = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json) && decoders) {\r\n                var obj = {};\r\n                for (var key in decoders) {\r\n                    if (decoders.hasOwnProperty(key)) {\r\n                        var r = decoders[key].decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            // tslint:disable-next-line:strict-type-predicates\r\n                            if (r.result !== undefined) {\r\n                                obj[key] = r.result;\r\n                            }\r\n                        }\r\n                        else if (json[key] === undefined) {\r\n                            return err({ message: \"the key '\" + key + \"' is required but was not present\" });\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else if (isJsonObject(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.array = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json) && decoder) {\r\n                var decodeValue_1 = function (v, i) {\r\n                    return mapError(function (err$$1) { return prependAt(\"[\" + i + \"]\", err$$1); }, decoder.decode(v));\r\n                };\r\n                return json.reduce(function (acc, v, i) {\r\n                    return map2(function (arr, result) { return arr.concat([result]); }, acc, decodeValue_1(v, i));\r\n                }, ok([]));\r\n            }\r\n            else if (isJsonArray(json)) {\r\n                return ok(json);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an array', json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.tuple = function (decoders) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonArray(json)) {\r\n                if (json.length !== decoders.length) {\r\n                    return err({\r\n                        message: \"expected a tuple of length \" + decoders.length + \", got one of length \" + json.length\r\n                    });\r\n                }\r\n                var result = [];\r\n                for (var i = 0; i < decoders.length; i++) {\r\n                    var nth = decoders[i].decode(json[i]);\r\n                    if (nth.ok) {\r\n                        result[i] = nth.result;\r\n                    }\r\n                    else {\r\n                        return err(prependAt(\"[\" + i + \"]\", nth.error));\r\n                    }\r\n                }\r\n                return ok(result);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot(\"a tuple of length \" + decoders.length, json) });\r\n            }\r\n        });\r\n    };\r\n    Decoder.union = function (ad, bd) {\r\n        var decoders = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            decoders[_i - 2] = arguments[_i];\r\n        }\r\n        return Decoder.oneOf.apply(Decoder, [ad, bd].concat(decoders));\r\n    };\r\n    Decoder.intersection = function (ad, bd) {\r\n        var ds = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            ds[_i - 2] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            return [ad, bd].concat(ds).reduce(function (acc, decoder) { return map2(Object.assign, acc, decoder.decode(json)); }, ok({}));\r\n        });\r\n    };\r\n    /**\r\n     * Escape hatch to bypass validation. Always succeeds and types the result as\r\n     * `any`. Useful for defining decoders incrementally, particularly for\r\n     * complex objects.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   name: string;\r\n     *   complexUserData: ComplexType;\r\n     * }\r\n     *\r\n     * const userDecoder: Decoder<User> = object({\r\n     *   name: string(),\r\n     *   complexUserData: anyJson()\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.anyJson = function () { return new Decoder(function (json) { return ok(json); }); };\r\n    /**\r\n     * Decoder identity function which always succeeds and types the result as\r\n     * `unknown`.\r\n     */\r\n    Decoder.unknownJson = function () {\r\n        return new Decoder(function (json) { return ok(json); });\r\n    };\r\n    /**\r\n     * Decoder for json objects where the keys are unknown strings, but the values\r\n     * should all be of the same type.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * dict(number()).run({chocolate: 12, vanilla: 10, mint: 37});\r\n     * // => {ok: true, result: {chocolate: 12, vanilla: 10, mint: 37}}\r\n     * ```\r\n     */\r\n    Decoder.dict = function (decoder) {\r\n        return new Decoder(function (json) {\r\n            if (isJsonObject(json)) {\r\n                var obj = {};\r\n                for (var key in json) {\r\n                    if (json.hasOwnProperty(key)) {\r\n                        var r = decoder.decode(json[key]);\r\n                        if (r.ok === true) {\r\n                            obj[key] = r.result;\r\n                        }\r\n                        else {\r\n                            return err(prependAt(\".\" + key, r.error));\r\n                        }\r\n                    }\r\n                }\r\n                return ok(obj);\r\n            }\r\n            else {\r\n                return err({ message: expectedGot('an object', json) });\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Decoder for values that may be `undefined`. This is primarily helpful for\r\n     * decoding interfaces with optional fields.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface User {\r\n     *   id: number;\r\n     *   isOwner?: boolean;\r\n     * }\r\n     *\r\n     * const decoder: Decoder<User> = object({\r\n     *   id: number(),\r\n     *   isOwner: optional(boolean())\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.optional = function (decoder) {\r\n        return new Decoder(function (json) { return (json === undefined ? ok(undefined) : decoder.decode(json)); });\r\n    };\r\n    /**\r\n     * Decoder that attempts to run each decoder in `decoders` and either succeeds\r\n     * with the first successful decoder, or fails after all decoders have failed.\r\n     *\r\n     * Note that `oneOf` expects the decoders to all have the same return type,\r\n     * while `union` creates a decoder for the union type of all the input\r\n     * decoders.\r\n     *\r\n     * Examples:\r\n     * ```\r\n     * oneOf(string(), number().map(String))\r\n     * oneOf(constant('start'), constant('stop'), succeed('unknown'))\r\n     * ```\r\n     */\r\n    Decoder.oneOf = function () {\r\n        var decoders = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            decoders[_i] = arguments[_i];\r\n        }\r\n        return new Decoder(function (json) {\r\n            var errors = [];\r\n            for (var i = 0; i < decoders.length; i++) {\r\n                var r = decoders[i].decode(json);\r\n                if (r.ok === true) {\r\n                    return r;\r\n                }\r\n                else {\r\n                    errors[i] = r.error;\r\n                }\r\n            }\r\n            var errorsList = errors\r\n                .map(function (error) { return \"at error\" + (error.at || '') + \": \" + error.message; })\r\n                .join('\", \"');\r\n            return err({\r\n                message: \"expected a value matching one of the decoders, got the errors [\\\"\" + errorsList + \"\\\"]\"\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that always succeeds with either the decoded value, or a fallback\r\n     * default value.\r\n     */\r\n    Decoder.withDefault = function (defaultValue, decoder) {\r\n        return new Decoder(function (json) {\r\n            return ok(withDefault(defaultValue, decoder.decode(json)));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that pulls a specific field out of a json structure, instead of\r\n     * decoding and returning the full structure. The `paths` array describes the\r\n     * object keys and array indices to traverse, so that values can be pulled out\r\n     * of a nested structure.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * const decoder = valueAt(['a', 'b', 0], string());\r\n     *\r\n     * decoder.run({a: {b: ['surprise!']}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * decoder.run({a: {x: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b[0]' message: 'path does not exist'}}\r\n     * ```\r\n     *\r\n     * Note that the `decoder` is ran on the value found at the last key in the\r\n     * path, even if the last key is not found. This allows the `optional`\r\n     * decoder to succeed when appropriate.\r\n     * ```\r\n     * const optionalDecoder = valueAt(['a', 'b', 'c'], optional(string()));\r\n     *\r\n     * optionalDecoder.run({a: {b: {c: 'surprise!'}}})\r\n     * // => {ok: true, result: 'surprise!'}\r\n     *\r\n     * optionalDecoder.run({a: {b: 'cats'}})\r\n     * // => {ok: false, error: {... at: 'input.a.b.c' message: 'expected an object, got \"cats\"'}\r\n     *\r\n     * optionalDecoder.run({a: {b: {z: 1}}})\r\n     * // => {ok: true, result: undefined}\r\n     * ```\r\n     */\r\n    Decoder.valueAt = function (paths, decoder) {\r\n        return new Decoder(function (json) {\r\n            var jsonAtPath = json;\r\n            for (var i = 0; i < paths.length; i++) {\r\n                if (jsonAtPath === undefined) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: 'path does not exist'\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'string' && !isJsonObject(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an object', jsonAtPath)\r\n                    });\r\n                }\r\n                else if (typeof paths[i] === 'number' && !isJsonArray(jsonAtPath)) {\r\n                    return err({\r\n                        at: printPath(paths.slice(0, i + 1)),\r\n                        message: expectedGot('an array', jsonAtPath)\r\n                    });\r\n                }\r\n                else {\r\n                    jsonAtPath = jsonAtPath[paths[i]];\r\n                }\r\n            }\r\n            return mapError(function (error) {\r\n                return jsonAtPath === undefined\r\n                    ? { at: printPath(paths), message: 'path does not exist' }\r\n                    : prependAt(printPath(paths), error);\r\n            }, decoder.decode(jsonAtPath));\r\n        });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always succeeds with `fixedValue`.\r\n     */\r\n    Decoder.succeed = function (fixedValue) {\r\n        return new Decoder(function (json) { return ok(fixedValue); });\r\n    };\r\n    /**\r\n     * Decoder that ignores the input json and always fails with `errorMessage`.\r\n     */\r\n    Decoder.fail = function (errorMessage) {\r\n        return new Decoder(function (json) { return err({ message: errorMessage }); });\r\n    };\r\n    /**\r\n     * Decoder that allows for validating recursive data structures. Unlike with\r\n     * functions, decoders assigned to variables can't reference themselves\r\n     * before they are fully defined. We can avoid prematurely referencing the\r\n     * decoder by wrapping it in a function that won't be called until use, at\r\n     * which point the decoder has been defined.\r\n     *\r\n     * Example:\r\n     * ```\r\n     * interface Comment {\r\n     *   msg: string;\r\n     *   replies: Comment[];\r\n     * }\r\n     *\r\n     * const decoder: Decoder<Comment> = object({\r\n     *   msg: string(),\r\n     *   replies: lazy(() => array(decoder))\r\n     * });\r\n     * ```\r\n     */\r\n    Decoder.lazy = function (mkDecoder) {\r\n        return new Decoder(function (json) { return mkDecoder().decode(json); });\r\n    };\r\n    return Decoder;\r\n}());\n\n/* tslint:disable:variable-name */\r\n/** See `Decoder.string` */\r\nvar string = Decoder.string;\r\n/** See `Decoder.number` */\r\nvar number = Decoder.number;\r\n/** See `Decoder.boolean` */\r\nvar boolean = Decoder.boolean;\r\n/** See `Decoder.anyJson` */\r\nvar anyJson = Decoder.anyJson;\r\n/** See `Decoder.unknownJson` */\r\nvar unknownJson = Decoder.unknownJson;\r\n/** See `Decoder.constant` */\r\nvar constant = Decoder.constant;\r\n/** See `Decoder.object` */\r\nvar object = Decoder.object;\r\n/** See `Decoder.array` */\r\nvar array = Decoder.array;\r\n/** See `Decoder.tuple` */\r\nvar tuple = Decoder.tuple;\r\n/** See `Decoder.dict` */\r\nvar dict = Decoder.dict;\r\n/** See `Decoder.optional` */\r\nvar optional = Decoder.optional;\r\n/** See `Decoder.oneOf` */\r\nvar oneOf = Decoder.oneOf;\r\n/** See `Decoder.union` */\r\nvar union = Decoder.union;\r\n/** See `Decoder.intersection` */\r\nvar intersection = Decoder.intersection;\r\n/** See `Decoder.withDefault` */\r\nvar withDefault$1 = Decoder.withDefault;\r\n/** See `Decoder.valueAt` */\r\nvar valueAt = Decoder.valueAt;\r\n/** See `Decoder.succeed` */\r\nvar succeed = Decoder.succeed;\r\n/** See `Decoder.fail` */\r\nvar fail = Decoder.fail;\r\n/** See `Decoder.lazy` */\r\nvar lazy = Decoder.lazy;\n\nexport { result as Result, Decoder, isDecoderError, string, number, boolean, anyJson, unknownJson, constant, object, array, tuple, dict, optional, oneOf, union, intersection, withDefault$1 as withDefault, valueAt, succeed, fail, lazy };\n//# sourceMappingURL=index.es5.js.map\n","/* eslint-disable @typescript-eslint/no-use-before-define */\r\nimport { Decoder, object, boolean, string, optional, array, oneOf, constant, lazy, number, anyJson, intersection } from \"decoder-validate\";\r\nimport { IsWindowInSwimlaneResult, WorkspaceSnapshotResult, ChildSnapshotResult, WorkspaceConfigResult, FrameSummaryResult, WorkspaceCreateConfigProtocol, GetFrameSummaryConfig, WorkspaceSummaryResult, LayoutSummariesResult, LayoutSummary, OpenWorkspaceConfig, FrameSummariesResult, WorkspaceSummariesResult, ExportedLayoutsResult, DeleteLayoutConfig, SimpleItemConfig, ResizeItemConfig, MoveFrameConfig, FrameSnapshotResult, BaseChildSnapshotConfig, ParentSnapshotConfig, SwimlaneWindowSnapshotConfig, SimpleWindowOperationSuccessResult, SetItemTitleConfig, MoveWindowConfig, AddWindowConfig, AddContainerConfig, AddItemResult, BundleConfig, WorkspaceStreamData, FrameStreamData, ContainerStreamData, ContainerSummaryResult, WindowStreamData, PingResult, FrameStateConfig, FrameStateResult } from \"../types/protocol\";\r\nimport { WorkspaceEventType, WorkspaceEventAction } from \"../types/subscription\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\n\r\nexport const nonEmptyStringDecoder: Decoder<string> = string().where((s) => s.length > 0, \"Expected a non-empty string\");\r\nexport const nonNegativeNumberDecoder: Decoder<number> = number().where((num) => num >= 0, \"Expected a non-negative number\");\r\n\r\nexport const isWindowInSwimlaneResultDecoder: Decoder<IsWindowInSwimlaneResult> = object({\r\n    inWorkspace: boolean()\r\n});\r\n\r\nexport const allParentDecoder: Decoder<\"workspace\" | \"row\" | \"column\" | \"group\"> = oneOf<\"workspace\" | \"row\" | \"column\" | \"group\">(\r\n    constant(\"workspace\"),\r\n    constant(\"row\"),\r\n    constant(\"column\"),\r\n    constant(\"group\")\r\n);\r\n\r\nexport const subParentDecoder: Decoder<\"row\" | \"column\" | \"group\"> = oneOf<\"row\" | \"column\" | \"group\">(\r\n    constant(\"row\"),\r\n    constant(\"column\"),\r\n    constant(\"group\")\r\n);\r\n\r\nexport const frameStateDecoder: Decoder<\"maximized\" | \"minimized\" | \"normal\"> = oneOf<\"maximized\" | \"minimized\" | \"normal\">(\r\n    constant(\"maximized\"),\r\n    constant(\"minimized\"),\r\n    constant(\"normal\")\r\n);\r\n\r\nexport const checkThrowCallback = (callback: unknown, allowUndefined?: boolean): void => {\r\n    const argumentType = typeof callback;\r\n\r\n    if (allowUndefined && argumentType !== \"function\" && argumentType !== \"undefined\") {\r\n        throw new Error(`Provided argument must be either undefined or of type function, provided: ${argumentType}`);\r\n    }\r\n\r\n    if (!allowUndefined && argumentType !== \"function\") {\r\n        throw new Error(`Provided argument must be of type function, provided: ${argumentType}`);\r\n    }\r\n};\r\n\r\nexport const workspaceBuilderCreateConfigDecoder: Decoder<Glue42Workspaces.WorkspaceCreateConfig> = optional(object({\r\n    saveLayout: optional(boolean())\r\n}));\r\n\r\nexport const deleteLayoutConfigDecoder: Decoder<DeleteLayoutConfig> = object({\r\n    name: nonEmptyStringDecoder\r\n});\r\n\r\n\r\nexport const swimlaneWindowDefinitionDecoder: Decoder<Glue42Workspaces.WorkspaceWindowDefinition> = object({\r\n    type: optional(constant(\"window\")),\r\n    appName: optional(nonEmptyStringDecoder),\r\n    windowId: optional(nonEmptyStringDecoder),\r\n    context: optional(anyJson())\r\n});\r\n\r\nexport const strictSwimlaneWindowDefinitionDecoder: Decoder<Glue42Workspaces.WorkspaceWindowDefinition> = object({\r\n    type: constant(\"window\"),\r\n    appName: optional(nonEmptyStringDecoder),\r\n    windowId: optional(nonEmptyStringDecoder),\r\n    context: optional(anyJson())\r\n});\r\n\r\nexport const parentDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = optional(object({\r\n    type: optional(subParentDecoder),\r\n    children: optional(\r\n        lazy(() => array(\r\n            oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n                swimlaneWindowDefinitionDecoder,\r\n                parentDefinitionDecoder\r\n            )\r\n        ))\r\n    )\r\n}));\r\n\r\nexport const strictParentDefinitionDecoder: Decoder<Glue42Workspaces.BoxDefinition> = object({\r\n    type: subParentDecoder,\r\n    children: optional(\r\n        lazy(() => array(\r\n            oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n                strictSwimlaneWindowDefinitionDecoder,\r\n                strictParentDefinitionDecoder\r\n            )\r\n        ))\r\n    )\r\n});\r\n\r\nexport const stateDecoder: Decoder<\"maximized\" | \"normal\"> = oneOf<\"maximized\" | \"normal\">(\r\n    (string().where((s) => s.toLowerCase() === \"maximized\", \"Expected a case insensitive variation of 'maximized'\") as Decoder<\"maximized\">),\r\n    (string().where((s) => s.toLowerCase() === \"normal\", \"Expected a case insensitive variation of 'normal'\") as Decoder<\"normal\">)\r\n);\r\n\r\nexport const newFrameConfigDecoder: Decoder<Glue42Workspaces.NewFrameConfig> = object({\r\n    bounds: optional(object({\r\n        left: optional(number()),\r\n        top: optional(number()),\r\n        width: optional(nonNegativeNumberDecoder),\r\n        height: optional(nonNegativeNumberDecoder)\r\n    }))\r\n});\r\n\r\nexport const restoreTypeDecoder: Decoder<Glue42Workspaces.RestoreType> = oneOf<\"direct\" | \"delayed\" | \"lazy\">(\r\n    constant(\"direct\"),\r\n    constant(\"delayed\"),\r\n    constant(\"lazy\")\r\n);\r\n\r\nexport const restoreWorkspaceConfigDecoder: Decoder<Glue42Workspaces.RestoreWorkspaceConfig> = optional(object({\r\n    app: optional(nonEmptyStringDecoder),\r\n    context: optional(anyJson()),\r\n    restoreType: optional(restoreTypeDecoder),\r\n    title: optional(nonEmptyStringDecoder),\r\n    reuseWorkspaceId: optional(nonEmptyStringDecoder),\r\n    frameId: optional(nonEmptyStringDecoder),\r\n    lockdown: optional(boolean()),\r\n    activateFrame: optional(boolean()),\r\n    newFrame: optional(oneOf<Glue42Workspaces.NewFrameConfig | boolean>(\r\n        newFrameConfigDecoder,\r\n        boolean()\r\n    )),\r\n    noTabHeader: optional(boolean()),\r\n    inMemoryLayout: optional(boolean())\r\n}));\r\n\r\nexport const openWorkspaceConfigDecoder: Decoder<OpenWorkspaceConfig> = object({\r\n    name: nonEmptyStringDecoder,\r\n    restoreOptions: optional(restoreWorkspaceConfigDecoder)\r\n});\r\n\r\nexport const workspaceDefinitionDecoder: Decoder<Glue42Workspaces.WorkspaceDefinition> = object({\r\n    children: optional(array(oneOf<Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition>(\r\n        swimlaneWindowDefinitionDecoder,\r\n        parentDefinitionDecoder\r\n    ))),\r\n    context: optional(anyJson()),\r\n    config: optional(object({\r\n        title: optional(nonEmptyStringDecoder),\r\n        position: optional(nonNegativeNumberDecoder),\r\n        isFocused: optional(boolean()),\r\n        noTabHeader: optional(boolean())\r\n    })),\r\n    frame: optional(object({\r\n        reuseFrameId: optional(nonEmptyStringDecoder),\r\n        newFrame: optional(oneOf<boolean | Glue42Workspaces.NewFrameConfig>(\r\n            boolean(),\r\n            newFrameConfigDecoder\r\n        ))\r\n    }))\r\n});\r\n\r\nexport const builderConfigDecoder: Decoder<Glue42Workspaces.BuilderConfig> = object({\r\n    type: allParentDecoder,\r\n    definition: optional(oneOf<Glue42Workspaces.WorkspaceDefinition | Glue42Workspaces.BoxDefinition>(\r\n        workspaceDefinitionDecoder,\r\n        parentDefinitionDecoder\r\n    ))\r\n});\r\n\r\nexport const workspaceCreateConfigDecoder: Decoder<WorkspaceCreateConfigProtocol> = intersection(\r\n    workspaceDefinitionDecoder,\r\n    object({\r\n        saveConfig: optional(object({\r\n            saveLayout: optional(boolean())\r\n        }))\r\n    })\r\n);\r\n\r\nexport const getFrameSummaryConfigDecoder: Decoder<GetFrameSummaryConfig> = object({\r\n    itemId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const frameSummaryDecoder: Decoder<FrameSummaryResult> = object({\r\n    id: nonEmptyStringDecoder\r\n});\r\n\r\nexport const workspaceSummaryDecoder: Decoder<Glue42Workspaces.WorkspaceSummary> = object({\r\n    id: nonEmptyStringDecoder,\r\n    frameId: nonEmptyStringDecoder,\r\n    positionIndex: number(),\r\n    title: nonEmptyStringDecoder,\r\n    focused: boolean(),\r\n    layoutName: optional(nonEmptyStringDecoder)\r\n});\r\n\r\nexport const containerSummaryDecoder: Decoder<Glue42Workspaces.BoxSummary> = object({\r\n    type: subParentDecoder,\r\n    id: nonEmptyStringDecoder,\r\n    frameId: nonEmptyStringDecoder,\r\n    workspaceId: nonEmptyStringDecoder,\r\n    positionIndex: number()\r\n});\r\n\r\nexport const eventTypeDecoder: Decoder<WorkspaceEventType> = oneOf<\"frame\" | \"workspace\" | \"container\" | \"window\">(\r\n    constant(\"frame\"),\r\n    constant(\"workspace\"),\r\n    constant(\"container\"),\r\n    constant(\"window\")\r\n);\r\n\r\nexport const streamRequestArgumentsDecoder: Decoder<{ type: WorkspaceEventType; branch: string }> = object({\r\n    type: eventTypeDecoder,\r\n    branch: nonEmptyStringDecoder\r\n});\r\n\r\nexport const workspaceEventActionDecoder: Decoder<WorkspaceEventAction> = oneOf<\"opened\" | \"closing\" | \"closed\" | \"focus\" | \"added\" | \"loaded\" | \"removed\" | \"childrenUpdate\" | \"containerChange\" | \"maximized\" | \"minimized\" | \"normal\" | \"selected\">(\r\n    constant(\"opened\"),\r\n    constant(\"closing\"),\r\n    constant(\"closed\"),\r\n    constant(\"focus\"),\r\n    constant(\"added\"),\r\n    constant(\"loaded\"),\r\n    constant(\"removed\"),\r\n    constant(\"childrenUpdate\"),\r\n    constant(\"containerChange\"),\r\n    constant(\"maximized\"),\r\n    constant(\"minimized\"),\r\n    constant(\"normal\"),\r\n    constant(\"selected\")\r\n);\r\n\r\nexport const workspaceConfigResultDecoder: Decoder<WorkspaceConfigResult> = object({\r\n    frameId: nonEmptyStringDecoder,\r\n    title: nonEmptyStringDecoder,\r\n    positionIndex: nonNegativeNumberDecoder,\r\n    name: nonEmptyStringDecoder,\r\n    layoutName: optional(nonEmptyStringDecoder)\r\n});\r\n\r\nexport const baseChildSnapshotConfigDecoder: Decoder<BaseChildSnapshotConfig> = object({\r\n    frameId: nonEmptyStringDecoder,\r\n    workspaceId: nonEmptyStringDecoder,\r\n    positionIndex: nonNegativeNumberDecoder\r\n});\r\n\r\nexport const parentSnapshotConfigDecoder: Decoder<ParentSnapshotConfig> = anyJson();\r\n\r\nexport const swimlaneWindowSnapshotConfigDecoder: Decoder<SwimlaneWindowSnapshotConfig> = intersection(\r\n    baseChildSnapshotConfigDecoder,\r\n    object({\r\n        windowId: optional(nonEmptyStringDecoder),\r\n        isMaximized: boolean(),\r\n        isFocused: boolean(),\r\n        title: optional(string()),\r\n        appName: optional(nonEmptyStringDecoder)\r\n    })\r\n);\r\n\r\nexport const childSnapshotResultDecoder: Decoder<ChildSnapshotResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: oneOf<ParentSnapshotConfig | SwimlaneWindowSnapshotConfig>(\r\n        parentSnapshotConfigDecoder,\r\n        swimlaneWindowSnapshotConfigDecoder\r\n    ),\r\n    children: optional(lazy(() => array(childSnapshotResultDecoder))),\r\n    type: oneOf<\"window\" | \"row\" | \"column\" | \"group\">(\r\n        constant(\"window\"),\r\n        constant(\"row\"),\r\n        constant(\"column\"),\r\n        constant(\"group\")\r\n    )\r\n});\r\n\r\nexport const workspaceSnapshotResultDecoder: Decoder<WorkspaceSnapshotResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: workspaceConfigResultDecoder,\r\n    children: array(childSnapshotResultDecoder),\r\n    frameSummary: frameSummaryDecoder\r\n});\r\n\r\nexport const customWorkspaceChildSnapshotDecoder: Decoder<ChildSnapshotResult> = object({\r\n    id: optional(nonEmptyStringDecoder),\r\n    config: oneOf<ParentSnapshotConfig | SwimlaneWindowSnapshotConfig>(\r\n        parentSnapshotConfigDecoder,\r\n        swimlaneWindowSnapshotConfigDecoder\r\n    ),\r\n    children: optional(lazy(() => array(customWorkspaceChildSnapshotDecoder))),\r\n    type: oneOf<\"window\" | \"row\" | \"column\" | \"group\">(\r\n        constant(\"window\"),\r\n        constant(\"row\"),\r\n        constant(\"column\"),\r\n        constant(\"group\")\r\n    )\r\n});\r\n\r\nexport const windowLayoutItemDecoder: Decoder<Glue42Workspaces.WindowLayoutItem> = object({\r\n    type: constant(\"window\"),\r\n    config: object({\r\n        appName: nonEmptyStringDecoder,\r\n        url: optional(nonEmptyStringDecoder)\r\n    })\r\n});\r\n\r\nexport const groupLayoutItemDecoder: Decoder<Glue42Workspaces.GroupLayoutItem> = object({\r\n    type: constant(\"group\"),\r\n    config: anyJson(),\r\n    children: array(oneOf<Glue42Workspaces.WindowLayoutItem>(\r\n        windowLayoutItemDecoder\r\n    ))\r\n});\r\n\r\nexport const columnLayoutItemDecoder: Decoder<Glue42Workspaces.ColumnLayoutItem> = object({\r\n    type: constant(\"column\"),\r\n    config: anyJson(),\r\n    children: array(oneOf<Glue42Workspaces.RowLayoutItem | Glue42Workspaces.ColumnLayoutItem | Glue42Workspaces.GroupLayoutItem | Glue42Workspaces.WindowLayoutItem>(\r\n        groupLayoutItemDecoder,\r\n        windowLayoutItemDecoder,\r\n        lazy(() => columnLayoutItemDecoder),\r\n        lazy(() => rowLayoutItemDecoder)\r\n    ))\r\n});\r\n\r\nexport const rowLayoutItemDecoder: Decoder<Glue42Workspaces.RowLayoutItem> = object({\r\n    type: constant(\"row\"),\r\n    config: anyJson(),\r\n    children: array(oneOf<Glue42Workspaces.RowLayoutItem | Glue42Workspaces.ColumnLayoutItem | Glue42Workspaces.GroupLayoutItem | Glue42Workspaces.WindowLayoutItem>(\r\n        columnLayoutItemDecoder,\r\n        groupLayoutItemDecoder,\r\n        windowLayoutItemDecoder,\r\n        lazy(() => rowLayoutItemDecoder)\r\n    ))\r\n});\r\n\r\nexport const workspaceLayoutDecoder: Decoder<Glue42Workspaces.WorkspaceLayout> = object({\r\n    name: nonEmptyStringDecoder,\r\n    type: constant(\"Workspace\"),\r\n    metadata: optional(anyJson()),\r\n    components: array(object({\r\n        type: constant(\"Workspace\"),\r\n        state: object({\r\n            config: anyJson(),\r\n            context: anyJson(),\r\n            children: array(oneOf<Glue42Workspaces.RowLayoutItem | Glue42Workspaces.ColumnLayoutItem | Glue42Workspaces.GroupLayoutItem | Glue42Workspaces.WindowLayoutItem>(\r\n                rowLayoutItemDecoder,\r\n                columnLayoutItemDecoder,\r\n                groupLayoutItemDecoder,\r\n                windowLayoutItemDecoder\r\n            ))\r\n        })\r\n    }))\r\n});\r\n\r\nexport const exportedLayoutsResultDecoder: Decoder<ExportedLayoutsResult> = object({\r\n    layouts: array(workspaceLayoutDecoder)\r\n});\r\n\r\nexport const frameSummaryResultDecoder: Decoder<FrameSummaryResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n});\r\n\r\nexport const frameSummariesResultDecoder: Decoder<FrameSummariesResult> = object({\r\n    summaries: array(frameSummaryResultDecoder)\r\n});\r\n\r\nexport const workspaceSummaryResultDecoder: Decoder<WorkspaceSummaryResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: workspaceConfigResultDecoder\r\n});\r\n\r\nexport const workspaceSummariesResultDecoder: Decoder<WorkspaceSummariesResult> = object({\r\n    summaries: array(workspaceSummaryResultDecoder)\r\n});\r\n\r\nexport const frameSnapshotResultDecoder: Decoder<FrameSnapshotResult> = object({\r\n    id: nonEmptyStringDecoder,\r\n    config: anyJson(),\r\n    workspaces: array(workspaceSnapshotResultDecoder)\r\n});\r\n\r\nexport const layoutSummaryDecoder: Decoder<LayoutSummary> = object({\r\n    name: nonEmptyStringDecoder\r\n});\r\n\r\nexport const layoutSummariesDecoder: Decoder<LayoutSummariesResult> = object({\r\n    summaries: array(layoutSummaryDecoder)\r\n});\r\n\r\nexport const simpleWindowOperationSuccessResultDecoder: Decoder<SimpleWindowOperationSuccessResult> = object({\r\n    windowId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const voidResultDecoder: Decoder<{}> = anyJson();\r\n\r\nexport const frameStateResultDecoder: Decoder<FrameStateResult> = object({\r\n    state: frameStateDecoder\r\n});\r\n\r\nexport const resizeConfigDecoder: Decoder<Glue42Workspaces.ResizeConfig> = object({\r\n    width: optional(nonNegativeNumberDecoder),\r\n    height: optional(nonNegativeNumberDecoder),\r\n    relative: optional(boolean())\r\n});\r\n\r\nexport const moveConfigDecoder: Decoder<Glue42Workspaces.MoveConfig> = object({\r\n    top: optional(number()),\r\n    left: optional(number()),\r\n    relative: optional(boolean())\r\n});\r\n\r\nexport const simpleItemConfigDecoder: Decoder<SimpleItemConfig> = object({\r\n    itemId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const frameStateConfigDecoder: Decoder<FrameStateConfig> = object({\r\n    frameId: nonEmptyStringDecoder,\r\n    requestedState: frameStateDecoder\r\n});\r\n\r\nexport const setItemTitleConfigDecoder: Decoder<SetItemTitleConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    title: nonEmptyStringDecoder\r\n});\r\n\r\nexport const moveWindowConfigDecoder: Decoder<MoveWindowConfig> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    containerId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const resizeItemConfigDecoder: Decoder<ResizeItemConfig> = intersection(\r\n    simpleItemConfigDecoder,\r\n    resizeConfigDecoder\r\n);\r\n\r\nexport const moveFrameConfigDecoder: Decoder<MoveFrameConfig> = intersection(\r\n    simpleItemConfigDecoder,\r\n    moveConfigDecoder\r\n);\r\n\r\nexport const simpleParentDecoder: Decoder<{ id: string; type: \"row\" | \"column\" | \"group\" }> = object({\r\n    id: nonEmptyStringDecoder,\r\n    type: subParentDecoder\r\n});\r\n\r\nexport const addWindowConfigDecoder: Decoder<AddWindowConfig> = object({\r\n    definition: swimlaneWindowDefinitionDecoder,\r\n    parentId: nonEmptyStringDecoder,\r\n    parentType: allParentDecoder\r\n});\r\n\r\nexport const addContainerConfigDecoder: Decoder<AddContainerConfig> = object({\r\n    definition: strictParentDefinitionDecoder,\r\n    parentId: nonEmptyStringDecoder,\r\n    parentType: allParentDecoder\r\n});\r\n\r\nexport const addItemResultDecoder: Decoder<AddItemResult> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    windowId: optional(nonEmptyStringDecoder)\r\n});\r\n\r\nexport const pingResultDecoder: Decoder<PingResult> = object({\r\n    live: boolean()\r\n});\r\n\r\nexport const bundleConfigDecoder: Decoder<BundleConfig> = object({\r\n    type: oneOf<\"row\" | \"column\">(\r\n        constant(\"row\"),\r\n        constant(\"column\")\r\n    ),\r\n    workspaceId: nonEmptyStringDecoder\r\n});\r\n\r\nexport const containerSummaryResultDecoder: Decoder<ContainerSummaryResult> = object({\r\n    itemId: nonEmptyStringDecoder,\r\n    config: parentSnapshotConfigDecoder\r\n});\r\n\r\nexport const frameStreamDataDecoder: Decoder<FrameStreamData> = object({\r\n    frameSummary: frameSummaryDecoder\r\n});\r\n\r\nexport const workspaceStreamDataDecoder: Decoder<WorkspaceStreamData> = object({\r\n    workspaceSummary: workspaceSummaryResultDecoder,\r\n    frameSummary: frameSummaryDecoder\r\n});\r\n\r\nexport const containerStreamDataDecoder: Decoder<ContainerStreamData> = object({\r\n    containerSummary: containerSummaryResultDecoder\r\n});\r\n\r\nexport const windowStreamDataDecoder: Decoder<WindowStreamData> = object({\r\n    windowSummary: object({\r\n        itemId: nonEmptyStringDecoder,\r\n        parentId: nonEmptyStringDecoder,\r\n        config: swimlaneWindowSnapshotConfigDecoder\r\n    })\r\n});\r\n\r\nexport const workspaceLayoutSaveConfigDecoder: Decoder<Glue42Workspaces.WorkspaceLayoutSaveConfig> = object({\r\n    name: nonEmptyStringDecoder,\r\n    workspaceId: nonEmptyStringDecoder,\r\n    saveContext: optional(boolean())\r\n});\r\n","import { isWindowInSwimlaneResultDecoder, frameSummaryDecoder, workspaceSnapshotResultDecoder, frameSummariesResultDecoder, workspaceCreateConfigDecoder, getFrameSummaryConfigDecoder, layoutSummariesDecoder, openWorkspaceConfigDecoder, workspaceSummariesResultDecoder, voidResultDecoder, exportedLayoutsResultDecoder, workspaceLayoutDecoder, deleteLayoutConfigDecoder, simpleItemConfigDecoder, resizeItemConfigDecoder, moveFrameConfigDecoder, frameSnapshotResultDecoder, simpleWindowOperationSuccessResultDecoder, setItemTitleConfigDecoder, moveWindowConfigDecoder, addWindowConfigDecoder, addContainerConfigDecoder, addItemResultDecoder, bundleConfigDecoder, workspaceStreamDataDecoder, frameStreamDataDecoder, containerStreamDataDecoder, windowStreamDataDecoder, workspaceLayoutSaveConfigDecoder, pingResultDecoder, frameStateConfigDecoder, frameStateResultDecoder } from \"../shared/decoders\";\r\nimport { ControlOperation, StreamOperation } from \"../types/protocol\";\r\nimport { WorkspaceEventType } from \"../types/subscription\";\r\n\r\ntype OperationsTypes = \"isWindowInWorkspace\" |\r\n    \"createWorkspace\" |\r\n    \"getAllFramesSummaries\" |\r\n    \"getFrameSummary\" |\r\n    \"getAllWorkspacesSummaries\" |\r\n    \"getWorkspaceSnapshot\" |\r\n    \"getAllLayoutsSummaries\" |\r\n    \"openWorkspace\" |\r\n    \"deleteLayout\" |\r\n    \"saveLayout\" |\r\n    \"importLayout\" |\r\n    \"exportAllLayouts\" |\r\n    \"restoreItem\" |\r\n    \"maximizeItem\" |\r\n    \"focusItem\" |\r\n    \"closeItem\" |\r\n    \"resizeItem\" |\r\n    \"moveFrame\" |\r\n    \"getFrameSnapshot\" |\r\n    \"forceLoadWindow\" |\r\n    \"ejectWindow\" |\r\n    \"setItemTitle\" |\r\n    \"moveWindowTo\" |\r\n    \"addWindow\" |\r\n    \"addContainer\" |\r\n    \"bundleWorkspace\" |\r\n    \"ping\" |\r\n    \"changeFrameState\" | \r\n    \"getFrameState\";\r\ntype MethodsTypes = \"control\" | \"frameStream\" | \"workspaceStream\" | \"containerStream\" | \"windowStream\" | \"coreEvents\";\r\n\r\nexport const METHODS: { [key in MethodsTypes]: { name: string; isStream: boolean } } = {\r\n    control: { name: \"T42.Workspaces.Control\", isStream: false },\r\n    coreEvents: { name: \"T42.Workspaces.Events\", isStream: false },\r\n    frameStream: { name: \"T42.Workspaces.Stream.Frame\", isStream: true },\r\n    workspaceStream: { name: \"T42.Workspaces.Stream.Workspace\", isStream: true },\r\n    containerStream: { name: \"T42.Workspaces.Stream.Container\", isStream: true },\r\n    windowStream: { name: \"T42.Workspaces.Stream.Window\", isStream: true }\r\n};\r\n\r\nexport const STREAMS: { [key in WorkspaceEventType]: StreamOperation } = {\r\n    frame: { name: \"T42.Workspaces.Stream.Frame\", payloadDecoder: frameStreamDataDecoder },\r\n    workspace: { name: \"T42.Workspaces.Stream.Workspace\", payloadDecoder: workspaceStreamDataDecoder },\r\n    container: { name: \"T42.Workspaces.Stream.Container\", payloadDecoder: containerStreamDataDecoder },\r\n    window: { name: \"T42.Workspaces.Stream.Window\", payloadDecoder: windowStreamDataDecoder }\r\n};\r\n\r\nexport const OPERATIONS: { [key in OperationsTypes]: ControlOperation } = {\r\n    ping: { name: \"ping\", resultDecoder: pingResultDecoder},\r\n    isWindowInWorkspace: { name: \"isWindowInWorkspace\", argsDecoder: simpleItemConfigDecoder, resultDecoder: isWindowInSwimlaneResultDecoder },\r\n    createWorkspace: { name: \"createWorkspace\", resultDecoder: workspaceSnapshotResultDecoder, argsDecoder: workspaceCreateConfigDecoder },\r\n    getAllFramesSummaries: { name: \"getAllFramesSummaries\", resultDecoder: frameSummariesResultDecoder },\r\n    getFrameSummary: { name: \"getFrameSummary\", resultDecoder: frameSummaryDecoder, argsDecoder: getFrameSummaryConfigDecoder },\r\n    getAllWorkspacesSummaries: { name: \"getAllWorkspacesSummaries\", resultDecoder: workspaceSummariesResultDecoder },\r\n    getWorkspaceSnapshot: { name: \"getWorkspaceSnapshot\", resultDecoder: workspaceSnapshotResultDecoder, argsDecoder: simpleItemConfigDecoder },\r\n    getAllLayoutsSummaries: { name: \"getAllLayoutsSummaries\", resultDecoder: layoutSummariesDecoder },\r\n    openWorkspace: { name: \"openWorkspace\", argsDecoder: openWorkspaceConfigDecoder, resultDecoder: workspaceSnapshotResultDecoder },\r\n    deleteLayout: { name: \"deleteLayout\", resultDecoder: voidResultDecoder, argsDecoder: deleteLayoutConfigDecoder },\r\n    saveLayout: { name: \"saveLayout\", resultDecoder: workspaceLayoutDecoder, argsDecoder: workspaceLayoutSaveConfigDecoder },\r\n    importLayout: { name: \"importLayout\", resultDecoder: voidResultDecoder, argsDecoder: workspaceLayoutDecoder },\r\n    exportAllLayouts: { name: \"exportAllLayouts\", resultDecoder: exportedLayoutsResultDecoder },\r\n    restoreItem: { name: \"restoreItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    maximizeItem: { name: \"maximizeItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    focusItem: { name: \"focusItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    closeItem: { name: \"closeItem\", argsDecoder: simpleItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    resizeItem: { name: \"resizeItem\", argsDecoder: resizeItemConfigDecoder, resultDecoder: voidResultDecoder },\r\n    changeFrameState: {name: \"changeFrameState\", argsDecoder: frameStateConfigDecoder, resultDecoder: voidResultDecoder},\r\n    getFrameState: {name: \"getFrameState\", argsDecoder: simpleItemConfigDecoder, resultDecoder: frameStateResultDecoder},\r\n    moveFrame: { name: \"moveFrame\", argsDecoder: moveFrameConfigDecoder, resultDecoder: voidResultDecoder },\r\n    getFrameSnapshot: { name: \"getFrameSnapshot\", argsDecoder: simpleItemConfigDecoder, resultDecoder: frameSnapshotResultDecoder },\r\n    forceLoadWindow: { name: \"forceLoadWindow\", argsDecoder: simpleItemConfigDecoder, resultDecoder: simpleWindowOperationSuccessResultDecoder },\r\n    ejectWindow: { name: \"ejectWindow\", argsDecoder: simpleItemConfigDecoder, resultDecoder: simpleWindowOperationSuccessResultDecoder },\r\n    setItemTitle: { name: \"setItemTitle\", argsDecoder: setItemTitleConfigDecoder, resultDecoder: voidResultDecoder },\r\n    moveWindowTo: { name: \"moveWindowTo\", argsDecoder: moveWindowConfigDecoder, resultDecoder: voidResultDecoder },\r\n    addWindow: { name: \"addWindow\", argsDecoder: addWindowConfigDecoder, resultDecoder: addItemResultDecoder },\r\n    addContainer: { name: \"addContainer\", argsDecoder: addContainerConfigDecoder, resultDecoder: addItemResultDecoder },\r\n    bundleWorkspace: { name: \"bundleWorkspace\", argsDecoder: bundleConfigDecoder, resultDecoder: voidResultDecoder }\r\n};\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { IsWindowInSwimlaneResult, WorkspaceCreateConfigProtocol, WorkspaceSnapshotResult, FrameSummariesResult, WorkspaceSummariesResult, LayoutSummariesResult, ExportedLayoutsResult, FrameSnapshotResult, AddItemResult, WindowStreamData, FrameStateResult } from \"../types/protocol\";\r\nimport { OPERATIONS } from \"../communication/constants\";\r\nimport { SubscriptionConfig, WorkspaceEventType, WorkspaceEventAction } from \"../types/subscription\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { Child } from \"../types/builders\";\r\nimport { RefreshChildrenConfig } from \"../types/privateData\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\nimport { GDWindow } from \"../types/glue\";\r\nimport { BaseController } from \"./base\";\r\nimport { UnsubscribeFunction } from \"callback-registry\";\r\n\r\nexport class EnterpriseController implements WorkspacesController {\r\n\r\n    constructor(\r\n        private readonly bridge: Bridge,\r\n        private readonly base: BaseController\r\n    ) { }\r\n\r\n    public checkIsWindowLoaded(windowId: string): boolean {\r\n        return this.base.checkIsWindowLoaded(windowId);\r\n    }\r\n\r\n    public async checkIsInSwimlane(windowId: string): Promise<boolean> {\r\n\r\n        const controlResult = await this.bridge.send<IsWindowInSwimlaneResult>(OPERATIONS.isWindowInWorkspace.name, { itemId: windowId });\r\n\r\n        return controlResult.inWorkspace;\r\n    }\r\n\r\n    public async createWorkspace(definition: Glue42Workspaces.WorkspaceDefinition, saveConfig?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Workspace> {\r\n        const createConfig: WorkspaceCreateConfigProtocol = Object.assign({}, definition, { saveConfig });\r\n\r\n        return await this.base.createWorkspace(createConfig);\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Workspace> {\r\n        const allLayouts = await this.getLayoutSummaries();\r\n\r\n        const layoutExists = allLayouts.some((summary) => summary.name === name);\r\n\r\n        if (!layoutExists) {\r\n            throw new Error(`This layout: ${name} cannot be restored, because it doesn't exist.`);\r\n        }\r\n\r\n        if (options?.frameId) {\r\n            const allFrameSummaries = await this.bridge.send<FrameSummariesResult>(OPERATIONS.getAllFramesSummaries.name);\r\n\r\n            const foundMatchingFrame = allFrameSummaries.summaries.some((summary) => summary.id === options.frameId);\r\n\r\n            if (!foundMatchingFrame) {\r\n                throw new Error(`Cannot reuse the frame with id: ${options.frameId}, because there is no frame with that ID found`);\r\n            }\r\n        }\r\n\r\n        return await this.base.restoreWorkspace(name, options);\r\n    }\r\n\r\n    public async add(type: \"container\" | \"window\", parentId: string, parentType: \"row\" | \"column\" | \"group\" | \"workspace\", definition: Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition): Promise<AddItemResult> {\r\n        return await this.base.add(type, parentId, parentType, definition);\r\n    }\r\n\r\n    public processLocalSubscription(config: SubscriptionConfig, levelId: string): Promise<Glue42Workspaces.Unsubscribe> {\r\n        config.scopeId = config.scopeId || levelId;\r\n\r\n        if (config.eventType === \"window\" && config.action === \"loaded\") {\r\n            const originalCB = config.callback;\r\n\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n                originalCB(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.subscribe(config);\r\n    }\r\n\r\n    public processGlobalSubscription(callback: (callbackData: unknown) => void, eventType: WorkspaceEventType, action: WorkspaceEventAction): Promise<Glue42Workspaces.Unsubscribe> {\r\n        const config: SubscriptionConfig = {\r\n            eventType, callback, action,\r\n            scope: \"global\",\r\n        };\r\n\r\n        if (eventType === \"window\" && action === \"loaded\") {\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n\r\n                callback(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.subscribe(config);\r\n    }\r\n\r\n    public async getFrame(selector: { windowId?: string; predicate?: (frame: Frame) => boolean }): Promise<Frame> {\r\n\r\n        if (selector.windowId) {\r\n            return await this.base.getFrame(selector.windowId);\r\n        }\r\n\r\n        if (selector.predicate) {\r\n            return (await this.getFrames(selector.predicate))[0];\r\n        }\r\n\r\n        throw new Error(`The provided selector is not valid: ${JSON.stringify(selector)}`);\r\n    }\r\n\r\n    public async getFrames(predicate?: (frame: Frame) => boolean): Promise<Frame[]> {\r\n\r\n        const allFrameSummaries = await this.bridge.send<FrameSummariesResult>(OPERATIONS.getAllFramesSummaries.name);\r\n\r\n        return this.base.getFrames(allFrameSummaries.summaries, predicate);\r\n    }\r\n\r\n    public async getWorkspace(predicate: (workspace: Workspace) => boolean): Promise<Workspace> {\r\n        let foundWorkspace: Workspace;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            if (predicate(wsp)) {\r\n                foundWorkspace = wsp;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return foundWorkspace;\r\n    }\r\n\r\n    public async getWorkspaces(predicate?: (workspace: Workspace) => boolean): Promise<Workspace[]> {\r\n        const matchingWorkspaces: Workspace[] = [] as Workspace[];\r\n\r\n        await this.iterateWorkspaces((wsp) => {\r\n            if (!predicate || predicate(wsp)) {\r\n                matchingWorkspaces.push(wsp);\r\n            }\r\n        });\r\n\r\n        return matchingWorkspaces;\r\n    }\r\n\r\n    public async getAllWorkspaceSummaries(): Promise<Glue42Workspaces.WorkspaceSummary[]> {\r\n\r\n        const allSummariesResult = await this.bridge.send<WorkspaceSummariesResult>(OPERATIONS.getAllWorkspacesSummaries.name, {});\r\n\r\n        return this.base.getAllWorkspaceSummaries(allSummariesResult);\r\n    }\r\n\r\n    public async getWindow(predicate: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => boolean): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        let resultWindow: Glue42Workspaces.WorkspaceWindow;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            const foundWindow = wsp.getWindow(predicate);\r\n\r\n            if (foundWindow) {\r\n                resultWindow = foundWindow;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return resultWindow;\r\n    }\r\n\r\n    public async getParent(predicate: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Promise<Glue42Workspaces.WorkspaceBox> {\r\n        let resultParent: Glue42Workspaces.WorkspaceBox;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n\r\n            const foundParent = wsp.getBox(predicate);\r\n\r\n            if (foundParent) {\r\n                resultParent = foundParent;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return resultParent;\r\n    }\r\n\r\n    public async getLayoutSummaries(): Promise<Glue42Workspaces.WorkspaceLayoutSummary[]> {\r\n        const allLayouts = await this.bridge.send<LayoutSummariesResult>(OPERATIONS.getAllLayoutsSummaries.name);\r\n        return allLayouts.summaries;\r\n    }\r\n\r\n    public async deleteLayout(name: string): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.deleteLayout.name, { name });\r\n    }\r\n\r\n    public async exportLayout(predicate?: (layout: Glue42Workspaces.WorkspaceLayout) => boolean): Promise<Glue42Workspaces.WorkspaceLayout[]> {\r\n        const allLayoutsResult = await this.bridge.send<ExportedLayoutsResult>(OPERATIONS.exportAllLayouts.name);\r\n        return allLayoutsResult.layouts.reduce<Glue42Workspaces.WorkspaceLayout[]>((matchingLayouts, layout) => {\r\n\r\n            if (!predicate || predicate(layout)) {\r\n                matchingLayouts.push(layout);\r\n            }\r\n\r\n            return matchingLayouts;\r\n        }, []);\r\n    }\r\n\r\n    public async saveLayout(config: Glue42Workspaces.WorkspaceLayoutSaveConfig): Promise<Glue42Workspaces.WorkspaceLayout> {\r\n        return await this.bridge.send(OPERATIONS.saveLayout.name, config);\r\n    }\r\n\r\n    public async importLayout(layouts: Glue42Workspaces.WorkspaceLayout[]): Promise<void> {\r\n        await Promise.all(layouts.map((layout) => this.bridge.send(OPERATIONS.importLayout.name, layout)));\r\n    }\r\n\r\n    public handleOnSaved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        return this.base.handleOnSaved(callback);\r\n    }\r\n\r\n    public handleOnRemoved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        return this.base.handleOnRemoved(callback);\r\n    }\r\n\r\n    public async bundleTo(type: \"row\" | \"column\", workspaceId: string): Promise<void> {\r\n        return await this.base.bundleTo(type, workspaceId);\r\n    }\r\n\r\n    public getWorkspaceContext(workspaceId: string): Promise<any> {\r\n        return this.base.getWorkspaceContext(workspaceId);\r\n    }\r\n\r\n    public setWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        return this.base.setWorkspaceContext(workspaceId, data);\r\n    }\r\n\r\n    public updateWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        return this.base.updateWorkspaceContext(workspaceId, data);\r\n    }\r\n\r\n    public subscribeWorkspaceContextUpdated(workspaceId: string, callback: (data: any) => void): Promise<import(\"callback-registry\").UnsubscribeFunction> {\r\n        return this.base.subscribeWorkspaceContextUpdated(workspaceId, callback);\r\n    }\r\n\r\n    public async restoreItem(itemId: string): Promise<void> {\r\n        return await this.base.restoreItem(itemId);\r\n    }\r\n\r\n    public async maximizeItem(itemId: string): Promise<void> {\r\n        return await this.base.maximizeItem(itemId);\r\n    }\r\n\r\n    public async focusItem(itemId: string): Promise<void> {\r\n        return await this.base.focusItem(itemId);\r\n    }\r\n\r\n    public async changeFrameState(frameId: string, state: Glue42Workspaces.FrameState): Promise<void> {\r\n        await this.bridge.send<void>(OPERATIONS.changeFrameState.name, { frameId, requestedState: state });\r\n    }\r\n\r\n    public async getFrameState(frameId: string): Promise<Glue42Workspaces.FrameState> {\r\n        const frameResult = await this.bridge.send<FrameStateResult>(OPERATIONS.getFrameState.name, { itemId: frameId });\r\n        return frameResult.state;\r\n    }\r\n\r\n    public async closeItem(itemId: string): Promise<void> {\r\n        return await this.base.closeItem(itemId);\r\n    }\r\n\r\n    public async resizeItem(itemId: string, config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        return await this.base.resizeItem(itemId, config);\r\n    }\r\n\r\n    public async moveFrame(itemId: string, config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        return await this.base.moveFrame(itemId, config);\r\n    }\r\n\r\n    public getGDWindow(itemId: string): GDWindow {\r\n        return this.base.getGDWindow(itemId);\r\n    }\r\n\r\n    public async forceLoadWindow(itemId: string): Promise<string> {\r\n        const windowId = await this.base.forceLoadWindow(itemId);\r\n\r\n        await this.base.notifyWindowAdded(windowId);\r\n\r\n        return windowId;\r\n    }\r\n\r\n    public async ejectWindow(itemId: string): Promise<string> {\r\n        const windowId: string = (await this.base.ejectWindow(itemId)).windowId;\r\n\r\n        await this.base.notifyWindowAdded(windowId);\r\n\r\n        return windowId;\r\n    }\r\n\r\n    public async moveWindowTo(itemId: string, newParentId: string): Promise<void> {\r\n        return await this.base.moveWindowTo(itemId, newParentId);\r\n    }\r\n\r\n    public async getSnapshot(itemId: string, type: \"workspace\" | \"frame\"): Promise<WorkspaceSnapshotResult | FrameSnapshotResult> {\r\n        return await this.base.getSnapshot(itemId, type);\r\n    }\r\n\r\n    public async setItemTitle(itemId: string, title: string): Promise<void> {\r\n        return await this.base.setItemTitle(itemId, title);\r\n    }\r\n\r\n    public refreshChildren(config: RefreshChildrenConfig): Child[] {\r\n        return this.base.refreshChildren(config);\r\n    }\r\n\r\n    public iterateFindChild(children: Child[], predicate: (child: Child) => boolean): Child {\r\n        return this.base.iterateFindChild(children, predicate);\r\n    }\r\n\r\n    public iterateFilterChildren(children: Child[], predicate: (child: Child) => boolean): Child[] {\r\n        return this.base.iterateFilterChildren(children, predicate);\r\n    }\r\n\r\n    private async iterateWorkspaces(callback: (workspace: Workspace, end: () => void) => void): Promise<void> {\r\n        let ended = false;\r\n\r\n        const end = (): void => { ended = true; };\r\n\r\n        const workspaceSummaries = await this.getAllWorkspaceSummaries();\r\n\r\n        for (const summary of workspaceSummaries) {\r\n            if (ended) {\r\n                return;\r\n            }\r\n\r\n            const wsp = await this.base.fetchWorkspace(summary.id);\r\n\r\n            callback(wsp, end);\r\n        }\r\n    }\r\n}\r\n","import { CallbackRegistry, UnsubscribeFunction } from \"callback-registry\";\r\nimport { SubscriptionConfig, ActiveSubscription, WorkspaceEventType, WorkspaceEventAction, WorkspacePayload, WorkspaceEventScope } from \"../types/subscription\";\r\nimport { STREAMS } from \"./constants\";\r\nimport { OPERATIONS } from \"./constants\";\r\nimport { eventTypeDecoder, streamRequestArgumentsDecoder, workspaceEventActionDecoder } from \"../shared/decoders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { InteropTransport } from \"./interop-transport\";\r\nimport { Instance } from \"../types/glue\";\r\n\r\nexport class Bridge {\r\n\r\n    private readonly activeSubscriptions: ActiveSubscription[] = [];\r\n\r\n    constructor(\r\n        private readonly transport: InteropTransport,\r\n        private readonly registry: CallbackRegistry\r\n    ) { }\r\n\r\n    public async createCoreEventMethod(): Promise<void> {\r\n        await this.transport.coreEventMethodReady(this.handleCoreEventInvocation.bind(this));\r\n    }\r\n\r\n    public handleCoreSubscription(config: SubscriptionConfig): UnsubscribeFunction {\r\n        const registryKey = `${config.eventType}-${config.action}`;\r\n        const scope = config.scope;\r\n        const scopeId = config.scopeId;\r\n\r\n        return this.registry.add(registryKey, (args) => {\r\n            const scopeConfig = {\r\n                type: scope,\r\n                id: scopeId\r\n            };\r\n\r\n            const receivedIds = {\r\n                frame: args.frameSummary?.id || args.windowSummary?.config.frameId,\r\n                workspace: args.workspaceSummary?.id || args.windowSummary?.config.workspaceId,\r\n                window: args.windowSummary?.config.windowId\r\n            };\r\n\r\n            const shouldInvokeCallback = this.checkScopeMatch(scopeConfig, receivedIds);\r\n\r\n            if (!shouldInvokeCallback) {\r\n                return;\r\n            }\r\n\r\n            config.callback(args);\r\n        });\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    public async send<T>(operationName: string, operationArgs?: any, target?: Instance, responseTimeout?: number): Promise<T> {\r\n\r\n        if (!window.glue42gd && !target) {\r\n            throw new Error(`Cannot complete operation: ${operationName} with args: ${JSON.stringify(operationArgs)}, because the environment is Glue42 Core and no frame target was provided`);\r\n        }\r\n\r\n        const operationDefinition = Object.values(OPERATIONS).find((operation) => operation.name === operationName);\r\n\r\n        if (!operationDefinition) {\r\n            throw new Error(`Cannot find definition for operation name: ${operationName}`);\r\n        }\r\n\r\n        if (operationDefinition.argsDecoder) {\r\n            try {\r\n                operationDefinition.argsDecoder.runWithException(operationArgs);\r\n            } catch (error) {\r\n                throw new Error(`Unexpected internal outgoing validation error: ${error.message}, for input: ${JSON.stringify(error.input)}`);\r\n            }\r\n        }\r\n\r\n        let operationResult;\r\n\r\n        try {\r\n            const operationResultRaw = await this.transport.transmitControl(operationDefinition.name, operationArgs, target, responseTimeout);\r\n            operationResult = operationDefinition.resultDecoder.runWithException(operationResultRaw);\r\n        } catch (error) {\r\n            if (error.kind) {\r\n                throw new Error(`Unexpected internal incoming validation error: ${error.message}, for input: ${JSON.stringify(error.input)}`);\r\n            }\r\n            throw new Error(error.message);\r\n        }\r\n\r\n        return operationResult;\r\n    }\r\n\r\n    public async subscribe(config: SubscriptionConfig): Promise<Glue42Workspaces.Unsubscribe> {\r\n        let activeSub = this.getActiveSubscription(config);\r\n        const registryKey = this.getRegistryKey(config);\r\n\r\n        if (!activeSub) {\r\n            const stream = STREAMS[config.eventType];\r\n            const gdSub = await this.transport.subscribe(stream.name, this.getBranchKey(config), config.eventType);\r\n\r\n            gdSub.onData((streamData) => {\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                const data = streamData.data as { action: string; payload: any };\r\n\r\n                // important to decode without exception, because we do not want to throw an exception here\r\n                const requestedArgumentsResult = streamRequestArgumentsDecoder.run(streamData.requestArguments);\r\n                const actionResult = workspaceEventActionDecoder.run(data.action);\r\n\r\n                if (!requestedArgumentsResult.ok || !actionResult.ok) {\r\n                    return;\r\n                }\r\n\r\n                const streamType = requestedArgumentsResult.result.type;\r\n                const branch = requestedArgumentsResult.result.branch;\r\n\r\n                const validatedPayload = STREAMS[streamType].payloadDecoder.run(data.payload);\r\n\r\n                if (!validatedPayload.ok) {\r\n                    return;\r\n                }\r\n\r\n                const keyToExecute = `${streamType}-${branch}-${actionResult.result}`;\r\n                this.registry.execute(keyToExecute, validatedPayload.result);\r\n            });\r\n\r\n            activeSub = {\r\n                streamType: config.eventType,\r\n                level: config.scope,\r\n                levelId: config.scopeId,\r\n                callbacksCount: 0,\r\n                gdSub\r\n            };\r\n\r\n            this.activeSubscriptions.push(activeSub);\r\n        }\r\n\r\n        const unsubscribe = this.registry.add(registryKey, config.callback);\r\n\r\n        ++activeSub.callbacksCount;\r\n\r\n        return (): void => {\r\n            unsubscribe();\r\n\r\n            --activeSub.callbacksCount;\r\n\r\n            if (activeSub.callbacksCount === 0) {\r\n                activeSub.gdSub.close();\r\n                this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(activeSub), 1);\r\n            }\r\n        };\r\n    }\r\n\r\n    private checkScopeMatch(scope: { type: WorkspaceEventScope, id?: string }, receivedIds: { frame: string, workspace: string, window: string }): boolean {\r\n\r\n        if (scope.type === \"global\") {\r\n            return true;\r\n        }\r\n\r\n        if (scope.type === \"frame\" && scope.id === receivedIds.frame) {\r\n            return true;\r\n        }\r\n\r\n        if (scope.type === \"workspace\" && scope.id === receivedIds.workspace) {\r\n            return true;\r\n        }\r\n\r\n        if (scope.type === \"window\" && scope.id === receivedIds.window) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private handleCoreEventInvocation(args?: any): void {\r\n        const verifiedAction: WorkspaceEventAction = workspaceEventActionDecoder.runWithException(args.action);\r\n        const verifiedType: WorkspaceEventType = eventTypeDecoder.runWithException(args.type);\r\n        const verifiedPayload: WorkspacePayload = STREAMS[verifiedType].payloadDecoder.runWithException(args.payload);\r\n\r\n        const registryKey = `${verifiedType}-${verifiedAction}`;\r\n\r\n        this.registry.execute(registryKey, verifiedPayload);\r\n    }\r\n\r\n    private getBranchKey(config: SubscriptionConfig): string {\r\n        return config.scope === \"global\" ? config.scope : `${config.scope}_${config.scopeId}`;\r\n    }\r\n\r\n    private getRegistryKey(config: SubscriptionConfig): string {\r\n        return `${config.eventType}-${this.getBranchKey(config)}-${config.action}`;\r\n    }\r\n\r\n    private getActiveSubscription(config: SubscriptionConfig): ActiveSubscription {\r\n        return this.activeSubscriptions\r\n            .find((activeSub) => activeSub.streamType === config.eventType &&\r\n                activeSub.level === config.scope &&\r\n                activeSub.levelId === config.scopeId\r\n            );\r\n    }\r\n}\r\n","export const promisePlus = <T>(promise: () => Promise<T>, timeoutMilliseconds: number, timeoutMessage?: string): Promise<T> => {\r\n    return new Promise<T>((resolve, reject) => {\r\n\r\n        let promiseActive = true;\r\n\r\n        const timeout = setTimeout(() => {\r\n            if (!promiseActive) {\r\n                return;\r\n            }\r\n            promiseActive = false;\r\n            const message = timeoutMessage || `Promise timeout hit: ${timeoutMilliseconds}`;\r\n\r\n            reject(message);\r\n        }, timeoutMilliseconds);\r\n\r\n        promise()\r\n            .then((result) => {\r\n                if (!promiseActive) {\r\n                    return;\r\n                }\r\n                promiseActive = false;\r\n                clearTimeout(timeout);\r\n                resolve(result);\r\n            })\r\n            .catch((error) => {\r\n                if (!promiseActive) {\r\n                    return;\r\n                }\r\n                promiseActive = false;\r\n                clearTimeout(timeout);\r\n                reject(error);\r\n            });\r\n    });\r\n};\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { METHODS } from \"./constants\";\r\nimport { promisePlus } from \"../shared/promisePlus\";\r\nimport { WorkspaceEventType } from \"../types/subscription\";\r\nimport { InteropAPI, Subscription, Instance, InvocationResult } from \"../types/glue\";\r\n\r\nexport class InteropTransport {\r\n\r\n    private readonly defaultTransportTimeout: number = 30000;\r\n    private coreEventMethodInitiated = false;\r\n    private coreEventMethodRegistrationPromise: Promise<void>;\r\n\r\n    constructor(private readonly agm: InteropAPI) { }\r\n\r\n    public coreEventMethodReady(eventCallback: (args?: any) => void): Promise<void> {\r\n        if (!this.coreEventMethodInitiated) {\r\n            this.registerCoreEventMethod(eventCallback);\r\n        }\r\n        return this.coreEventMethodRegistrationPromise;\r\n    }\r\n\r\n    public registerCoreEventMethod(eventCallback: (args?: any) => void): void {\r\n        this.coreEventMethodInitiated = true;\r\n        console.log(\"creating method\");\r\n        this.coreEventMethodRegistrationPromise = this.agm.register(METHODS.coreEvents.name, eventCallback);\r\n    }\r\n\r\n    public async initiate(): Promise<void> {\r\n\r\n        if (window.glue42gd) {\r\n            await Promise.all(\r\n                Object.values(METHODS).map((method) => {\r\n                    if (method.name === METHODS.coreEvents.name) {\r\n                        return Promise.resolve();\r\n                    }\r\n                    return this.verifyMethodLive(method.name, method.isStream)\r\n                })\r\n            );\r\n        }\r\n\r\n    }\r\n\r\n    public async subscribe(streamName: string, streamBranch: string, streamType: WorkspaceEventType): Promise<Subscription> {\r\n\r\n        const subscriptionArgs = {\r\n            branch: streamBranch,\r\n            type: streamType\r\n        };\r\n\r\n        let subscription: Subscription;\r\n\r\n        try {\r\n            subscription = await this.agm.subscribe(streamName, { arguments: subscriptionArgs });\r\n        } catch (error) {\r\n            const message = `Internal subscription error! Error details: stream - ${streamName}, branch: ${streamBranch}. Internal message: ${error.message}`;\r\n            throw new Error(message);\r\n        }\r\n\r\n        return subscription;\r\n    }\r\n\r\n    public async transmitControl(operation: string, operationArguments: any, target?: Instance, responseTimeout?: number): Promise<any> {\r\n\r\n        const controlMethod = this.agm.methods().find((method) => method.name === METHODS.control.name);\r\n\r\n        if (!controlMethod) {\r\n            throw new Error(`Cannot complete operation: ${operation}, because no control method was found`);\r\n        }\r\n\r\n        const invocationArguments = { operation, operationArguments };\r\n\r\n        let invocationResult: InvocationResult<any>;\r\n        const baseErrorMessage = `Internal Workspaces Communication Error. Attempted operation: ${JSON.stringify(invocationArguments)}. `;\r\n\r\n        // using the 0 index of the errors and values collections, because we expect only one server and\r\n        // this is to safeguard in case in future we decide to deprecate the default returned/message properties in favor of using only collections\r\n        try {\r\n            invocationResult = await this.agm.invoke(METHODS.control.name, invocationArguments, target, { methodResponseTimeoutMs: responseTimeout || this.defaultTransportTimeout });\r\n\r\n            if (!invocationResult) {\r\n                throw new Error(\"Received unsupported result from GD - empty result\");\r\n            }\r\n\r\n            if (!Array.isArray(invocationResult.all_return_values) || invocationResult.all_return_values.length === 0) {\r\n                throw new Error(\"Received unsupported result from GD - empty values collection\");\r\n            }\r\n\r\n        } catch (error) {\r\n            if (error && error.all_errors && error.all_errors.length) {\r\n                // IMPORTANT: Do NOT change the `Inner message:` string, because it is used by other programs to extract the inner message of a communication error\r\n                const invocationErrorMessage = error.all_errors[0].message;\r\n                throw new Error(`${baseErrorMessage} -> Inner message: ${invocationErrorMessage}`);\r\n\r\n            }\r\n            // IMPORTANT: Do NOT change the `Inner message:` string, because it is used by other programs to extract the inner message of a communication error\r\n            throw new Error(`${baseErrorMessage} -> Inner message: ${error.message}`);\r\n        }\r\n\r\n        return invocationResult.all_return_values[0].returned;\r\n    }\r\n\r\n    private verifyMethodLive(name: string, isStream: boolean): Promise<void> {\r\n        return promisePlus(() => {\r\n            return new Promise((resolve) => {\r\n                const foundMethod = this.agm\r\n                    .methods()\r\n                    .find((method) => method.name === name && method.supportsStreaming === isStream);\r\n\r\n                if (foundMethod) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                let unsubscribe = this.agm.methodAdded((method) => {\r\n                    if (method.name !== name || method.supportsStreaming !== isStream) {\r\n                        return;\r\n                    }\r\n\r\n                    if (unsubscribe) {\r\n                        unsubscribe();\r\n                        unsubscribe = null;\r\n                    } else {\r\n                        setTimeout(() => {\r\n                            if (unsubscribe) {\r\n                                unsubscribe();\r\n                            }\r\n                        }, 0);\r\n                    }\r\n                    resolve();\r\n                });\r\n            });\r\n        }, 15000, \"Timeout waiting for the Workspaces communication channels\");\r\n    }\r\n}\r\n","import { BaseBuilder } from \"./baseBuilder\";\r\nimport { ChildBuilder } from \"../types/builders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\n\r\ninterface PrivateData {\r\n    definition: Glue42Workspaces.BoxDefinition;\r\n    base: BaseBuilder;\r\n    children: ChildBuilder[];\r\n}\r\n\r\nconst privateData = new WeakMap<ParentBuilder, PrivateData>();\r\n\r\nexport class ParentBuilder implements ParentBuilder {\r\n\r\n    constructor(\r\n        definition: Glue42Workspaces.BoxDefinition,\r\n        base: BaseBuilder\r\n    ) {\r\n        const children = base.wrapChildren(definition.children);\r\n\r\n        delete definition.children;\r\n\r\n        privateData.set(this, { base, children, definition });\r\n    }\r\n\r\n    public get type(): \"column\" | \"row\" | \"group\" {\r\n        return privateData.get(this).definition.type;\r\n    }\r\n\r\n    public addColumn(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"column\", privateData.get(this).children, definition);\r\n    }\r\n\r\n    public addRow(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"row\", privateData.get(this).children, definition);\r\n    }\r\n\r\n    public addGroup(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"group\", privateData.get(this).children, definition);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): ParentBuilder {\r\n        const base = privateData.get(this).base;\r\n\r\n        base.addWindow(privateData.get(this).children, definition);\r\n\r\n        return this;\r\n    }\r\n\r\n    public serialize(): Glue42Workspaces.BoxDefinition {\r\n        const definition = privateData.get(this).definition;\r\n        definition.children = privateData.get(this).base.serializeChildren(privateData.get(this).children);\r\n        return definition;\r\n    }\r\n\r\n}\r\n","import { ParentBuilder } from \"./parentBuilder\";\r\nimport { ChildDefinition, ChildBuilder } from \"../types/builders\";\r\nimport { parentDefinitionDecoder, swimlaneWindowDefinitionDecoder } from \"../shared/decoders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspaceBuilder } from \"./workspaceBuilder\";\r\n\r\nexport class BaseBuilder {\r\n\r\n    constructor(\r\n        private readonly getBuilder: (config: Glue42Workspaces.BuilderConfig) => ParentBuilder | WorkspaceBuilder,\r\n    ) { }\r\n\r\n    public wrapChildren(children: ChildDefinition[]): ChildBuilder[] {\r\n        return children.map((child) => {\r\n            if (child.type === \"window\") {\r\n                return child;\r\n            }\r\n\r\n            return this.getBuilder({ type: child.type, definition: child }) as ParentBuilder;\r\n        });\r\n    }\r\n\r\n    public add(type: \"row\" | \"column\" | \"group\", children: ChildBuilder[], definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const validatedDefinition = parentDefinitionDecoder.runWithException(definition);\r\n\r\n        const childBuilder = this.getBuilder({ type, definition: validatedDefinition }) as ParentBuilder;\r\n\r\n        children.push(childBuilder);\r\n\r\n        return childBuilder;\r\n    }\r\n\r\n    public addWindow(children: ChildBuilder[], definition: Glue42Workspaces.WorkspaceWindowDefinition): void {\r\n        const validatedDefinition = swimlaneWindowDefinitionDecoder.runWithException(definition);\r\n\r\n        validatedDefinition.type = \"window\";\r\n\r\n        children.push(validatedDefinition);\r\n    }\r\n\r\n    public serializeChildren(children: ChildBuilder[]): ChildDefinition[] {\r\n        return children.map((child) => {\r\n            if (child instanceof ParentBuilder) {\r\n                return child.serialize();\r\n            } else {\r\n                return child as Glue42Workspaces.WorkspaceWindowDefinition;\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { BaseBuilder } from \"./baseBuilder\";\r\nimport { ChildBuilder } from \"../types/builders\";\r\nimport { ParentBuilder } from \"./parentBuilder\";\r\nimport { workspaceBuilderCreateConfigDecoder, nonNegativeNumberDecoder } from \"../shared/decoders\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\n\r\ninterface PrivateData {\r\n    definition: Glue42Workspaces.WorkspaceDefinition;\r\n    children: ChildBuilder[];\r\n    base: BaseBuilder;\r\n    controller: WorkspacesController;\r\n}\r\n\r\nconst privateData = new WeakMap<WorkspaceBuilder, PrivateData>();\r\n\r\nexport class WorkspaceBuilder implements WorkspaceBuilder {\r\n\r\n    constructor(\r\n        definition: Glue42Workspaces.WorkspaceDefinition,\r\n        base: BaseBuilder,\r\n        controller: WorkspacesController\r\n    ) {\r\n        const children = base.wrapChildren(definition.children);\r\n\r\n        delete definition.children;\r\n\r\n        privateData.set(this, { base, children, definition, controller });\r\n    }\r\n\r\n    public addColumn(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        const areAllColumns = children.every((child) => child instanceof ParentBuilder && child.type === \"column\");\r\n\r\n        if (!areAllColumns) {\r\n            throw new Error(\"Cannot add a column to this workspace, because there are already children of another type\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"column\", children, definition);\r\n    }\r\n\r\n    public addRow(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        const areAllRows = children.every((child) => child instanceof ParentBuilder && child.type === \"row\");\r\n\r\n        if (!areAllRows) {\r\n            throw new Error(\"Cannot add a row to this workspace, because there are already children of another type\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"row\", children, definition);\r\n    }\r\n\r\n    public addGroup(definition?: Glue42Workspaces.BoxDefinition): ParentBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        if (children.length !== 0) {\r\n            throw new Error(\"Cannot add a group to this workspace, because there are already defined children.\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        return base.add(\"group\", children, definition);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): WorkspaceBuilder {\r\n        const children = privateData.get(this).children;\r\n\r\n        if (children.length !== 0) {\r\n            throw new Error(\"Cannot add a window to this workspace, because there are already defined children.\");\r\n        }\r\n\r\n        const base = privateData.get(this).base;\r\n\r\n        base.addWindow(children, definition);\r\n\r\n        return this;\r\n    }\r\n\r\n    public getChildAt(index: number): ChildBuilder {\r\n        nonNegativeNumberDecoder.runWithException(index);\r\n        const data = privateData.get(this).children;\r\n\r\n        return data[index];\r\n    }\r\n\r\n    public async create(config?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Glue42Workspaces.Workspace> {\r\n        const saveConfig = workspaceBuilderCreateConfigDecoder.runWithException(config);\r\n\r\n        const definition = privateData.get(this).definition;\r\n        definition.children = privateData.get(this).base.serializeChildren(privateData.get(this).children);\r\n\r\n        const controller = privateData.get(this).controller;\r\n\r\n        return controller.createWorkspace(definition, saveConfig);\r\n    }\r\n}\r\n","import { Base } from \"./base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\n\r\ninterface PrivateData {\r\n    base: Base;\r\n}\r\n\r\nconst privateData = new WeakMap<Row, PrivateData>();\r\n\r\nconst getBase = (model: Row): Base => {\r\n    return privateData.get(model).base;\r\n};\r\n\r\nexport class Row implements Glue42Workspaces.Row {\r\n\r\n    constructor(base: Base) {\r\n        privateData.set(this, { base });\r\n    }\r\n\r\n    public get type(): \"row\" {\r\n        return \"row\";\r\n    }\r\n\r\n    public get id(): string {\r\n        return getBase(this).getId(this);\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getBase(this).getFrameId(this);\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getBase(this).getWorkspaceId(this);\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getBase(this).getPositionIndex(this);\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getBase(this).getAllChildren(this);\r\n    }\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.WorkspaceBox {\r\n        return getBase(this).getMyParent(this);\r\n    }\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getBase(this).getMyFrame(this);\r\n    }\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getBase(this).getMyWorkspace(this);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getBase(this).addWindow(this, definition, \"row\");\r\n    }\r\n\r\n    public async addGroup(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Group> {\r\n        if (definition?.type && definition.type !== \"group\") {\r\n            throw new Error(`Expected a group definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Group>(this, \"group\", \"row\", definition);\r\n    }\r\n\r\n    public async addColumn(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Column> {\r\n        if (definition?.type && definition.type !== \"column\") {\r\n            throw new Error(`Expected a column definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Column>(this, \"column\", \"row\", definition);\r\n    }\r\n\r\n    public async addRow(): Promise<Row> {\r\n        throw new Error(\"Adding rows as row children is not supported\");\r\n    }\r\n\r\n    public removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        return getBase(this).removeChild(this, predicate);\r\n    }\r\n\r\n    public maximize(): Promise<void> {\r\n        return getBase(this).maximize(this);\r\n    }\r\n\r\n    public restore(): Promise<void> {\r\n        return getBase(this).restore(this);\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        return getBase(this).close(this);\r\n    }\r\n\r\n}\r\n","import { Base } from \"./base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\n\r\ninterface PrivateData {\r\n    base: Base;\r\n}\r\n\r\nconst privateData = new WeakMap<Column, PrivateData>();\r\n\r\nconst getBase = (model: Column): Base => {\r\n    return privateData.get(model).base;\r\n};\r\n\r\nexport class Column implements Glue42Workspaces.Column {\r\n\r\n    constructor(base: Base) {\r\n        privateData.set(this, { base });\r\n    }\r\n\r\n    public get type(): \"column\" {\r\n        return \"column\";\r\n    }\r\n\r\n    public get id(): string {\r\n        return getBase(this).getId(this);\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getBase(this).getFrameId(this);\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getBase(this).getWorkspaceId(this);\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getBase(this).getPositionIndex(this);\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getBase(this).getAllChildren(this);\r\n    }\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.WorkspaceBox {\r\n        return getBase(this).getMyParent(this);\r\n    }\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getBase(this).getMyFrame(this);\r\n    }\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getBase(this).getMyWorkspace(this);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getBase(this).addWindow(this, definition, \"column\");\r\n    }\r\n\r\n    public async addGroup(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Group> {\r\n        if (definition?.type && definition.type !== \"group\") {\r\n            throw new Error(`Expected a group definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Group>(this, \"group\", \"column\", definition);\r\n    }\r\n\r\n    public async addColumn(definition?: Glue42Workspaces.BoxDefinition): Promise<Column> {\r\n        throw new Error(\"Adding columns as column children is not supported\");\r\n        return getBase(this).addParent<Column>(this, \"column\", \"column\", definition);\r\n    }\r\n\r\n    public async addRow(definition?: Glue42Workspaces.BoxDefinition): Promise<Glue42Workspaces.Row> {\r\n        if (definition?.type && definition.type !== \"row\") {\r\n            throw new Error(`Expected a row definition, but received ${definition.type}`);\r\n        }\r\n        return getBase(this).addParent<Glue42Workspaces.Row>(this, \"row\", \"column\", definition);\r\n    }\r\n\r\n    public removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        return getBase(this).removeChild(this, predicate);\r\n    }\r\n\r\n    public maximize(): Promise<void> {\r\n        return getBase(this).maximize(this);\r\n    }\r\n\r\n    public restore(): Promise<void> {\r\n        return getBase(this).restore(this);\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        return getBase(this).close(this);\r\n    }\r\n\r\n}\r\n","import { Base } from \"./base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\n\r\ninterface PrivateData {\r\n    base: Base;\r\n}\r\n\r\nconst privateData = new WeakMap<Group, PrivateData>();\r\n\r\nconst getBase = (model: Group): Base => {\r\n    return privateData.get(model).base;\r\n};\r\n\r\nexport class Group implements Glue42Workspaces.Group {\r\n\r\n    constructor(base: Base) {\r\n        privateData.set(this, { base });\r\n    }\r\n\r\n    public get type(): \"group\" {\r\n        return \"group\";\r\n    }\r\n\r\n    public get id(): string {\r\n        return getBase(this).getId(this);\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getBase(this).getFrameId(this);\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getBase(this).getWorkspaceId(this);\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getBase(this).getPositionIndex(this);\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getBase(this).getAllChildren(this);\r\n    }\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.WorkspaceBox {\r\n        return getBase(this).getMyParent(this);\r\n    }\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getBase(this).getMyFrame(this);\r\n    }\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getBase(this).getMyWorkspace(this);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getBase(this).addWindow(this, definition, \"group\");\r\n    }\r\n\r\n    public async addGroup(): Promise<Group> {\r\n        throw new Error(\"Adding groups as group child is not supported\");\r\n    }\r\n\r\n    public async addColumn(): Promise<Glue42Workspaces.Column> {\r\n        throw new Error(\"Adding columns as group child is not supported\");\r\n    }\r\n\r\n    public async addRow(): Promise<Glue42Workspaces.Row> {\r\n        throw new Error(\"Adding rows as group child is not supported\");\r\n    }\r\n\r\n    public removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        return getBase(this).removeChild(this, predicate);\r\n    }\r\n\r\n    public maximize(): Promise<void> {\r\n        return getBase(this).maximize(this);\r\n    }\r\n\r\n    public restore(): Promise<void> {\r\n        return getBase(this).restore(this);\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        return getBase(this).close(this);\r\n    }\r\n\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { WorkspaceSnapshotResult, WindowStreamData } from \"../types/protocol\";\r\nimport { checkThrowCallback, nonEmptyStringDecoder } from \"../shared/decoders\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { FrameCreateConfig } from \"../types/ioc\";\r\nimport { Window } from \"./window\";\r\nimport { Frame } from \"./frame\";\r\nimport { Row } from \"./row\";\r\nimport { Column } from \"./column\";\r\nimport { Group } from \"./group\";\r\nimport { SubscriptionConfig } from \"../types/subscription\";\r\nimport { WorkspacePrivateData } from \"../types/privateData\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Workspace, PrivateData>();\r\n\r\nconst getData = (model: Workspace): WorkspacePrivateData => {\r\n    return data.get(model).manager.getWorkspaceData(model);\r\n};\r\n\r\nconst getDataManager = (model: Workspace): PrivateDataManager => {\r\n    return data.get(model).manager;\r\n};\r\n\r\nexport class Workspace implements Glue42Workspaces.Workspace {\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public get id(): string {\r\n        return getData(this).id;\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getData(this).config.frameId;\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getData(this).config.positionIndex;\r\n    }\r\n\r\n    public get title(): string {\r\n        return getData(this).config.title;\r\n    }\r\n\r\n    public get layoutName(): string | undefined {\r\n        return getData(this).config.layoutName;\r\n    }\r\n\r\n    public get children(): Glue42Workspaces.WorkspaceElement[] {\r\n        return getData(this).children;\r\n    }\r\n\r\n    public get frame(): Frame {\r\n        return getData(this).frame;\r\n    }\r\n\r\n    public async removeChild(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        checkThrowCallback(predicate);\r\n        const child = this.children.find(predicate);\r\n        if (!child) {\r\n            return;\r\n        }\r\n        await child.close();\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async remove(predicate: (child: Glue42Workspaces.WorkspaceElement) => boolean): Promise<void> {\r\n        checkThrowCallback(predicate);\r\n        const controller = getData(this).controller;\r\n\r\n        const child = controller.iterateFindChild(this.children, predicate);\r\n\r\n        await child.close();\r\n\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async focus(): Promise<void> {\r\n        await getData(this).controller.focusItem(this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async close(): Promise<void> {\r\n        const controller = getData(this).controller;\r\n\r\n        const workspaces = await getData(this).frame.workspaces();\r\n\r\n        const shouldCloseFrame = workspaces.length === 1 && workspaces.every((wsp) => wsp.id === this.id);\r\n\r\n        if (shouldCloseFrame) {\r\n            return this.frame.close();\r\n        }\r\n\r\n        await controller.closeItem(this.id);\r\n    }\r\n\r\n    public snapshot(): Promise<Glue42Workspaces.WorkspaceSnapshot> {\r\n        return getData(this).controller.getSnapshot(this.id, \"workspace\");\r\n    }\r\n\r\n    public async saveLayout(name: string, config?: { saveContext?: boolean }): Promise<void> {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        await getData(this).controller.saveLayout({name, workspaceId: this.id, saveContext: config?.saveContext});\r\n    }\r\n\r\n    public async setTitle(title: string): Promise<void> {\r\n        nonEmptyStringDecoder.runWithException(title);\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.setItemTitle(this.id, title);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public getContext(): Promise<any> {\r\n        const controller = getData(this).controller;\r\n        return controller.getWorkspaceContext(this.id);\r\n    }\r\n\r\n    public setContext(data: any): Promise<void> {\r\n        const controller = getData(this).controller;\r\n        return controller.setWorkspaceContext(this.id, data);\r\n    }\r\n\r\n    public updateContext(data: any): Promise<void> {\r\n        const controller = getData(this).controller;\r\n        return controller.updateWorkspaceContext(this.id, data);\r\n    }\r\n\r\n    public onContextUpdated(callback: (data: any) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        const controller = getData(this).controller;\r\n        return controller.subscribeWorkspaceContextUpdated(this.id, callback);\r\n    }\r\n\r\n    public async refreshReference(): Promise<void> {\r\n        const newSnapshot = (await getData(this).controller.getSnapshot(this.id, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n        const existingChildren = newSnapshot.children.reduce<Glue42Workspaces.WorkspaceElement[]>((foundChildren, child) => {\r\n            let foundChild: Glue42Workspaces.WorkspaceElement;\r\n            if (child.type === \"window\") {\r\n                foundChild = this.getWindow((swimlaneWindow) => swimlaneWindow.id === child.id);\r\n            } else {\r\n                foundChild = this.getBox((parent) => parent.id === child.id);\r\n            }\r\n\r\n            if (foundChild) {\r\n                foundChildren.push(foundChild);\r\n            }\r\n\r\n            return foundChildren;\r\n        }, []);\r\n\r\n        const newChildren = getData(this).controller.refreshChildren({\r\n            existingChildren,\r\n            workspace: this,\r\n            parent: this,\r\n            children: newSnapshot.children\r\n        });\r\n\r\n        const currentFrame = this.frame;\r\n        let actualFrame: Frame;\r\n\r\n        if (currentFrame.id === newSnapshot.config.frameId) {\r\n            getDataManager(this).remapFrame(currentFrame, newSnapshot.frameSummary);\r\n            actualFrame = currentFrame;\r\n        } else {\r\n            const frameCreateConfig: FrameCreateConfig = {\r\n                summary: newSnapshot.frameSummary\r\n            };\r\n            const newFrame = getData(this).ioc.getModel<\"frame\">(\"frame\", frameCreateConfig);\r\n            actualFrame = newFrame;\r\n        }\r\n\r\n        getDataManager(this).remapWorkspace(this, {\r\n            config: newSnapshot.config,\r\n            children: newChildren,\r\n            frame: actualFrame\r\n        });\r\n    }\r\n\r\n    public getBox(predicate: (box: Glue42Workspaces.WorkspaceBox) => boolean): Glue42Workspaces.WorkspaceBox {\r\n        checkThrowCallback(predicate);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        return controller.iterateFindChild(children, (child) => child.type !== \"window\" && predicate(child)) as Glue42Workspaces.WorkspaceBox;\r\n    }\r\n\r\n    public getAllBoxes(predicate?: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Glue42Workspaces.WorkspaceBox[] {\r\n        checkThrowCallback(predicate, true);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        const allParents = controller.iterateFilterChildren(children, (child) => child.type !== \"window\") as Glue42Workspaces.WorkspaceBox[];\r\n\r\n        if (!predicate) {\r\n            return allParents;\r\n        }\r\n\r\n        return allParents.filter(predicate);\r\n    }\r\n\r\n    public getRow(predicate: (row: Row) => boolean): Row {\r\n        checkThrowCallback(predicate);\r\n        return this.getBox((parent) => parent.type === \"row\" && predicate(parent)) as Row;\r\n    }\r\n\r\n    public getAllRows(predicate?: (row: Row) => boolean): Row[] {\r\n        checkThrowCallback(predicate, true);\r\n        if (predicate) {\r\n            return this.getAllBoxes((parent) => parent.type === \"row\" && predicate(parent)) as Row[];\r\n        }\r\n        return this.getAllBoxes((parent) => parent.type === \"row\") as Row[];\r\n    }\r\n\r\n    public getColumn(predicate: (column: Column) => boolean): Column {\r\n        checkThrowCallback(predicate);\r\n        return this.getBox((parent) => parent.type === \"column\" && predicate(parent)) as Column;\r\n    }\r\n\r\n    public getAllColumns(predicate?: (columns: Column) => boolean): Column[] {\r\n        checkThrowCallback(predicate, true);\r\n        if (predicate) {\r\n            return this.getAllBoxes((parent) => parent.type === \"column\" && predicate(parent)) as Column[];\r\n        }\r\n        return this.getAllBoxes((parent) => parent.type === \"column\") as Column[];\r\n    }\r\n\r\n    public getGroup(predicate: (group: Group) => boolean): Group {\r\n        checkThrowCallback(predicate);\r\n        return this.getBox((parent) => parent.type === \"group\" && predicate(parent)) as Group;\r\n    }\r\n\r\n    public getAllGroups(predicate?: (group: Group) => boolean): Group[] {\r\n        checkThrowCallback(predicate, true);\r\n        if (predicate) {\r\n            return this.getAllBoxes((parent) => parent.type === \"group\" && predicate(parent)) as Group[];\r\n        }\r\n        return this.getAllBoxes((parent) => parent.type === \"group\") as Group[];\r\n    }\r\n\r\n    public getWindow(predicate: (window: Glue42Workspaces.WorkspaceWindow) => boolean): Glue42Workspaces.WorkspaceWindow {\r\n        checkThrowCallback(predicate);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        return controller.iterateFindChild(children, (child) => child.type === \"window\" && predicate(child)) as Window;\r\n    }\r\n\r\n    public getAllWindows(predicate?: (window: Glue42Workspaces.WorkspaceWindow) => boolean): Glue42Workspaces.WorkspaceWindow[] {\r\n        checkThrowCallback(predicate, true);\r\n        const children = getData(this).children;\r\n        const controller = getData(this).controller;\r\n\r\n        const allWindows = controller.iterateFilterChildren(children, (child) => child.type === \"window\") as Window[];\r\n\r\n        if (!predicate) {\r\n            return allWindows;\r\n        }\r\n\r\n        return allWindows.filter(predicate);\r\n    }\r\n\r\n    public addRow(definition?: Glue42Workspaces.BoxDefinition): Promise<Row> {\r\n        return getData(this).base.addParent<Row>(this, \"row\", \"workspace\", definition);\r\n    }\r\n\r\n    public addColumn(definition?: Glue42Workspaces.BoxDefinition): Promise<Column> {\r\n        return getData(this).base.addParent<Column>(this, \"column\", \"workspace\", definition);\r\n    }\r\n\r\n    public addGroup(definition?: Glue42Workspaces.BoxDefinition): Promise<Group> {\r\n        return getData(this).base.addParent<Group>(this, \"group\", \"workspace\", definition);\r\n    }\r\n\r\n    public addWindow(definition: Glue42Workspaces.WorkspaceWindowDefinition): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        return getData(this).base.addWindow(this, definition, \"workspace\");\r\n    }\r\n\r\n    public async bundleToRow(): Promise<void> {\r\n        await getData(this).controller.bundleTo(\"row\", this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async bundleToColumn(): Promise<void> {\r\n        await getData(this).controller.bundleTo(\"column\", this.id);\r\n        await this.refreshReference();\r\n    }\r\n\r\n    public async onClosed(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n\r\n        const wrappedCallback = async (): Promise<void> => {\r\n            // await this.refreshReference();\r\n            callback();\r\n        };\r\n        const config: SubscriptionConfig = {\r\n            action: \"closed\",\r\n            eventType: \"workspace\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowAdded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            await this.refreshReference();\r\n            const windowParent = this.getBox((parent) => parent.id === payload.windowSummary.parentId);\r\n\r\n            const foundWindow = windowParent.children.find((child) => {\r\n\r\n                return child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex;\r\n            });\r\n            callback(foundWindow as Window);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            action: \"added\",\r\n            eventType: \"window\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowRemoved(callback: (removed: { windowId?: string; workspaceId: string; frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            await this.refreshReference();\r\n            const { windowId, workspaceId, frameId } = payload.windowSummary.config;\r\n            callback({ windowId, workspaceId, frameId });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            action: \"removed\",\r\n            eventType: \"window\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowLoaded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            await this.refreshReference();\r\n            const foundWindow = this.getWindow((win) => {\r\n                return win.id && win.id === payload.windowSummary.config.windowId;\r\n            });\r\n            callback(foundWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            action: \"loaded\",\r\n            eventType: \"window\",\r\n            scope: \"workspace\",\r\n            scopeId: id,\r\n            callback: wrappedCallback\r\n        };\r\n\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n}\r\n","import { checkThrowCallback, nonEmptyStringDecoder } from \"../shared//decoders\";\r\nimport { SubscriptionConfig } from \"../types/subscription\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { Row } from \"./row\";\r\nimport { Column } from \"./column\";\r\nimport { Group } from \"./group\";\r\nimport { WindowPrivateData } from \"../types/privateData\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { GDWindow } from \"../types/glue\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Window, PrivateData>();\r\n\r\nconst getData = (model: Window): WindowPrivateData => {\r\n    return data.get(model).manager.getWindowData(model);\r\n};\r\n\r\nexport class Window implements Glue42Workspaces.WorkspaceWindow {\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public get id(): string {\r\n        return getData(this).config.windowId;\r\n    }\r\n\r\n    public get type(): \"window\" {\r\n        return \"window\";\r\n    }\r\n\r\n    public get frameId(): string {\r\n        return getData(this).frame.id;\r\n    }\r\n\r\n    public get workspaceId(): string {\r\n        return getData(this).workspace.id;\r\n    }\r\n\r\n    public get positionIndex(): number {\r\n        return getData(this).config.positionIndex;\r\n    }\r\n\r\n    public get isMaximized(): boolean {\r\n        return getData(this).config.isMaximized;\r\n    }\r\n\r\n    public get isLoaded(): boolean {\r\n        return getData(this).controller.checkIsWindowLoaded(this.id);\r\n    }\r\n\r\n    public get focused(): boolean {\r\n        return getData(this).config.isFocused;\r\n    }\r\n\r\n    public get title(): string {\r\n        return getData(this).config.title;\r\n    }\r\n\r\n    public get workspace(): Glue42Workspaces.Workspace {\r\n        return getData(this).workspace;\r\n    }\r\n\r\n    public get frame(): Glue42Workspaces.Frame {\r\n        return getData(this).frame;\r\n    }\r\n\r\n    public get parent(): Glue42Workspaces.Workspace | Glue42Workspaces.Workspace | Row | Column | Group {\r\n        return getData(this).parent;\r\n    }\r\n\r\n    public get appName(): string {\r\n        return getData(this).config.appName;\r\n    }\r\n\r\n    public async forceLoad(): Promise<void> {\r\n        if (this.isLoaded) {\r\n            return;\r\n        }\r\n        const controller = getData(this).controller;\r\n        const itemId = getData(this).id;\r\n\r\n        const windowId = await controller.forceLoadWindow(itemId);\r\n\r\n        getData(this).config.windowId = windowId;\r\n    }\r\n\r\n    public async focus(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.focusItem(id);\r\n    }\r\n\r\n    public async close(): Promise<void> {\r\n\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.closeItem(id);\r\n\r\n        await getData(this)\r\n            .parent\r\n            .removeChild((child) => child.id === id);\r\n    }\r\n\r\n    public async setTitle(title: string): Promise<void> {\r\n        nonEmptyStringDecoder.runWithException(title);\r\n\r\n        const itemId = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.setItemTitle(itemId, title);\r\n    }\r\n\r\n    public async maximize(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.maximizeItem(id);\r\n    }\r\n\r\n    public async restore(): Promise<void> {\r\n        const id = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        await controller.restoreItem(id);\r\n    }\r\n\r\n    public async eject(): Promise<GDWindow> {\r\n        if (!this.isLoaded) {\r\n            throw new Error(\"Cannot eject this window, because it is not loaded yet\");\r\n        }\r\n        const itemId: string = getData(this).id;\r\n\r\n        const newWindowId: string = await getData(this).controller.ejectWindow(itemId);\r\n\r\n        getData(this).config.windowId = newWindowId;\r\n\r\n        return this.getGdWindow();\r\n    }\r\n\r\n    public getGdWindow(): GDWindow {\r\n\r\n        if (!this.isLoaded) {\r\n            throw new Error(\"Cannot fetch this GD window, because the window is not yet loaded\");\r\n        }\r\n\r\n        const myId = getData(this).config.windowId;\r\n        const controller = getData(this).controller;\r\n\r\n        return controller.getGDWindow(myId);\r\n    }\r\n\r\n    public async moveTo(parent: Row | Column | Group): Promise<void> {\r\n        if (!(parent instanceof Row || parent instanceof Column || parent instanceof Group)) {\r\n            throw new Error(\"Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group\");\r\n        }\r\n\r\n        const myId = getData(this).id;\r\n        const controller = getData(this).controller;\r\n\r\n        const foundParent = await controller.getParent((p) => p.id === parent.id);\r\n\r\n        if (!foundParent) {\r\n            throw new Error(\"Cannot move the window to the selected parent, because this parent does not exist.\");\r\n        }\r\n\r\n        return controller.moveWindowTo(myId, parent.id);\r\n    }\r\n\r\n    public async onRemoved(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const id = getData(this).id;\r\n        const wrappedCallback = async (): Promise<void> => {\r\n            await this.workspace.refreshReference();\r\n            callback();\r\n        };\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"removed\",\r\n            eventType: \"window\",\r\n            scope: \"window\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, id);\r\n        return unsubscribe;\r\n    }\r\n}\r\n","import { checkThrowCallback, nonEmptyStringDecoder, restoreWorkspaceConfigDecoder, workspaceDefinitionDecoder, workspaceBuilderCreateConfigDecoder, resizeConfigDecoder, moveConfigDecoder } from \"../shared/decoders\";\r\nimport { SubscriptionConfig } from \"../types/subscription\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { FrameStreamData, WorkspaceStreamData, WindowStreamData } from \"../types/protocol\";\r\nimport { Glue42Workspaces } from \"../../workspaces.d\";\r\nimport { FramePrivateData } from \"../types/privateData\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Frame, PrivateData>();\r\n\r\nconst getData = (model: Frame): FramePrivateData => {\r\n    return data.get(model).manager.getFrameData(model);\r\n};\r\n\r\nexport class Frame implements Glue42Workspaces.Frame {\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public get id(): string {\r\n        return getData(this).summary.id;\r\n    }\r\n\r\n    public resize(config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        const validatedConfig = resizeConfigDecoder.runWithException(config);\r\n        const myId = getData(this).summary.id;\r\n\r\n        return getData(this).controller.resizeItem(myId, validatedConfig);\r\n    }\r\n\r\n    public move(config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        const validatedConfig = moveConfigDecoder.runWithException(config);\r\n\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.moveFrame(myId, validatedConfig);\r\n    }\r\n\r\n    public focus(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.focusItem(myId);\r\n    }\r\n\r\n    public async state(): Promise<Glue42Workspaces.FrameState> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.getFrameState(myId);\r\n    }\r\n\r\n    public async minimize(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.changeFrameState(myId, \"minimized\");\r\n    }\r\n\r\n    public async maximize(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.changeFrameState(myId, \"maximized\");\r\n    }\r\n\r\n    public async restore(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.changeFrameState(myId, \"normal\");\r\n    }\r\n\r\n    public close(): Promise<void> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.closeItem(myId);\r\n    }\r\n\r\n    public snapshot(): Promise<Glue42Workspaces.FrameSnapshot> {\r\n        const myId = getData(this).summary.id;\r\n        return getData(this).controller.getSnapshot(myId, \"frame\");\r\n    }\r\n\r\n    public async workspaces(): Promise<Glue42Workspaces.Workspace[]> {\r\n        const controller = getData(this).controller;\r\n        return controller.getWorkspaces((wsp) => wsp.frameId === this.id);\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Glue42Workspaces.Workspace> {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        const validatedOptions = restoreWorkspaceConfigDecoder.runWithException(options);\r\n\r\n        return getData(this).controller.restoreWorkspace(name, validatedOptions);\r\n    }\r\n\r\n    public createWorkspace(definition: Glue42Workspaces.WorkspaceDefinition, config?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Glue42Workspaces.Workspace> {\r\n        const validatedDefinition = workspaceDefinitionDecoder.runWithException(definition);\r\n        const validatedConfig = workspaceBuilderCreateConfigDecoder.runWithException(config);\r\n\r\n        return getData(this).controller.createWorkspace(validatedDefinition, validatedConfig);\r\n    }\r\n\r\n    public async onClosed(callback: (closed: { frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (payload: FrameStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"closed\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onMaximized(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (): void => {\r\n            callback();\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"maximized\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onMinimized(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (): void => {\r\n            callback();\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"minimized\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onNormal(callback: () => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (): void => {\r\n            callback();\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"normal\",\r\n            eventType: \"frame\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWorkspaceOpened(callback: (workspace: Glue42Workspaces.Workspace) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WorkspaceStreamData): Promise<void> => {\r\n            const workspace = await getData(this).controller.getWorkspace((wsp) => wsp.id === payload.workspaceSummary.id);\r\n            callback(workspace);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"opened\",\r\n            eventType: \"workspace\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWorkspaceSelected(callback: (workspace: Glue42Workspaces.Workspace) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WorkspaceStreamData): Promise<void> => {\r\n            const workspace = await getData(this).controller.getWorkspace((wsp) => wsp.id === payload.workspaceSummary.id);\r\n            callback(workspace);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"selected\",\r\n            eventType: \"workspace\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWorkspaceClosed(callback: (closed: { frameId: string; workspaceId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (payload: WorkspaceStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id, workspaceId: payload.workspaceSummary.id });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"closed\",\r\n            eventType: \"workspace\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowAdded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const foundParent = await getData(this).controller.getParent((parent) => parent.id === payload.windowSummary.parentId);\r\n            const foundWindow = foundParent.children.find((child) => child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex);\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"added\",\r\n            eventType: \"window\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowRemoved(callback: (removed: { windowId?: string; workspaceId: string; frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = (payload: WindowStreamData): void => {\r\n            const { windowId, workspaceId, frameId } = payload.windowSummary.config;\r\n            callback({ windowId, workspaceId, frameId });\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"removed\",\r\n            eventType: \"window\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n\r\n    public async onWindowLoaded(callback: (window: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> {\r\n        checkThrowCallback(callback);\r\n        const myId = getData(this).summary.id;\r\n\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const foundParent = await getData(this).controller.getParent((parent) => {\r\n                return parent.id === payload.windowSummary.parentId;\r\n            });\r\n            const foundWindow = foundParent.children.find((child) => child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex);\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n\r\n        const config: SubscriptionConfig = {\r\n            callback: wrappedCallback,\r\n            action: \"loaded\",\r\n            eventType: \"window\",\r\n            scope: \"frame\"\r\n        };\r\n        const unsubscribe = await getData(this).controller.processLocalSubscription(config, myId);\r\n        return unsubscribe;\r\n    }\r\n}\r\n","import { Row } from \"../models/row\";\r\nimport { Column } from \"../models/column\";\r\nimport { Group } from \"../models/group\";\r\nimport { ParentPrivateData, WorkspacePrivateData, WindowPrivateData, FramePrivateData, RemapChildData, RemapWorkspaceData } from \"../types/privateData\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { Window } from \"../models/window\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { SwimlaneWindowSnapshotConfig, ParentSnapshotConfig, FrameSummaryResult } from \"../types/protocol\";\r\nimport { Child } from \"../types/builders\";\r\n\r\nexport class PrivateDataManager {\r\n    private readonly parentsData = new WeakMap<Row | Column | Group, ParentPrivateData>();\r\n    private readonly workspacesData = new WeakMap<Workspace, WorkspacePrivateData>();\r\n    private readonly windowsData = new WeakMap<Window, WindowPrivateData>();\r\n    private readonly framesData = new WeakMap<Frame, FramePrivateData>();\r\n    // Without this collection there is no way to get a window instance before its loaded\r\n    // e.g addWindow returns a window however this window doesn't have a placement id needed for force load\r\n    private readonly windowPlacementIdData: { [key: string]: Window } = {};\r\n\r\n    public deleteData<T>(model: T): void {\r\n        if (model instanceof Window) {\r\n            const keyForDeleting =\r\n                Object.keys(this.windowPlacementIdData)\r\n                    .find((k) => this.windowPlacementIdData[k] === model);\r\n\r\n            if (keyForDeleting) {\r\n                delete this.windowPlacementIdData[keyForDeleting];\r\n            }\r\n\r\n            this.windowsData.delete(model);\r\n        }\r\n\r\n        if (model instanceof Workspace) {\r\n            this.workspacesData.delete(model);\r\n        }\r\n\r\n        if (model instanceof Row || model instanceof Column || model instanceof Group) {\r\n            this.parentsData.delete(model);\r\n        }\r\n\r\n        if (model instanceof Frame) {\r\n            this.framesData.delete(model);\r\n        }\r\n    }\r\n\r\n    public setWindowData(model: Window, data: WindowPrivateData): void {\r\n\r\n        this.windowPlacementIdData[data.id] = model;\r\n        this.windowsData.set(model, data);\r\n    }\r\n\r\n    public setWorkspaceData(model: Workspace, data: WorkspacePrivateData): void {\r\n        this.workspacesData.set(model, data);\r\n    }\r\n\r\n    public setParentData(model: Row | Column | Group, data: ParentPrivateData): void {\r\n        this.parentsData.set(model, data);\r\n    }\r\n\r\n    public setFrameData(model: Frame, data: FramePrivateData): void {\r\n        this.framesData.set(model, data);\r\n    }\r\n\r\n    public getWindowData(model: Window): WindowPrivateData {\r\n        return this.windowsData.get(model);\r\n    }\r\n\r\n    public getWindowByPlacementId(placementId: string): Window {\r\n        return this.windowPlacementIdData[placementId];\r\n    }\r\n\r\n    public getWorkspaceData(model: Workspace): WorkspacePrivateData {\r\n        return this.workspacesData.get(model);\r\n    }\r\n\r\n    public getParentData(model: Row | Column | Group): ParentPrivateData {\r\n        return this.parentsData.get(model);\r\n    }\r\n\r\n    public getFrameData(model: Frame): FramePrivateData {\r\n        return this.framesData.get(model);\r\n    }\r\n\r\n    public remapChild(model: Child, newData: RemapChildData): void {\r\n        if (model instanceof Window) {\r\n            const data = this.windowsData.get(model);\r\n            data.parent = newData.parent || data.parent;\r\n            data.config = newData.config as SwimlaneWindowSnapshotConfig || data.config;\r\n        }\r\n\r\n        if (model instanceof Row || model instanceof Column || model instanceof Group) {\r\n            const data = this.parentsData.get(model);\r\n            data.parent = newData.parent || data.parent;\r\n            data.config = newData.config as ParentSnapshotConfig || data.config;\r\n            data.children = newData.children || data.children;\r\n        }\r\n    }\r\n\r\n    public remapFrame(model: Frame, newData: FrameSummaryResult): void {\r\n        const data = this.framesData.get(model);\r\n        data.summary = newData;\r\n    }\r\n\r\n    public remapWorkspace(model: Workspace, newData: RemapWorkspaceData): void {\r\n        const data = this.workspacesData.get(model);\r\n        data.frame = newData.frame || data.frame;\r\n        data.config = newData.config || data.config;\r\n        data.children = newData.children || data.children;\r\n    }\r\n}\r\n","import { Workspace } from \"../workspace\";\r\nimport { ParentBuilder } from \"../../builders/parentBuilder\";\r\nimport { strictParentDefinitionDecoder, swimlaneWindowDefinitionDecoder, checkThrowCallback } from \"../../shared/decoders\";\r\nimport { SubParent, AllParentTypes, Child, SubParentTypes, AllParent } from \"../../types/builders\";\r\nimport { PrivateDataManager } from \"../../shared/privateDataManager\";\r\nimport { ParentPrivateData, WorkspacePrivateData } from \"../../types/privateData\";\r\nimport { Window } from \"../../models/window\";\r\nimport { Glue42Workspaces } from \"../../../workspaces\";\r\n\r\ninterface PrivateData {\r\n    manager: PrivateDataManager;\r\n}\r\n\r\nconst data = new WeakMap<Base, PrivateData>();\r\n\r\nconst getData = (base: Base, model: AllParentTypes): WorkspacePrivateData | ParentPrivateData => {\r\n    const manager = data.get(base).manager;\r\n\r\n    if (model instanceof Workspace) {\r\n        return manager.getWorkspaceData(model);\r\n    }\r\n\r\n    return data.get(base).manager.getParentData(model);\r\n};\r\n\r\nconst getWindowFromPlacementId = (base: Base, placemenId: string): Window => {\r\n    const manager = data.get(base).manager;\r\n\r\n    return manager.getWindowByPlacementId(placemenId);\r\n};\r\n\r\nexport class Base {\r\n    public frameId: string;\r\n    public workspaceId: string;\r\n    public positionIndex: number;\r\n\r\n    constructor(dataManager: PrivateDataManager) {\r\n        data.set(this, { manager: dataManager });\r\n    }\r\n\r\n    public getId(model: AllParentTypes): string {\r\n        return getData(this, model).id;\r\n    }\r\n\r\n    public getPositionIndex(model: AllParentTypes): number {\r\n        return getData(this, model).config.positionIndex;\r\n    }\r\n\r\n    public getWorkspaceId(model: AllParentTypes): string {\r\n        const privateData = getData(this, model) as ParentPrivateData;\r\n        return privateData.config.workspaceId || privateData.workspace.id;\r\n    }\r\n\r\n    public getFrameId(model: AllParentTypes): string {\r\n        return getData(this, model).frame.id;\r\n    }\r\n\r\n    public getAllChildren(model: AllParentTypes, predicate?: (child: Child) => boolean): Child[] {\r\n        checkThrowCallback(predicate, true);\r\n        const children = getData(this, model).children;\r\n\r\n        if (typeof predicate === \"undefined\") {\r\n            return children;\r\n        }\r\n\r\n        return children.filter(predicate);\r\n    }\r\n\r\n    public getMyParent(model: AllParentTypes): AllParentTypes {\r\n        if (model instanceof Workspace) {\r\n            return;\r\n        }\r\n        return (getData(this, model) as ParentPrivateData).parent;\r\n    }\r\n\r\n    public getMyFrame(model: AllParentTypes): Glue42Workspaces.Frame {\r\n        return getData(this, model).frame;\r\n    }\r\n\r\n    public getMyWorkspace(model: AllParentTypes): Workspace {\r\n        if (model instanceof Workspace) {\r\n            return;\r\n        }\r\n        return (getData(this, model) as ParentPrivateData).workspace;\r\n    }\r\n\r\n    public async addWindow(model: AllParentTypes, definition: Glue42Workspaces.WorkspaceWindowDefinition, parentType: AllParent): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        if (!definition.appName && !definition.windowId) {\r\n            throw new Error(\"The window definition should contain either an appName or a windowId\");\r\n        }\r\n\r\n        const validatedDefinition = swimlaneWindowDefinitionDecoder.runWithException(definition);\r\n        const controller = getData(this, model).controller;\r\n\r\n        const operationResult = await controller.add(\"window\", getData(this, model).id, parentType, validatedDefinition);\r\n\r\n        if (model instanceof Workspace) {\r\n            await model.refreshReference();\r\n            return getWindowFromPlacementId(this, operationResult.itemId);\r\n        }\r\n\r\n        await this.getMyWorkspace(model).refreshReference();\r\n\r\n        return getWindowFromPlacementId(this, operationResult.itemId);\r\n    }\r\n\r\n    public async addParent<T>(model: AllParentTypes, typeToAdd: SubParent, parentType: AllParent, definition?: Glue42Workspaces.BoxDefinition | ParentBuilder): Promise<T> {\r\n        const parentDefinition = this.transformDefinition(typeToAdd, definition);\r\n        const controller = getData(this, model).controller;\r\n\r\n        const newParentId = (await controller.add(\"container\", getData(this, model).id, parentType, parentDefinition)).itemId;\r\n\r\n        if (model instanceof Workspace) {\r\n            await model.refreshReference();\r\n            return model.getBox((parent) => parent.id === newParentId) as unknown as T;\r\n        }\r\n\r\n        const myWorkspace = this.getMyWorkspace(model);\r\n        await myWorkspace.refreshReference();\r\n\r\n        return myWorkspace.getBox((parent) => parent.id === newParentId) as unknown as T;\r\n    }\r\n\r\n    public async removeChild(model: AllParentTypes, predicate: (child: Child) => boolean): Promise<void> {\r\n        checkThrowCallback(predicate);\r\n        const child = this.getAllChildren(model).find(predicate);\r\n        if (!child) {\r\n            return;\r\n        }\r\n\r\n        await child.close();\r\n\r\n        if (model instanceof Workspace) {\r\n\r\n            await model.refreshReference();\r\n            return;\r\n        }\r\n\r\n        await this.getMyWorkspace(model).refreshReference();\r\n    }\r\n\r\n    public async maximize(model: AllParentTypes): Promise<void> {\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.maximizeItem(getData(this, model).id);\r\n    }\r\n\r\n    public async restore(model: AllParentTypes): Promise<void> {\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.restoreItem(getData(this, model).id);\r\n    }\r\n\r\n    public async close(model: SubParentTypes): Promise<void> {\r\n        const modelData = getData(this, model) as ParentPrivateData;\r\n\r\n        const controller = getData(this, model).controller;\r\n\r\n        await controller.closeItem(modelData.id);\r\n\r\n        if (modelData.parent instanceof Workspace) {\r\n            await modelData.parent.refreshReference();\r\n        } else {\r\n            await this.getMyWorkspace(modelData.parent).refreshReference();\r\n        }\r\n    }\r\n\r\n    private transformDefinition(type: \"group\" | \"row\" | \"column\", definition?: Glue42Workspaces.BoxDefinition | ParentBuilder): Glue42Workspaces.BoxDefinition {\r\n        let parentDefinition: Glue42Workspaces.BoxDefinition;\r\n\r\n        if (typeof definition === \"undefined\") {\r\n            parentDefinition = { type, children: [] };\r\n        } else if (definition instanceof ParentBuilder) {\r\n            parentDefinition = definition.serialize();\r\n        } else {\r\n            if (typeof definition.type === \"undefined\") {\r\n                definition.type = type;\r\n            }\r\n            parentDefinition = strictParentDefinitionDecoder.runWithException(definition);\r\n            parentDefinition.children = parentDefinition.children || [];\r\n        }\r\n\r\n        return parentDefinition;\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { RefreshChildrenConfig } from \"../types/privateData\";\r\nimport { AddItemResult, WorkspaceSnapshotResult, FrameSnapshotResult, IsWindowInSwimlaneResult, WorkspaceCreateConfigProtocol, FrameSummaryResult, WorkspaceSummariesResult, WindowStreamData } from \"../types/protocol\";\r\nimport { Child } from \"../types/builders\";\r\nimport { CoreFrameUtils } from \"../communication/core-frame-utils\";\r\nimport { OPERATIONS } from \"../communication/constants\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { LayoutsAPI, Instance, GDWindow } from \"../types/glue\";\r\nimport { BaseController } from \"./base\";\r\nimport { UnsubscribeFunction } from \"callback-registry\";\r\nimport { SubscriptionConfig, WorkspaceEventAction, WorkspaceEventType } from \"../types/subscription\";\r\n\r\nexport class CoreController implements WorkspacesController {\r\n    constructor(\r\n        private readonly bridge: Bridge,\r\n        private readonly frameUtils: CoreFrameUtils,\r\n        private readonly layouts: LayoutsAPI,\r\n        private readonly base: BaseController\r\n    ) { }\r\n\r\n    public checkIsWindowLoaded(windowId: string): boolean {\r\n        return this.base.checkIsWindowLoaded(windowId);\r\n    }\r\n\r\n    public async checkIsInSwimlane(windowId: string): Promise<boolean> {\r\n\r\n        const allFrames = await this.frameUtils.getAllFrameInstances();\r\n\r\n        if (!allFrames.length) {\r\n            return false;\r\n        }\r\n\r\n        const allResults = await Promise\r\n            .all(allFrames.map((frameInstance) => this.bridge.send<IsWindowInSwimlaneResult>(OPERATIONS.isWindowInWorkspace.name, { itemId: windowId }, frameInstance)));\r\n\r\n        return allResults.some((result) => result.inWorkspace);\r\n    }\r\n\r\n    public async createWorkspace(definition: Glue42Workspaces.WorkspaceDefinition, saveConfig?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Workspace> {\r\n        const createConfig: WorkspaceCreateConfigProtocol = Object.assign({}, definition, { saveConfig });\r\n\r\n        const frameInstanceConfig = {\r\n            frameId: definition.frame?.reuseFrameId,\r\n            newFrame: definition.frame?.newFrame\r\n        };\r\n\r\n        const frameInstance = await this.frameUtils.getFrameInstance(frameInstanceConfig);\r\n\r\n        const workspace = await this.base.createWorkspace(createConfig, frameInstance);\r\n\r\n        await this.frameUtils.focusFrame(frameInstance);\r\n\r\n        return workspace;\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Workspace> {\r\n        const allLayouts = await this.getLayoutSummaries();\r\n\r\n        const layoutExists = allLayouts.some((summary) => summary.name === name);\r\n\r\n        if (!layoutExists) {\r\n            throw new Error(`This layout: ${name} cannot be restored, because it doesn't exist.`);\r\n        }\r\n\r\n        const frameInstance: Instance = await this.frameUtils.getFrameInstance({ frameId: options?.frameId, newFrame: options?.newFrame });\r\n\r\n        const workspace = await this.base.restoreWorkspace(name, options, frameInstance);\r\n\r\n        await this.frameUtils.focusFrame(frameInstance);\r\n\r\n        return workspace;\r\n    }\r\n\r\n    public async add(type: \"container\" | \"window\", parentId: string, parentType: \"row\" | \"column\" | \"group\" | \"workspace\", definition: Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition): Promise<AddItemResult> {\r\n\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(parentId);\r\n\r\n        return await this.base.add(type, parentId, parentType, definition, frameInstance);\r\n    }\r\n\r\n    public async processLocalSubscription(config: SubscriptionConfig, levelId: string): Promise<Glue42Workspaces.Unsubscribe> {\r\n        await this.bridge.createCoreEventMethod();\r\n\r\n        config.scopeId = config.scopeId || levelId;\r\n\r\n        if (config.eventType === \"window\" && config.action === \"loaded\") {\r\n            const originalCB = config.callback;\r\n\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n\r\n                originalCB(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.handleCoreSubscription(config);\r\n    }\r\n\r\n    public async processGlobalSubscription(callback: (callbackData: unknown) => void, eventType: WorkspaceEventType, action: WorkspaceEventAction): Promise<Glue42Workspaces.Unsubscribe> {\r\n        await this.bridge.createCoreEventMethod();\r\n\r\n        const config: SubscriptionConfig = {\r\n            eventType, callback, action,\r\n            scope: \"global\",\r\n        };\r\n\r\n        if (eventType === \"window\" && action === \"loaded\") {\r\n            const wrappedCB = async (callbackData: WindowStreamData): Promise<void> => {\r\n\r\n                await this.base.notifyWindowAdded(callbackData.windowSummary.config.windowId);\r\n\r\n                callback(callbackData);\r\n            };\r\n\r\n            config.callback = wrappedCB;\r\n        }\r\n\r\n        return this.bridge.handleCoreSubscription(config);\r\n    }\r\n\r\n    public async getFrame(selector: { windowId?: string; predicate?: (frame: Glue42Workspaces.Frame) => boolean }): Promise<Glue42Workspaces.Frame> {\r\n\r\n        if (selector.windowId) {\r\n            const frameInstance = await this.frameUtils.getFrameInstanceByItemId(selector.windowId);\r\n\r\n            return await this.base.getFrame(selector.windowId, frameInstance);\r\n        }\r\n\r\n        if (selector.predicate) {\r\n            return (await this.getFrames(selector.predicate))[0];\r\n        }\r\n\r\n        throw new Error(`The provided selector is not valid: ${JSON.stringify(selector)}`);\r\n\r\n    }\r\n\r\n    public async getFrames(predicate?: (frame: Glue42Workspaces.Frame) => boolean): Promise<Glue42Workspaces.Frame[]> {\r\n\r\n        const allFrameInstances = await this.frameUtils.getAllFrameInstances();\r\n\r\n        const validSummaries: FrameSummaryResult[] = [];\r\n\r\n        for (const frame of allFrameInstances) {\r\n            try {\r\n                const summary = await this.bridge.send<FrameSummaryResult>(OPERATIONS.getFrameSummary.name, { itemId: frame.peerId }, frame);\r\n                validSummaries.push(summary);\r\n            } catch (error) {\r\n                continue;\r\n            }\r\n        }\r\n\r\n        return this.base.getFrames(validSummaries, predicate);\r\n\r\n    }\r\n\r\n    public async getWorkspace(predicate: (workspace: Workspace) => boolean): Promise<Workspace> {\r\n        let foundWorkspace: Workspace;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            if (predicate(wsp)) {\r\n                foundWorkspace = wsp;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return foundWorkspace;\r\n    }\r\n\r\n    public async getWorkspaces(predicate?: (workspace: Workspace) => boolean): Promise<Workspace[]> {\r\n        const matchingWorkspaces: Workspace[] = [] as Workspace[];\r\n\r\n        await this.iterateWorkspaces((wsp) => {\r\n            if (!predicate || predicate(wsp)) {\r\n                matchingWorkspaces.push(wsp);\r\n            }\r\n        });\r\n\r\n        return matchingWorkspaces;\r\n    }\r\n\r\n    public async getAllWorkspaceSummaries(): Promise<Glue42Workspaces.WorkspaceSummary[]> {\r\n        const allFrames = await this.frameUtils.getAllFrameInstances();\r\n\r\n        const allResults = await Promise.all(allFrames.map((frame) => this.bridge.send<WorkspaceSummariesResult>(OPERATIONS.getAllWorkspacesSummaries.name, {}, frame)));\r\n\r\n        return this.base.getAllWorkspaceSummaries(...allResults);\r\n    }\r\n\r\n    public async getWindow(predicate: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => boolean): Promise<Glue42Workspaces.WorkspaceWindow> {\r\n        let resultWindow: Glue42Workspaces.WorkspaceWindow;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            const foundWindow = wsp.getWindow(predicate);\r\n\r\n            if (foundWindow) {\r\n                resultWindow = foundWindow;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return resultWindow;\r\n    }\r\n\r\n    public async getParent(predicate: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Promise<Glue42Workspaces.WorkspaceBox> {\r\n        let resultParent: Glue42Workspaces.WorkspaceBox;\r\n\r\n        await this.iterateWorkspaces((wsp, end) => {\r\n            const foundParent = wsp.getBox(predicate);\r\n\r\n            if (foundParent) {\r\n                resultParent = foundParent;\r\n                end();\r\n            }\r\n        });\r\n\r\n        return resultParent;\r\n    }\r\n\r\n    public async getLayoutSummaries(): Promise<Glue42Workspaces.WorkspaceLayoutSummary[]> {\r\n        const layouts = await this.layouts.getAll(\"Workspace\");\r\n        return layouts.map((layout) => {\r\n            return {\r\n                name: layout.name\r\n            };\r\n        });\r\n    }\r\n\r\n    public async deleteLayout(name: string): Promise<void> {\r\n        await this.layouts.remove(\"Workspace\", name);\r\n    }\r\n\r\n    public async exportLayout(predicate?: (layout: Glue42Workspaces.WorkspaceLayout) => boolean): Promise<Glue42Workspaces.WorkspaceLayout[]> {\r\n        const allLayouts = await this.layouts.export(\"Workspace\");\r\n\r\n        return allLayouts.reduce<Glue42Workspaces.WorkspaceLayout[]>((matchingLayouts, layout) => {\r\n\r\n            if (!predicate || predicate(layout)) {\r\n                matchingLayouts.push(layout);\r\n            }\r\n\r\n            return matchingLayouts;\r\n        }, []);\r\n    }\r\n\r\n    public async importLayout(layouts: Glue42Workspaces.WorkspaceLayout[]): Promise<void> {\r\n        await this.layouts.import(layouts);\r\n    }\r\n\r\n    public async saveLayout(config: Glue42Workspaces.WorkspaceLayoutSaveConfig): Promise<Glue42Workspaces.WorkspaceLayout> {\r\n\r\n        const framesCount = (await this.frameUtils.getAllFrameInstances()).length;\r\n\r\n        if (!framesCount) {\r\n            throw new Error(`Cannot save the layout with config: ${JSON.stringify(config)}, because no active frames were found`);\r\n        }\r\n\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(config.workspaceId);\r\n\r\n        return await this.bridge.send<Glue42Workspaces.WorkspaceLayout>(OPERATIONS.saveLayout.name, config, frameInstance);\r\n    }\r\n\r\n    public handleOnSaved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        return this.base.handleOnSaved(callback);\r\n    }\r\n\r\n    public handleOnRemoved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        return this.base.handleOnRemoved(callback);\r\n    }\r\n\r\n    public async bundleTo(type: \"row\" | \"column\", workspaceId: string): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(workspaceId);\r\n\r\n        return await this.base.bundleTo(type, workspaceId, frameInstance);\r\n    }\r\n\r\n    public getWorkspaceContext(workspaceId: string): Promise<any> {\r\n        return this.base.getWorkspaceContext(workspaceId);\r\n    }\r\n\r\n    public setWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        return this.base.setWorkspaceContext(workspaceId, data);\r\n    }\r\n\r\n    public updateWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        return this.base.updateWorkspaceContext(workspaceId, data);\r\n    }\r\n\r\n    public subscribeWorkspaceContextUpdated(workspaceId: string, callback: (data: any) => void): Promise<import(\"callback-registry\").UnsubscribeFunction> {\r\n        return this.base.subscribeWorkspaceContextUpdated(workspaceId, callback);\r\n    }\r\n\r\n    public async restoreItem(itemId: string): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        await this.base.restoreItem(itemId, frameInstance);\r\n    }\r\n\r\n    public async maximizeItem(itemId: string): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        await this.base.maximizeItem(itemId, frameInstance);\r\n    }\r\n\r\n    public async focusItem(itemId: string): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        await this.base.focusItem(itemId, frameInstance);\r\n    }\r\n\r\n    public changeFrameState(): Promise<void> {\r\n        throw new Error(\"Changing the frame state is not supported in Glue42 Core\");\r\n    }\r\n\r\n    public async getFrameState(): Promise<Glue42Workspaces.FrameState> {\r\n        throw new Error(\"Frame state is not supported in Glue42 Core\");\r\n    }\r\n\r\n    public async closeItem(itemId: string): Promise<void> {\r\n\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        const isItemFrame = itemId === frameInstance.peerId;\r\n\r\n        return isItemFrame ? this.frameUtils.closeFrame(frameInstance) : this.base.closeItem(itemId, frameInstance);\r\n    }\r\n\r\n    public async resizeItem(itemId: string, config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        await this.base.resizeItem(itemId, config, frameInstance);\r\n\r\n        await this.frameUtils.resizeFrame(itemId, config);\r\n    }\r\n\r\n    public async moveFrame(itemId: string, config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        await this.base.moveFrame(itemId, config, frameInstance);\r\n\r\n        await this.frameUtils.moveFrame(itemId, config);\r\n    }\r\n\r\n    public getGDWindow(itemId: string): GDWindow {\r\n        return this.base.getGDWindow(itemId);\r\n    }\r\n\r\n    public async forceLoadWindow(itemId: string): Promise<string> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        const windowId = await this.base.forceLoadWindow(itemId, frameInstance);\r\n\r\n        await this.base.notifyWindowAdded(windowId);\r\n\r\n        return windowId;\r\n    }\r\n\r\n    public async ejectWindow(itemId: string): Promise<string> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        const windowId: string = (await this.base.ejectWindow(itemId, frameInstance)).windowId;\r\n\r\n        await this.base.notifyWindowAdded(windowId);\r\n\r\n        return windowId;\r\n    }\r\n\r\n    public async moveWindowTo(itemId: string, newParentId: string): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        return await this.base.moveWindowTo(itemId, newParentId, frameInstance);\r\n    }\r\n\r\n    public async getSnapshot(itemId: string, type: \"workspace\" | \"frame\"): Promise<WorkspaceSnapshotResult | FrameSnapshotResult> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        return await this.base.getSnapshot(itemId, type, frameInstance);\r\n    }\r\n\r\n    public async setItemTitle(itemId: string, title: string): Promise<void> {\r\n        const frameInstance = await this.frameUtils.getFrameInstanceByItemId(itemId);\r\n\r\n        return await this.base.setItemTitle(itemId, title, frameInstance);\r\n    }\r\n\r\n    public refreshChildren(config: RefreshChildrenConfig): Child[] {\r\n        return this.base.refreshChildren(config);\r\n    }\r\n\r\n    public iterateFindChild(children: Child[], predicate: (child: Child) => boolean): Child {\r\n        return this.base.iterateFindChild(children, predicate);\r\n    }\r\n\r\n    public iterateFilterChildren(children: Child[], predicate: (child: Child) => boolean): Child[] {\r\n        return this.base.iterateFilterChildren(children, predicate);\r\n    }\r\n\r\n    private async iterateWorkspaces(callback: (workspace: Workspace, end: () => void) => void): Promise<void> {\r\n        let ended = false;\r\n\r\n        const end = (): void => { ended = true; };\r\n\r\n        const workspaceSummaries = await this.getAllWorkspaceSummaries();\r\n\r\n        for (const summary of workspaceSummaries) {\r\n            if (ended) {\r\n                return;\r\n            }\r\n\r\n            const frameInstance = await this.frameUtils.getFrameInstance({ frameId: summary.frameId });\r\n\r\n            const wsp = await this.base.fetchWorkspace(summary.id, frameInstance);\r\n\r\n            callback(wsp, end);\r\n        }\r\n    }\r\n}","import { METHODS, OPERATIONS } from \"./constants\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { Bridge } from \"./bridge\";\r\nimport { FrameSummaryResult, PingResult } from \"../types/protocol\";\r\nimport { WindowsAPI, Instance, GDWindow, InteropAPI } from \"../types/glue\";\r\nimport { promisePlus } from \"../shared/promisePlus\";\r\n\r\nexport class CoreFrameUtils {\r\n\r\n    private readonly workspacesRoute: string;\r\n    private readonly workspacesIndex = \"/workspaces/\";\r\n    private readonly defaultAssetsBase = \"/glue\";\r\n    private readonly defaultWidth = 1280;\r\n    private readonly defaultHeight = 720;\r\n\r\n    constructor(\r\n        private readonly interop: InteropAPI,\r\n        private readonly windows: WindowsAPI,\r\n        private readonly bridge: Bridge,\r\n        private readonly assetsBaseLocation: string\r\n    ) {\r\n        const inCsbSuffix = location.href.includes(\"csb.app\") ? \"/index.html\" : \"\";\r\n        this.workspacesRoute = `${this.assetsBaseLocation || this.defaultAssetsBase}${this.workspacesIndex}${inCsbSuffix}`;\r\n    }\r\n\r\n    public async getAllFrameInstances(): Promise<Instance[]> {\r\n\r\n        const potentialFrames = this.interop.servers()\r\n            .filter((server) => {\r\n                if (server?.getMethods) {\r\n                    return server.getMethods()?.some((method) => method.name === METHODS.control.name);\r\n                }\r\n            });\r\n\r\n        const readyFrames: Instance[] = [];\r\n\r\n        for (const inst of potentialFrames) {\r\n            try {\r\n                const pingResult = await promisePlus<PingResult>(() => this.bridge.send<PingResult>(OPERATIONS.ping.name, undefined, inst), 3000);\r\n                if (pingResult.live) {\r\n                    readyFrames.push(inst);\r\n                }\r\n            } catch (error) {\r\n                continue;\r\n            }\r\n        }\r\n\r\n        return readyFrames;\r\n    }\r\n\r\n    public async focusFrame(frame: Instance): Promise<void> {\r\n        const coreWindow = this.windows.list().find((w) => w.id === frame.windowId);\r\n        await coreWindow.focus();\r\n    }\r\n\r\n    public async getFrameInstance(config?: { frameId?: string; newFrame?: Glue42Workspaces.NewFrameConfig | boolean }): Promise<Instance> {\r\n\r\n        if (config?.frameId && config?.newFrame) {\r\n            throw new Error(\"Cannot retrieve the frame, because of over-specification: both frameId and newFrame were provided.\");\r\n        }\r\n\r\n        const frames = await this.getAllFrameInstances();\r\n\r\n        if (config?.frameId) {\r\n            const foundFrame = frames.find((frame) => frame.peerId === config.frameId);\r\n\r\n            if (!foundFrame) {\r\n                throw new Error(`Frame with id: ${config.frameId} was not found`);\r\n            }\r\n\r\n            return foundFrame;\r\n        }\r\n\r\n        if (config?.newFrame) {\r\n            return this.openNewWorkspacesFrame(config.newFrame);\r\n        }\r\n\r\n        return frames.length ? this.getLastFrameInteropInstance() : this.openNewWorkspacesFrame();\r\n    }\r\n\r\n    public async getFrameInstanceByItemId(itemId: string): Promise<Instance> {\r\n        const frames = await this.getAllFrameInstances();\r\n\r\n        if (!frames.length) {\r\n            throw new Error(`Cannot get frame by item id for: ${itemId}, because not frames were found`);\r\n        }\r\n\r\n        const queryResult = await Promise.all(frames.map((frame) => this.bridge.send<FrameSummaryResult>(OPERATIONS.getFrameSummary.name, { itemId }, frame)));\r\n\r\n        const foundFrameSummary = queryResult.find((result) => result.id !== \"none\");\r\n\r\n        if (!foundFrameSummary) {\r\n            throw new Error(`Cannot find frame for item: ${itemId}`);\r\n        }\r\n\r\n        const frameInstance = await this.getFrameInstance({ frameId: foundFrameSummary.id });\r\n\r\n        return frameInstance;\r\n    }\r\n\r\n    public async getLastFrameInteropInstance(): Promise<Instance | undefined> {\r\n        const allFrames = await this.getAllFrameInstances();\r\n\r\n        return allFrames.sort((a, b) => {\r\n            const aIncrementor = a?.peerId ? +a.peerId.slice(a.peerId.lastIndexOf(\"-\") + 1) : 0;\r\n            const bIncrementor = b?.peerId ? +b.peerId.slice(b.peerId.lastIndexOf(\"-\") + 1) : 0;\r\n\r\n            return bIncrementor - aIncrementor;\r\n        })[0];\r\n    }\r\n\r\n    public openNewWorkspacesFrame(newFrameConfig?: Glue42Workspaces.NewFrameConfig | boolean): Promise<Instance> {\r\n        return new Promise<Instance>((resolve, reject) => {\r\n\r\n            const rndIncr = Math.random() * (100 - 0) + 0;\r\n\r\n            let frameWindow: GDWindow;\r\n\r\n            const unsubscribe = this.interop.serverMethodAdded((info) => {\r\n\r\n                if (!info?.server || !info?.method) {\r\n                    return;\r\n                }\r\n\r\n                const nameMatch = info.method.name === METHODS.control.name;\r\n                const serverMatch = info.server.windowId === frameWindow?.id;\r\n\r\n                if (frameWindow?.id && nameMatch && serverMatch) {\r\n                    unsubscribe();\r\n                    resolve(info.server);\r\n                }\r\n            });\r\n\r\n            const frameOptions = {\r\n                url: `${this.workspacesRoute}?emptyFrame=true`,\r\n                width: typeof newFrameConfig === \"object\" ? newFrameConfig.bounds?.width || this.defaultWidth : this.defaultWidth,\r\n                height: typeof newFrameConfig === \"object\" ? newFrameConfig.bounds?.height || this.defaultHeight : this.defaultHeight\r\n            };\r\n\r\n            this.windows.open(`frame_${rndIncr + 1}`, frameOptions.url, frameOptions)\r\n                .then((frWin) => {\r\n                    frameWindow = frWin;\r\n\r\n                    const foundServer = this.interop.servers().find((server) => {\r\n\r\n                        const serverMatch = server.windowId === frameWindow.id;\r\n                        const methodMatch = server.getMethods().some((method) => method.name === METHODS.control.name);\r\n\r\n                        return serverMatch && methodMatch;\r\n                    });\r\n\r\n                    if (foundServer) {\r\n                        unsubscribe();\r\n                        resolve(foundServer);\r\n                    }\r\n                })\r\n                .catch(reject);\r\n        });\r\n    }\r\n\r\n    public async closeFrame(frameInstance: Instance): Promise<void> {\r\n        const coreWindow = this.windows.list().find((w) => w.id === frameInstance.windowId);\r\n\r\n        await coreWindow.close();\r\n    }\r\n\r\n    public async moveFrame(frameId: string, config: Glue42Workspaces.MoveConfig): Promise<void> {\r\n        const frameInstance = await this.getFrameInstanceByItemId(frameId);\r\n\r\n        if (frameId !== frameInstance.peerId) {\r\n            return;\r\n        }\r\n\r\n        const coreWindow = this.windows.list().find((w) => w.id === frameInstance.windowId);\r\n\r\n        if (config.relative) {\r\n            await coreWindow.moveTo(config.top, config.left);\r\n            return;\r\n        }\r\n\r\n        await coreWindow.moveResize({ top: config.top, left: config.left });\r\n    }\r\n\r\n    public async resizeFrame(frameId: string, config: Glue42Workspaces.ResizeConfig): Promise<void> {\r\n        const frameInstance = await this.getFrameInstanceByItemId(frameId);\r\n\r\n        if (frameId !== frameInstance.peerId) {\r\n            return;\r\n        }\r\n\r\n        const coreWindow = this.windows.list().find((w) => w.id === frameInstance.windowId);\r\n\r\n        if (config.relative) {\r\n            await coreWindow.resizeTo(config.width, config.height);\r\n            return;\r\n        }\r\n\r\n        await coreWindow.moveResize({ width: config.width, height: config.height });\r\n    }\r\n}","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { WorkspaceSnapshotResult, WorkspaceCreateConfigProtocol, FrameSummaryResult, AddItemResult, WorkspaceSummariesResult, WorkspaceSummaryResult, SimpleWindowOperationSuccessResult, FrameSnapshotResult, SwimlaneWindowSnapshotConfig, ParentSnapshotConfig } from \"../types/protocol\";\r\nimport { OPERATIONS } from \"../communication/constants\";\r\nimport { FrameCreateConfig, WorkspaceIoCCreateConfig, WindowCreateConfig, ParentCreateConfig } from \"../types/ioc\";\r\nimport { IoC } from \"../shared/ioc\";\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { Instance, GDWindow, WindowsAPI, ContextsAPI, LayoutsAPI } from \"../types/glue\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { RefreshChildrenConfig } from \"../types/privateData\";\r\nimport { Child } from \"../types/builders\";\r\nimport { PrivateDataManager } from \"../shared/privateDataManager\";\r\nimport { Window } from \"../models/window\";\r\nimport { UnsubscribeFunction } from \"callback-registry\";\r\n\r\nexport class BaseController {\r\n\r\n    constructor(\r\n        private readonly ioc: IoC,\r\n        private readonly windows: WindowsAPI,\r\n        private readonly contexts: ContextsAPI,\r\n        private readonly layouts: LayoutsAPI,\r\n    ) { }\r\n\r\n    private get bridge(): Bridge {\r\n        return this.ioc.bridge;\r\n    }\r\n\r\n    private get privateDataManager(): PrivateDataManager {\r\n        return this.ioc.privateDataManager;\r\n    }\r\n\r\n    public checkIsWindowLoaded(windowId: string): boolean {\r\n        return windowId && this.windows.list().some((win) => win.id === windowId);\r\n    }\r\n\r\n    public async createWorkspace(createConfig: WorkspaceCreateConfigProtocol, frameInstance?: Instance): Promise<Workspace> {\r\n        const snapshot = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.createWorkspace.name, createConfig, frameInstance);\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: snapshot.frameSummary\r\n        };\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        return this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n    }\r\n\r\n    public async restoreWorkspace(name: string, options: Glue42Workspaces.RestoreWorkspaceConfig, frameInstance?: Instance): Promise<Workspace> {\r\n        const snapshot = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.openWorkspace.name, { name, restoreOptions: options }, frameInstance);\r\n\r\n        const frameSummary = await this.bridge.send<FrameSummaryResult>(OPERATIONS.getFrameSummary.name, { itemId: snapshot.config.frameId }, frameInstance);\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: frameSummary\r\n        };\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        return this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n    }\r\n\r\n    public async add(type: \"container\" | \"window\", parentId: string, parentType: \"row\" | \"column\" | \"group\" | \"workspace\", definition: Glue42Workspaces.WorkspaceWindowDefinition | Glue42Workspaces.BoxDefinition, frameInstance?: Instance): Promise<AddItemResult> {\r\n        let operationName: string;\r\n        const operationArgs = { definition, parentId, parentType };\r\n\r\n        if (type === \"window\") {\r\n            operationName = OPERATIONS.addWindow.name;\r\n        } else if (type === \"container\") {\r\n            operationName = OPERATIONS.addContainer.name;\r\n        } else {\r\n            throw new Error(`Unrecognized add type: ${type}`);\r\n        }\r\n\r\n        return await this.bridge.send<AddItemResult>(operationName, operationArgs, frameInstance);\r\n    }\r\n\r\n    public async getFrame(windowId: string, frameInstance?: Instance): Promise<Frame> {\r\n        const frameSummary = await this.bridge.send<FrameSummaryResult>(OPERATIONS.getFrameSummary.name, { itemId: windowId }, frameInstance);\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: frameSummary\r\n        };\r\n        return this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n    }\r\n\r\n    public getFrames(allFrameSummaries: FrameSummaryResult[], predicate?: (frame: Frame) => boolean): Frame[] {\r\n\r\n        return allFrameSummaries.reduce<Frame[]>((frames, frameSummary) => {\r\n\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: frameSummary\r\n            };\r\n            const frameToCheck = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            if (!predicate || predicate(frameToCheck)) {\r\n                frames.push(frameToCheck);\r\n            }\r\n\r\n            return frames;\r\n        }, []);\r\n    }\r\n\r\n    public getAllWorkspaceSummaries(...bridgeResults: WorkspaceSummariesResult[]): Glue42Workspaces.WorkspaceSummary[] {\r\n\r\n        const allSummaries = bridgeResults.reduce<WorkspaceSummaryResult[]>((summaries, summaryResult) => {\r\n            summaries.push(...summaryResult.summaries);\r\n            return summaries;\r\n        }, []);\r\n\r\n        return allSummaries.map<Glue42Workspaces.WorkspaceSummary>((summary) => {\r\n            return {\r\n                id: summary.id,\r\n                frameId: summary.config.frameId,\r\n                positionIndex: summary.config.positionIndex,\r\n                title: summary.config.title,\r\n                layoutName: summary.config.layoutName\r\n            };\r\n        });\r\n    }\r\n\r\n    public handleOnSaved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        const wrappedCallback = (layout: Glue42Workspaces.WorkspaceLayout): void => {\r\n            if (layout.type !== \"Workspace\") {\r\n                return;\r\n            }\r\n\r\n            callback(layout);\r\n        };\r\n\r\n        const addedUnSub: UnsubscribeFunction = this.layouts.onAdded(wrappedCallback);\r\n        const changedUnSub: UnsubscribeFunction = this.layouts.onChanged(wrappedCallback);\r\n\r\n        return (): void => {\r\n            addedUnSub();\r\n            changedUnSub();\r\n        };\r\n    }\r\n\r\n    public handleOnRemoved(callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): UnsubscribeFunction {\r\n        const wrappedCallback = (layout: Glue42Workspaces.WorkspaceLayout): void => {\r\n            if (layout.type !== \"Workspace\") {\r\n                return;\r\n            }\r\n\r\n            callback(layout);\r\n        };\r\n\r\n        return this.layouts.onRemoved(wrappedCallback);\r\n    }\r\n\r\n    public async fetchWorkspace(workspaceId: string, frameInstance?: Instance): Promise<Workspace> {\r\n\r\n        const snapshot = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.getWorkspaceSnapshot.name, { itemId: workspaceId }, frameInstance);\r\n\r\n        const frameConfig: FrameCreateConfig = {\r\n            summary: snapshot.frameSummary\r\n        };\r\n\r\n        const frame = this.ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n        const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n        return this.ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n    }\r\n\r\n    public async bundleTo(type: \"row\" | \"column\", workspaceId: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.bundleWorkspace.name, { type, workspaceId }, frameInstance);\r\n    }\r\n\r\n    public getWorkspaceContext(workspaceId: string): Promise<any> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.get(contextName);\r\n    }\r\n\r\n    public setWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.set(contextName, data);\r\n    }\r\n\r\n    public updateWorkspaceContext(workspaceId: string, data: any): Promise<void> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.update(contextName, data);\r\n    }\r\n\r\n    public subscribeWorkspaceContextUpdated(workspaceId: string, callback: (data: any) => void): Promise<UnsubscribeFunction> {\r\n        const contextName = `___workspace___${workspaceId}`;\r\n        return this.contexts.subscribe(contextName, callback);\r\n    }\r\n\r\n    public async restoreItem(itemId: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.restoreItem.name, { itemId }, frameInstance);\r\n    }\r\n\r\n    public async maximizeItem(itemId: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.maximizeItem.name, { itemId }, frameInstance);\r\n    }\r\n\r\n    public async focusItem(itemId: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.focusItem.name, { itemId }, frameInstance);\r\n    }\r\n\r\n    public async closeItem(itemId: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.closeItem.name, { itemId }, frameInstance);\r\n    }\r\n\r\n    public async resizeItem(itemId: string, config: Glue42Workspaces.ResizeConfig, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.resizeItem.name, Object.assign({}, { itemId }, config), frameInstance);\r\n    }\r\n\r\n    public async moveFrame(itemId: string, config: Glue42Workspaces.MoveConfig, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.moveFrame.name, Object.assign({}, { itemId }, config), frameInstance);\r\n    }\r\n\r\n    public getGDWindow(itemId: string): GDWindow {\r\n        return this.windows.list().find((gdWindow) => gdWindow.id === itemId);\r\n    }\r\n\r\n    public async forceLoadWindow(itemId: string, frameInstance?: Instance): Promise<string> {\r\n        const controlResult = await this.bridge.send<SimpleWindowOperationSuccessResult>(OPERATIONS.forceLoadWindow.name, { itemId }, frameInstance);\r\n\r\n        return controlResult.windowId;\r\n    }\r\n\r\n    public async ejectWindow(itemId: string, frameInstance?: Instance): Promise<SimpleWindowOperationSuccessResult> {\r\n        return await this.bridge.send<SimpleWindowOperationSuccessResult>(OPERATIONS.ejectWindow.name, { itemId }, frameInstance);\r\n    }\r\n\r\n    public async moveWindowTo(itemId: string, newParentId: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.moveWindowTo.name, { itemId, containerId: newParentId }, frameInstance);\r\n    }\r\n\r\n    public async getSnapshot(itemId: string, type: \"workspace\" | \"frame\", frameInstance?: Instance): Promise<WorkspaceSnapshotResult | FrameSnapshotResult> {\r\n        let result: WorkspaceSnapshotResult | FrameSnapshotResult;\r\n\r\n        if (type === \"workspace\") {\r\n            result = await this.bridge.send<WorkspaceSnapshotResult>(OPERATIONS.getWorkspaceSnapshot.name, { itemId }, frameInstance);\r\n        } else if (type === \"frame\") {\r\n            result = await this.bridge.send<FrameSnapshotResult>(OPERATIONS.getFrameSnapshot.name, { itemId }, frameInstance);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    public async setItemTitle(itemId: string, title: string, frameInstance?: Instance): Promise<void> {\r\n        await this.bridge.send(OPERATIONS.setItemTitle.name, { itemId, title }, frameInstance);\r\n    }\r\n\r\n    public refreshChildren(config: RefreshChildrenConfig): Child[] {\r\n        const { parent, children, existingChildren, workspace } = config;\r\n        if (parent instanceof Window) {\r\n            return;\r\n        }\r\n\r\n        const newChildren = children.map((newChildSnapshot) => {\r\n            let childToAdd = existingChildren.find((c) => c.id === newChildSnapshot.id);\r\n            const childType = newChildSnapshot.type;\r\n\r\n            if (childToAdd) {\r\n                this.privateDataManager.remapChild(childToAdd, {\r\n                    parent,\r\n                    children: [],\r\n                    config: newChildSnapshot.config\r\n                });\r\n            } else {\r\n                if (childType === \"window\") {\r\n                    const createConfig: WindowCreateConfig = {\r\n                        id: newChildSnapshot.id,\r\n                        parent,\r\n                        frame: workspace.frame,\r\n                        workspace,\r\n                        config: newChildSnapshot.config as SwimlaneWindowSnapshotConfig\r\n                    };\r\n                    childToAdd = this.ioc.getModel<\"child\">(childType, createConfig);\r\n                } else {\r\n                    const createConfig: ParentCreateConfig = {\r\n                        id: newChildSnapshot.id,\r\n                        children: [],\r\n                        parent,\r\n                        frame: workspace.frame,\r\n                        workspace,\r\n                        config: newChildSnapshot.config as ParentSnapshotConfig\r\n                    };\r\n                    childToAdd = this.ioc.getModel<\"child\">(childType, createConfig);\r\n                }\r\n\r\n            }\r\n\r\n            if (childType !== \"window\") {\r\n                this.refreshChildren({\r\n                    workspace, existingChildren,\r\n                    children: newChildSnapshot.children,\r\n                    parent: childToAdd\r\n                });\r\n            }\r\n\r\n            return childToAdd;\r\n        });\r\n\r\n        if (parent instanceof Workspace) {\r\n            return newChildren;\r\n        } else {\r\n            this.privateDataManager.remapChild(parent, { children: newChildren });\r\n            return newChildren;\r\n        }\r\n    }\r\n\r\n    public iterateFindChild(children: Child[], predicate: (child: Child) => boolean): Child {\r\n        let foundChild = children.find((child) => predicate(child));\r\n\r\n        if (foundChild) {\r\n            return foundChild;\r\n        }\r\n\r\n        children.some((child) => {\r\n            if (child instanceof Window) {\r\n                return false;\r\n            }\r\n\r\n            foundChild = this.iterateFindChild(child.children, predicate);\r\n\r\n            if (foundChild) {\r\n                return true;\r\n            }\r\n        });\r\n\r\n        return foundChild;\r\n    }\r\n\r\n    public iterateFilterChildren(children: Child[], predicate: (child: Child) => boolean): Child[] {\r\n        const foundChildren = children.filter((child) => predicate(child));\r\n\r\n        const grandChildren = children.reduce<Child[]>((innerFound, child) => {\r\n            if (child instanceof Window) {\r\n                return innerFound;\r\n            }\r\n\r\n            innerFound.push(...this.iterateFilterChildren(child.children, predicate));\r\n\r\n            return innerFound;\r\n        }, []);\r\n\r\n        foundChildren.push(...grandChildren);\r\n\r\n        return foundChildren;\r\n    }\r\n\r\n    public notifyWindowAdded(windowId: string): Promise<void> {\r\n        return new Promise((resolve) => {\r\n\r\n            const alreadyPresent: boolean = this.windows.list().some((win) => win.id === windowId);\r\n\r\n            if (alreadyPresent) {\r\n                return resolve();\r\n            }\r\n\r\n            const unsubscribe: UnsubscribeFunction = this.windows.onWindowAdded((win) => {\r\n\r\n                if (win.id !== windowId) {\r\n                    return;\r\n                }\r\n\r\n                if (unsubscribe) {\r\n                    unsubscribe();\r\n                }\r\n\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n}\r\n","/*eslint indent: [2, 4, {\"SwitchCase\": 1}]*/\r\nimport CallbackFactory from \"callback-registry\";\r\nimport { EnterpriseController } from \"../controllers/enterprise\";\r\nimport { Bridge } from \"../communication/bridge\";\r\nimport { InteropTransport } from \"../communication/interop-transport\";\r\nimport { BaseBuilder } from \"../builders/baseBuilder\";\r\nimport { ParentBuilder } from \"../builders/parentBuilder\";\r\nimport { WorkspaceBuilder } from \"../builders/workspaceBuilder\";\r\nimport { ModelMaps, ModelTypes, FramePrivateData, WindowPrivateData, WorkspacePrivateData, ParentPrivateData } from \"../types/privateData\";\r\nimport { PrivateDataManager } from \"./privateDataManager\";\r\nimport { FrameCreateConfig, ModelCreateConfig, WindowCreateConfig, WorkspaceIoCCreateConfig, ParentCreateConfig } from \"../types/ioc\";\r\nimport { Frame } from \"../models/frame\";\r\nimport { Window } from \"../models/window\";\r\nimport { Workspace } from \"../models/workspace\";\r\nimport { ChildSnapshotResult, SwimlaneWindowSnapshotConfig, ParentSnapshotConfig } from \"../types/protocol\";\r\nimport { Child } from \"../types/builders\";\r\nimport { Row } from \"../models/row\";\r\nimport { Column } from \"../models/column\";\r\nimport { Group } from \"../models/group\";\r\nimport { Base } from \"../models/base/base\";\r\nimport { Glue42Workspaces } from \"../../workspaces\";\r\nimport { CoreController } from \"../controllers/core\";\r\nimport { WorkspacesController } from \"../types/controller\";\r\nimport { CoreFrameUtils } from \"../communication/core-frame-utils\";\r\nimport { InteropAPI, WindowsAPI, LayoutsAPI, ContextsAPI } from \"../types/glue\";\r\nimport { BaseController } from \"../controllers/base\";\r\n\r\nexport class IoC {\r\n\r\n    private _controllerInstance: WorkspacesController;\r\n    private _bridgeInstance: Bridge;\r\n    private _transportInstance: InteropTransport;\r\n    private _privateDataManagerInstance: PrivateDataManager;\r\n    private _parentBaseInstance: Base;\r\n    private _baseController: BaseController;\r\n\r\n    constructor(\r\n        private readonly agm: InteropAPI,\r\n        private readonly windows: WindowsAPI,\r\n        private readonly layouts: LayoutsAPI,\r\n        private readonly contexts: ContextsAPI,\r\n        private readonly assetsBaseLocation: string\r\n    ) { }\r\n\r\n    public get baseController(): BaseController {\r\n        if (!this._baseController) {\r\n            this._baseController = new BaseController(this, this.windows, this.contexts, this.layouts);\r\n        }\r\n\r\n        return this._baseController;\r\n    }\r\n\r\n    public get controller(): WorkspacesController {\r\n        if (!this._controllerInstance) {\r\n            this._controllerInstance = window.glue42gd ?\r\n                new EnterpriseController(this.bridge, this.baseController) :\r\n                new CoreController(this.bridge, new CoreFrameUtils(this.agm, this.windows, this.bridge, this.assetsBaseLocation), this.layouts, this.baseController);\r\n        }\r\n        return this._controllerInstance;\r\n    }\r\n\r\n    public get bridge(): Bridge {\r\n        if (!this._bridgeInstance) {\r\n            this._bridgeInstance = new Bridge(this.transport, CallbackFactory());\r\n        }\r\n        return this._bridgeInstance;\r\n    }\r\n\r\n    public get transport(): InteropTransport {\r\n\r\n        if (!this._transportInstance) {\r\n            this._transportInstance = new InteropTransport(this.agm);\r\n        }\r\n\r\n        return this._transportInstance;\r\n    }\r\n\r\n    public get privateDataManager(): PrivateDataManager {\r\n        if (!this._privateDataManagerInstance) {\r\n            this._privateDataManagerInstance = new PrivateDataManager();\r\n        }\r\n        return this._privateDataManagerInstance;\r\n    }\r\n\r\n    public get parentBase(): Base {\r\n        if (!this._parentBaseInstance) {\r\n            this._parentBaseInstance = new Base(this.privateDataManager);\r\n        }\r\n        return this._parentBaseInstance;\r\n    }\r\n\r\n    public async initiate(): Promise<void> {\r\n        await this.transport.initiate();\r\n    }\r\n\r\n    public getModel<T extends ModelTypes>(type: ModelTypes, createConfig: ModelCreateConfig): ModelMaps[T] {\r\n        switch (type) {\r\n            case \"frame\": {\r\n                const newFrame = new Frame(this.privateDataManager);\r\n\r\n                const { summary } = createConfig as FrameCreateConfig;\r\n\r\n                const frameData: FramePrivateData = { summary, controller: this.controller };\r\n\r\n                this.privateDataManager.setFrameData(newFrame, frameData);\r\n\r\n                return newFrame as ModelMaps[T];\r\n            }\r\n            case \"window\": {\r\n                const { id, parent, frame, workspace, config } = createConfig as WindowCreateConfig;\r\n\r\n                const windowPrivateData: WindowPrivateData = {\r\n                    type: \"window\",\r\n                    controller: this.controller,\r\n                    config, id, parent, frame, workspace\r\n                };\r\n\r\n                const newWindow = new Window(this.privateDataManager);\r\n\r\n                this.privateDataManager.setWindowData(newWindow, windowPrivateData);\r\n\r\n                return newWindow as ModelMaps[T];\r\n            }\r\n            case \"row\":\r\n            case \"column\":\r\n            case \"group\": {\r\n                const { id, children, parent, frame, workspace, config } = createConfig as ParentCreateConfig;\r\n\r\n                const newParent = type === \"column\" ? new Column(this.parentBase) :\r\n                    type === \"row\" ? new Row(this.parentBase) : new Group(this.parentBase);\r\n\r\n                const builtChildren = this.buildChildren(children, frame, workspace, newParent);\r\n\r\n                const parentPrivateData: ParentPrivateData = {\r\n                    id, parent, frame, workspace, config, type,\r\n                    controller: this.controller,\r\n                    children: builtChildren,\r\n                };\r\n\r\n                this.privateDataManager.setParentData(newParent, parentPrivateData);\r\n\r\n                return newParent as ModelMaps[T];\r\n            }\r\n            case \"workspace\": {\r\n                const { snapshot, frame } = createConfig as WorkspaceIoCCreateConfig;\r\n\r\n                const newWorkspace = new Workspace(this.privateDataManager);\r\n\r\n                const children = this.buildChildren(snapshot.children, frame, newWorkspace, newWorkspace);\r\n\r\n                const workspacePrivateData: WorkspacePrivateData = {\r\n                    id: snapshot.id,\r\n                    type: \"workspace\",\r\n                    config: snapshot.config,\r\n                    base: this.parentBase,\r\n                    controller: this.controller,\r\n                    children, frame, ioc: this\r\n                };\r\n\r\n                this.privateDataManager.setWorkspaceData(newWorkspace, workspacePrivateData);\r\n                return newWorkspace as ModelMaps[T];\r\n            }\r\n            default: throw new Error(`Unrecognized type: ${type}`);\r\n        }\r\n    }\r\n\r\n    public getBuilder(config: Glue42Workspaces.BuilderConfig): WorkspaceBuilder | ParentBuilder {\r\n        config.definition = config.definition || {};\r\n\r\n        if (!Array.isArray(config.definition.children)) {\r\n            config.definition.children = [];\r\n        }\r\n\r\n        const baseBuilder = new BaseBuilder(this.getBuilder.bind(this));\r\n\r\n        switch (config.type) {\r\n            case \"workspace\": {\r\n                return new WorkspaceBuilder(config.definition as Glue42Workspaces.WorkspaceDefinition, baseBuilder, this.controller);\r\n            }\r\n            case \"row\":\r\n            case \"column\":\r\n            case \"group\": {\r\n                (config.definition as Glue42Workspaces.BoxDefinition).type = config.type;\r\n                return new ParentBuilder(config.definition, baseBuilder);\r\n            }\r\n            default: throw new Error(`Unexpected Builder creation error, provided config: ${JSON.stringify(config)}`);\r\n        }\r\n    }\r\n\r\n    private buildChildren(children: ChildSnapshotResult[], frame: Frame, workspace: Workspace, parent: Workspace | Row | Column | Group): Child[] {\r\n        return children.map<Child>((child) => {\r\n            switch (child.type) {\r\n                case \"window\": return this.getModel<\"window\">(\"window\", {\r\n                    id: child.id,\r\n                    config: child.config as SwimlaneWindowSnapshotConfig,\r\n                    frame, workspace, parent\r\n                });\r\n                case \"column\": return this.getModel<\"column\">(child.type, {\r\n                    id: child.id,\r\n                    config: child.config as ParentSnapshotConfig,\r\n                    children: child.children,\r\n                    frame, workspace, parent\r\n                });\r\n                case \"row\": return this.getModel<\"row\">(child.type, {\r\n                    id: child.id,\r\n                    config: child.config as ParentSnapshotConfig,\r\n                    children: child.children,\r\n                    frame, workspace, parent\r\n                });\r\n                case \"group\": return this.getModel<\"group\">(child.type, {\r\n                    id: child.id,\r\n                    config: child.config as ParentSnapshotConfig,\r\n                    children: child.children,\r\n                    frame, workspace, parent\r\n                });\r\n                default: throw new Error(`Unsupported child type: ${child.type}`);\r\n            }\r\n        });\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport { IoC } from \"./shared/ioc\";\r\nimport { checkThrowCallback, nonEmptyStringDecoder, workspaceLayoutDecoder, workspaceDefinitionDecoder, workspaceBuilderCreateConfigDecoder, builderConfigDecoder, restoreWorkspaceConfigDecoder, workspaceLayoutSaveConfigDecoder } from \"./shared/decoders\";\r\nimport { FrameStreamData, WorkspaceStreamData, WorkspaceSnapshotResult, WindowStreamData } from \"./types/protocol\";\r\nimport { FrameCreateConfig, WorkspaceIoCCreateConfig } from \"./types/ioc\";\r\nimport { Glue42Workspaces } from \"./../workspaces\";\r\nimport { WorkspacesController } from \"./types/controller\";\r\n\r\nexport const composeAPI = (glue: any, ioc: IoC): Glue42Workspaces.API => {\r\n\r\n    const controller: WorkspacesController = ioc.controller;\r\n\r\n    const inWorkspace = (): Promise<boolean> => {\r\n        const myId: string = glue.windows.my().id;\r\n\r\n        if (!myId) {\r\n            throw new Error(\"Cannot get my frame, because my id is undefined.\");\r\n        }\r\n\r\n        return controller.checkIsInSwimlane(myId);\r\n    };\r\n\r\n    const getBuilder = (config: Glue42Workspaces.BuilderConfig): Glue42Workspaces.WorkspaceBuilder | Glue42Workspaces.BoxBuilder => {\r\n        const validatedConfig = builderConfigDecoder.runWithException(config);\r\n\r\n        return ioc.getBuilder(validatedConfig);\r\n    };\r\n\r\n    const getMyFrame = async (): Promise<Glue42Workspaces.Frame> => {\r\n        const windowId: string = glue.windows.my().id;\r\n\r\n        if (!windowId) {\r\n            throw new Error(\"Cannot get my frame, because my id is undefined.\");\r\n        }\r\n\r\n        const isInSwimlane = await controller.checkIsInSwimlane(windowId);\r\n\r\n        if (!isInSwimlane) {\r\n            throw new Error(\"Cannot fetch your frame, because this window is not in a workspace\");\r\n        }\r\n\r\n        return controller.getFrame({ windowId });\r\n    };\r\n\r\n    const getFrame = async (predicate: (frame: Glue42Workspaces.Frame) => boolean): Promise<Glue42Workspaces.Frame> => {\r\n        checkThrowCallback(predicate);\r\n\r\n        return controller.getFrame({ predicate });\r\n    };\r\n\r\n    const getAllFrames = async (predicate?: (frame: Glue42Workspaces.Frame) => boolean): Promise<Glue42Workspaces.Frame[]> => {\r\n        checkThrowCallback(predicate, true);\r\n\r\n        return controller.getFrames(predicate);\r\n    };\r\n\r\n    const getAllWorkspacesSummaries = (): Promise<Glue42Workspaces.WorkspaceSummary[]> => {\r\n        return controller.getAllWorkspaceSummaries();\r\n    };\r\n\r\n    const getMyWorkspace = async (): Promise<Glue42Workspaces.Workspace> => {\r\n        const myId: string = glue.windows.my().id;\r\n\r\n        if (!myId) {\r\n            throw new Error(\"Cannot get my workspace, because my id is undefined.\");\r\n        }\r\n\r\n        const isInSwimlane = await controller.checkIsInSwimlane(myId);\r\n\r\n        if (!isInSwimlane) {\r\n            throw new Error(\"Cannot fetch your workspace, because this window is not in a workspace\");\r\n        }\r\n\r\n        return (await controller.getWorkspaces((wsp) => !!wsp.getWindow((w) => w.id === myId)))[0];\r\n    };\r\n\r\n    const getWorkspace = async (predicate: (workspace: Glue42Workspaces.Workspace) => boolean): Promise<Glue42Workspaces.Workspace> => {\r\n        checkThrowCallback(predicate);\r\n        return (await controller.getWorkspaces(predicate))[0];\r\n    };\r\n\r\n    const getAllWorkspaces = (predicate?: (workspace: Glue42Workspaces.Workspace) => boolean): Promise<Glue42Workspaces.Workspace[]> => {\r\n        checkThrowCallback(predicate, true);\r\n        return controller.getWorkspaces(predicate);\r\n    };\r\n\r\n    const getWindow = async (predicate: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => boolean): Promise<Glue42Workspaces.WorkspaceWindow> => {\r\n        checkThrowCallback(predicate);\r\n        return controller.getWindow(predicate);\r\n    };\r\n\r\n    const getParent = async (predicate: (parent: Glue42Workspaces.WorkspaceBox) => boolean): Promise<Glue42Workspaces.WorkspaceBox> => {\r\n        checkThrowCallback(predicate);\r\n        return controller.getParent(predicate);\r\n    };\r\n\r\n    const restoreWorkspace = async (name: string, options?: Glue42Workspaces.RestoreWorkspaceConfig): Promise<Glue42Workspaces.Workspace> => {\r\n        nonEmptyStringDecoder.runWithException(name);\r\n        const validatedOptions = restoreWorkspaceConfigDecoder.runWithException(options);\r\n        return controller.restoreWorkspace(name, validatedOptions);\r\n    };\r\n\r\n    const createWorkspace = async (definition: Glue42Workspaces.WorkspaceDefinition, saveConfig?: Glue42Workspaces.WorkspaceCreateConfig): Promise<Glue42Workspaces.Workspace> => {\r\n        const validatedDefinition = workspaceDefinitionDecoder.runWithException(definition);\r\n        const validatedConfig = workspaceBuilderCreateConfigDecoder.runWithException(saveConfig);\r\n\r\n        return controller.createWorkspace(validatedDefinition, validatedConfig);\r\n    };\r\n\r\n    const layouts = {\r\n        getSummaries: (): Promise<Glue42Workspaces.WorkspaceLayoutSummary[]> => {\r\n            return controller.getLayoutSummaries();\r\n        },\r\n        delete: async (name: string): Promise<void> => {\r\n            nonEmptyStringDecoder.runWithException(name);\r\n            return controller.deleteLayout(name);\r\n        },\r\n        export: async (predicate?: (layout: Glue42Workspaces.WorkspaceLayout) => boolean): Promise<Glue42Workspaces.WorkspaceLayout[]> => {\r\n            checkThrowCallback(predicate, true);\r\n            return controller.exportLayout(predicate);\r\n        },\r\n        import: async (layouts: Glue42Workspaces.WorkspaceLayout[]): Promise<void> => {\r\n\r\n            if (!Array.isArray(layouts)) {\r\n                throw new Error(`The provided layouts argument is not an array: ${JSON.stringify(layouts)}`);\r\n            }\r\n\r\n            layouts.forEach((layout) => workspaceLayoutDecoder.runWithException(layout));\r\n            return controller.importLayout(layouts);\r\n        },\r\n        save: async (config: Glue42Workspaces.WorkspaceLayoutSaveConfig): Promise<Glue42Workspaces.WorkspaceLayout> => {\r\n            const verifiedConfig = workspaceLayoutSaveConfigDecoder.runWithException(config);\r\n            return controller.saveLayout(verifiedConfig);\r\n        },\r\n        onSaved: async (callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n            checkThrowCallback(callback);\r\n\r\n            return controller.handleOnSaved(callback);\r\n        },\r\n        onRemoved: async (callback: (layout: Glue42Workspaces.WorkspaceLayout) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n            checkThrowCallback(callback);\r\n\r\n            return controller.handleOnRemoved(callback);\r\n        }\r\n    };\r\n\r\n    const onFrameOpened = async (callback: (frame: Glue42Workspaces.Frame) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n\r\n        const wrappedCallback = (payload: FrameStreamData): void => {\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: payload.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n            callback(frame);\r\n        };\r\n\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"frame\", \"opened\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onFrameClosed = async (callback: (closed: { frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = (payload: FrameStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id });\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"frame\", \"closed\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWorkspaceOpened = async (callback: (workspace: Glue42Workspaces.Workspace) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = async (payload: WorkspaceStreamData): Promise<void> => {\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: payload.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            const snapshot = (await controller.getSnapshot(payload.workspaceSummary.id, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n            const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n            const workspace = ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n            callback(workspace);\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"workspace\", \"opened\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWorkspaceClosed = async (callback: (closed: { frameId: string; workspaceId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n\r\n        const wrappedCallback = (payload: WorkspaceStreamData): void => {\r\n            callback({ frameId: payload.frameSummary.id, workspaceId: payload.workspaceSummary.id });\r\n        };\r\n\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"workspace\", \"closed\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWindowAdded = async (callback: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const snapshot = (await controller.getSnapshot(payload.windowSummary.config.workspaceId, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: snapshot.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n            const workspace = ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n            const windowParent = workspace.getBox((parent) => parent.id === payload.windowSummary.parentId);\r\n            const foundWindow = windowParent.children.find((child) => child.type === \"window\" && child.positionIndex === payload.windowSummary.config.positionIndex);\r\n\r\n            callback(foundWindow as Glue42Workspaces.WorkspaceWindow);\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"window\", \"added\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWindowLoaded = async (callback: (swimlaneWindow: Glue42Workspaces.WorkspaceWindow) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = async (payload: WindowStreamData): Promise<void> => {\r\n            const snapshot = (await controller.getSnapshot(payload.windowSummary.config.workspaceId, \"workspace\")) as WorkspaceSnapshotResult;\r\n\r\n            const frameConfig: FrameCreateConfig = {\r\n                summary: snapshot.frameSummary\r\n            };\r\n            const frame = ioc.getModel<\"frame\">(\"frame\", frameConfig);\r\n\r\n            const workspaceConfig: WorkspaceIoCCreateConfig = { frame, snapshot };\r\n\r\n            const workspace = ioc.getModel<\"workspace\">(\"workspace\", workspaceConfig);\r\n\r\n            const foundWindow = workspace.getWindow((win) => win.id && win.id === payload.windowSummary.config.windowId);\r\n\r\n            callback(foundWindow);\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"window\", \"loaded\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    const onWindowRemoved = async (callback: (removed: { windowId: string; workspaceId: string; frameId: string }) => void): Promise<Glue42Workspaces.Unsubscribe> => {\r\n        checkThrowCallback(callback);\r\n        const wrappedCallback = (payload: WindowStreamData): void => {\r\n            const { windowId, workspaceId, frameId } = payload.windowSummary.config;\r\n            callback({ windowId, workspaceId, frameId });\r\n        };\r\n        const unsubscribe = await controller.processGlobalSubscription(wrappedCallback, \"window\", \"removed\");\r\n        return unsubscribe;\r\n    };\r\n\r\n    return {\r\n        inWorkspace,\r\n        getBuilder,\r\n        getMyFrame,\r\n        getFrame,\r\n        getAllFrames,\r\n        getAllWorkspacesSummaries,\r\n        getMyWorkspace,\r\n        getWorkspace,\r\n        getAllWorkspaces,\r\n        getWindow,\r\n        getBox: getParent,\r\n        restoreWorkspace,\r\n        createWorkspace,\r\n        layouts,\r\n        onFrameOpened,\r\n        onFrameClosed,\r\n        onWorkspaceOpened,\r\n        onWorkspaceClosed,\r\n        onWindowAdded,\r\n        onWindowLoaded,\r\n        onWindowRemoved,\r\n    };\r\n};\r\n","import { IoC } from \"./shared/ioc\";\r\nimport { composeAPI } from \"./main\";\r\nimport { WorkspacesFactoryFunction } from \"../workspaces\";\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\nconst factoryFunction: WorkspacesFactoryFunction = async (glue: any, config?: any): Promise<void> => {\r\n\r\n    const ioc = new IoC(glue.agm, glue.windows, glue.layouts, glue.contexts, config?.assets?.location);\r\n\r\n    await ioc.initiate();\r\n\r\n    glue.workspaces = composeAPI(glue, ioc);\r\n};\r\n\r\n// attach to window object\r\nif (typeof window !== \"undefined\") {\r\n    /* eslint-disable @typescript-eslint/no-explicit-any */\r\n    (window as any).GlueWorkspaces = factoryFunction;\r\n}\r\n\r\nexport default factoryFunction;\r\n"],"names":["createRegistry","options","errorHandling","Error","_userErrorHandler","callbacks","_handleError","exceptionArtifact","key","errParam","msg","stack","console","error","add","callback","callbacksForKey","push","allForKey","reduce","acc","element","index","length","execute","argumentsArr","_i","arguments","results","forEach","result","apply","undefined","err","clear","clearKey","default","ok","asPromise","r","Promise","resolve","reject","withDefault","defaultValue","withException","map","f","map2","ar","br","mapError","andThen","__assign","Object","freeze","isOk","isErr","successes","concat","assign","t","s","i","n","p","prototype","hasOwnProperty","call","this","isJsonArray","json","Array","isArray","isJsonObject","expectedGot","expected","got","JSON","stringify","typeString","printPath","paths","path","join","prependAt","newAt","_a","at","rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","Decoder","decode","_this","run","kind","input","message","runPromise","runWithException","value","where","test","errorMessage","succeed","fail","string","number","boolean","constant","isEqual","a","b","keys","object","decoders","obj","array","decoder","v","arr","err$$1","decodeValue_1","tuple","nth","union","ad","bd","oneOf","intersection","ds","anyJson","unknownJson","dict","optional","errors","errorsList","valueAt","jsonAtPath","slice","fixedValue","lazy","mkDecoder","nonEmptyStringDecoder","nonNegativeNumberDecoder","num","isWindowInSwimlaneResultDecoder","inWorkspace","allParentDecoder","subParentDecoder","frameStateDecoder","checkThrowCallback","allowUndefined","argumentType","workspaceBuilderCreateConfigDecoder","saveLayout","deleteLayoutConfigDecoder","name","swimlaneWindowDefinitionDecoder","type","appName","windowId","context","strictSwimlaneWindowDefinitionDecoder","parentDefinitionDecoder","children","strictParentDefinitionDecoder","newFrameConfigDecoder","toLowerCase","bounds","left","top","width","height","restoreTypeDecoder","restoreWorkspaceConfigDecoder","app","restoreType","title","reuseWorkspaceId","frameId","lockdown","activateFrame","newFrame","noTabHeader","inMemoryLayout","openWorkspaceConfigDecoder","restoreOptions","workspaceDefinitionDecoder","config","position","isFocused","frame","reuseFrameId","builderConfigDecoder","definition","workspaceCreateConfigDecoder","saveConfig","getFrameSummaryConfigDecoder","itemId","frameSummaryDecoder","id","eventTypeDecoder","positionIndex","focused","layoutName","workspaceId","streamRequestArgumentsDecoder","branch","workspaceEventActionDecoder","workspaceConfigResultDecoder","baseChildSnapshotConfigDecoder","parentSnapshotConfigDecoder","swimlaneWindowSnapshotConfigDecoder","isMaximized","childSnapshotResultDecoder","workspaceSnapshotResultDecoder","frameSummary","customWorkspaceChildSnapshotDecoder","windowLayoutItemDecoder","url","groupLayoutItemDecoder","columnLayoutItemDecoder","rowLayoutItemDecoder","workspaceLayoutDecoder","metadata","components","state","exportedLayoutsResultDecoder","layouts","frameSummaryResultDecoder","frameSummariesResultDecoder","summaries","workspaceSummaryResultDecoder","workspaceSummariesResultDecoder","frameSnapshotResultDecoder","workspaces","layoutSummaryDecoder","layoutSummariesDecoder","simpleWindowOperationSuccessResultDecoder","voidResultDecoder","frameStateResultDecoder","resizeConfigDecoder","relative","moveConfigDecoder","simpleItemConfigDecoder","frameStateConfigDecoder","requestedState","setItemTitleConfigDecoder","moveWindowConfigDecoder","containerId","resizeItemConfigDecoder","moveFrameConfigDecoder","addWindowConfigDecoder","parentId","parentType","addContainerConfigDecoder","addItemResultDecoder","pingResultDecoder","live","bundleConfigDecoder","containerSummaryResultDecoder","frameStreamDataDecoder","workspaceStreamDataDecoder","workspaceSummary","containerStreamDataDecoder","containerSummary","windowStreamDataDecoder","windowSummary","workspaceLayoutSaveConfigDecoder","saveContext","METHODS","control","isStream","coreEvents","frameStream","workspaceStream","containerStream","windowStream","STREAMS","payloadDecoder","workspace","container","window","OPERATIONS","ping","resultDecoder","isWindowInWorkspace","argsDecoder","createWorkspace","getAllFramesSummaries","getFrameSummary","getAllWorkspacesSummaries","getWorkspaceSnapshot","getAllLayoutsSummaries","openWorkspace","deleteLayout","importLayout","exportAllLayouts","restoreItem","maximizeItem","focusItem","closeItem","resizeItem","changeFrameState","getFrameState","moveFrame","getFrameSnapshot","forceLoadWindow","ejectWindow","setItemTitle","moveWindowTo","addWindow","addContainer","bundleWorkspace","EnterpriseController","[object Object]","bridge","base","checkIsWindowLoaded","send","createConfig","getLayoutSummaries","some","summary","restoreWorkspace","levelId","scopeId","eventType","action","originalCB","wrappedCB","callbackData","notifyWindowAdded","subscribe","scope","selector","getFrame","predicate","getFrames","allFrameSummaries","foundWorkspace","iterateWorkspaces","wsp","end","matchingWorkspaces","allSummariesResult","getAllWorkspaceSummaries","resultWindow","foundWindow","getWindow","resultParent","foundParent","getBox","matchingLayouts","layout","all","handleOnSaved","handleOnRemoved","bundleTo","getWorkspaceContext","data","setWorkspaceContext","updateWorkspaceContext","subscribeWorkspaceContextUpdated","getGDWindow","newParentId","getSnapshot","refreshChildren","iterateFindChild","iterateFilterChildren","ended","workspaceSummaries","fetchWorkspace","Bridge","transport","registry","coreEventMethodReady","handleCoreEventInvocation","bind","registryKey","args","scopeConfig","receivedIds","checkScopeMatch","operationName","operationArgs","target","responseTimeout","glue42gd","operationDefinition","values","find","operation","operationResult","operationResultRaw","transmitControl","activeSub","getActiveSubscription","getRegistryKey","stream","gdSub","getBranchKey","onData","streamData","requestedArgumentsResult","requestArguments","actionResult","streamType","validatedPayload","payload","keyToExecute","level","callbacksCount","activeSubscriptions","unsubscribe","close","splice","verifiedAction","verifiedType","verifiedPayload","promisePlus","promise","timeoutMilliseconds","timeoutMessage","promiseActive","timeout","setTimeout","then","clearTimeout","catch","InteropTransport","agm","eventCallback","coreEventMethodInitiated","registerCoreEventMethod","coreEventMethodRegistrationPromise","log","register","method","verifyMethodLive","streamName","streamBranch","subscriptionArgs","subscription","operationArguments","methods","invocationArguments","invocationResult","baseErrorMessage","invoke","methodResponseTimeoutMs","defaultTransportTimeout","all_return_values","all_errors","invocationErrorMessage","returned","supportsStreaming","methodAdded","privateData","WeakMap","ParentBuilder","wrapChildren","set","get","serializeChildren","BaseBuilder","getBuilder","child","validatedDefinition","childBuilder","serialize","WorkspaceBuilder","controller","every","getBase","model","Row","getId","getFrameId","getWorkspaceId","getPositionIndex","getAllChildren","parent","getMyParent","getMyFrame","getMyWorkspace","addParent","removeChild","maximize","restore","Column","Group","getData","manager","getWorkspaceData","getDataManager","Workspace","dataManager","refreshReference","newSnapshot","existingChildren","foundChildren","foundChild","swimlaneWindow","newChildren","currentFrame","actualFrame","remapFrame","frameCreateConfig","ioc","getModel","remapWorkspace","allParents","filter","getAllBoxes","allWindows","processLocalSubscription","win","getWindowData","Window","isLoaded","newWindowId","getGdWindow","myId","getParent","getFrameData","Frame","validatedConfig","getWorkspaces","validatedOptions","getWorkspace","PrivateDataManager","keyForDeleting","windowPlacementIdData","k","windowsData","delete","workspacesData","parentsData","framesData","placementId","newData","getParentData","getWindowFromPlacementId","placemenId","getWindowByPlacementId","Base","typeToAdd","parentDefinition","transformDefinition","myWorkspace","modelData","CoreController","frameUtils","allFrames","getAllFrameInstances","frameInstance","frameInstanceConfig","getFrameInstance","focusFrame","getFrameInstanceByItemId","createCoreEventMethod","handleCoreSubscription","allFrameInstances","validSummaries","peerId","allResults","getAll","remove","export","import","closeFrame","resizeFrame","CoreFrameUtils","interop","windows","assetsBaseLocation","inCsbSuffix","location","href","includes","workspacesRoute","defaultAssetsBase","workspacesIndex","potentialFrames","servers","server","getMethods","readyFrames","inst","coreWindow","list","w","focus","frames","foundFrame","openNewWorkspacesFrame","getLastFrameInteropInstance","foundFrameSummary","sort","aIncrementor","lastIndexOf","newFrameConfig","rndIncr","Math","random","frameWindow","serverMethodAdded","info","nameMatch","serverMatch","frameOptions","defaultWidth","defaultHeight","open","frWin","foundServer","methodMatch","moveTo","moveResize","resizeTo","BaseController","contexts","privateDataManager","snapshot","frameConfig","workspaceConfig","frameToCheck","bridgeResults","summaryResult","wrappedCallback","addedUnSub","onAdded","changedUnSub","onChanged","onRemoved","contextName","update","gdWindow","newChildSnapshot","childToAdd","c","childType","remapChild","grandChildren","innerFound","onWindowAdded","IoC","baseController","_baseController","_controllerInstance","_bridgeInstance","CallbackFactory","_transportInstance","_privateDataManagerInstance","parentBase","_parentBaseInstance","initiate","frameData","setFrameData","windowPrivateData","newWindow","setWindowData","newParent","builtChildren","buildChildren","parentPrivateData","setParentData","newWorkspace","workspacePrivateData","setWorkspaceData","baseBuilder","factoryFunction","glue","assets","my","checkIsInSwimlane","getAllFrames","getAllWorkspaces","getSummaries","exportLayout","save","verifiedConfig","onSaved","onFrameOpened","processGlobalSubscription","onFrameClosed","onWorkspaceOpened","onWorkspaceClosed","onWindowLoaded","onWindowRemoved","composeAPI","GlueWorkspaces"],"mappings":"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"}