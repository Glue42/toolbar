!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).workspaces=e.workspaces||{},e.workspaces.min=t())}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function e(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function a(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){e.done?n(e.value):new r((function(t){t(e.value)})).then(s,a)}d((i=i.apply(e,t||[])).next())}))}function t(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,r={};function i(r,i){var n=r instanceof Error?r:new Error(r);if(t)t(n);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+n.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t){var i=r[e];return i||(i=[],r[e]=i),i.push(t),function(){var i=r[e];i&&(i=i.reduce((function(e,r,i){return r===t&&e.length===i||e.push(r),e}),[]),r[e]=i)}},execute:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=r[e];if(!o||0===o.length)return[];var s=[];return o.forEach((function(r){try{var n=r.apply(void 0,t);s.push(n)}catch(t){s.push(void 0),i(t,e)}})),s},clear:function(){r={}},clearKey:function(e){r[e]&&delete r[e]}}}t.default=t;var r=t,i=function(e){return{ok:!0,result:e}},n=function(e){return{ok:!1,error:e}},o=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},s=function(e,t){return!0===t.ok?t.result:e},a=function(e){if(!0===e.ok)return e.result;throw e.error},d=function(e,t){return!0===t.ok?i(e(t.result)):t},c=function(e,t,r){return!1===t.ok?t:!1===r.ok?r:i(e(t.result,r.result))},u=function(e,t){return!0===t.ok?t:n(e(t.error))},l=function(e,t){return!0===t.ok?e(t.result):t},h=(Object.freeze({ok:i,isOk:function(e){return!0===e.ok},err:n,isErr:function(e){return!1===e.ok},asPromise:o,withDefault:s,withException:a,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:d,map2:c,mapError:u,andThen:l}),function(){return(h=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)});var m=function(e){return Array.isArray(e)},p=function(e){return"object"==typeof e&&null!==e&&!m(e)},f=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},w=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},g=function(e,t){var r=t.at,i=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}(t,["at"]);return h({at:e+(r||"")},i)},v=function(){function e(t){var r=this;this.decode=t,this.run=function(e){return u((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),r.decode(e))},this.runPromise=function(e){return o(r.run(e))},this.runWithException=function(e){return a(r.run(e))},this.map=function(t){return new e((function(e){return d(t,r.decode(e))}))},this.andThen=function(t){return new e((function(e){return l((function(r){return t(r).decode(e)}),r.decode(e))}))},this.where=function(t,i){return r.andThen((function(r){return t(r)?e.succeed(r):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?i(e):n({message:f("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?i(e):n({message:f("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?i(e):n({message:f("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return function e(t,r){if(t===r)return!0;if(null===t&&null===r)return!0;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}var n=Object.keys(t);if(n.length!==Object.keys(r).length)return!1;for(i=0;i<n.length;i++){if(!r.hasOwnProperty(n[i]))return!1;if(!e(t[n[i]],r[n[i]]))return!1}return!0}}(e,t)?i(t):n({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(p(e)&&t){var r={};for(var o in t)if(t.hasOwnProperty(o)){var s=t[o].decode(e[o]);if(!0!==s.ok)return void 0===e[o]?n({message:"the key '"+o+"' is required but was not present"}):n(g("."+o,s.error));void 0!==s.result&&(r[o]=s.result)}return i(r)}return p(e)?i(e):n({message:f("an object",e)})}))},e.array=function(t){return new e((function(e){if(m(e)&&t){return e.reduce((function(e,r,i){return c((function(e,t){return e.concat([t])}),e,function(e,r){return u((function(e){return g("["+r+"]",e)}),t.decode(e))}(r,i))}),i([]))}return m(e)?i(e):n({message:f("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(m(e)){if(e.length!==t.length)return n({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var r=[],o=0;o<t.length;o++){var s=t[o].decode(e[o]);if(!s.ok)return n(g("["+o+"]",s.error));r[o]=s.result}return i(r)}return n({message:f("a tuple of length "+t.length,e)})}))},e.union=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return e.oneOf.apply(e,[t,r].concat(i))},e.intersection=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return new e((function(e){return[t,r].concat(n).reduce((function(t,r){return c(Object.assign,t,r.decode(e))}),i({}))}))},e.anyJson=function(){return new e((function(e){return i(e)}))},e.unknownJson=function(){return new e((function(e){return i(e)}))},e.dict=function(t){return new e((function(e){if(p(e)){var r={};for(var o in e)if(e.hasOwnProperty(o)){var s=t.decode(e[o]);if(!0!==s.ok)return n(g("."+o,s.error));r[o]=s.result}return i(r)}return n({message:f("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e?i(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new e((function(e){for(var r=[],i=0;i<t.length;i++){var o=t[i].decode(e);if(!0===o.ok)return o;r[i]=o.error}var s=r.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return n({message:'expected a value matching one of the decoders, got the errors ["'+s+'"]'})}))},e.withDefault=function(t,r){return new e((function(e){return i(s(t,r.decode(e)))}))},e.valueAt=function(t,r){return new e((function(e){for(var i=e,o=0;o<t.length;o++){if(void 0===i)return n({at:w(t.slice(0,o+1)),message:"path does not exist"});if("string"==typeof t[o]&&!p(i))return n({at:w(t.slice(0,o+1)),message:f("an object",i)});if("number"==typeof t[o]&&!m(i))return n({at:w(t.slice(0,o+1)),message:f("an array",i)});i=i[t[o]]}return u((function(e){return void 0===i?{at:w(t),message:"path does not exist"}:g(w(t),e)}),r.decode(i))}))},e.succeed=function(t){return new e((function(e){return i(t)}))},e.fail=function(t){return new e((function(e){return n({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),y=v.string,I=v.number,b=v.boolean,k=v.anyJson,W=v.constant,S=v.object,x=v.array,C=v.optional,F=v.oneOf,D=v.intersection,E=v.lazy;const M=y().where(e=>e.length>0,"Expected a non-empty string"),T=I().where(e=>e>=0,"Expected a non-negative number"),A=S({inWorkspace:b()}),L=F(W("workspace"),W("row"),W("column"),W("group")),B=F(W("row"),W("column"),W("group")),O=F(W("maximized"),W("minimized"),W("normal")),z=(e,t)=>{const r=typeof e;if(t&&"function"!==r&&"undefined"!==r)throw new Error("Provided argument must be either undefined or of type function, provided: "+r);if(!t&&"function"!==r)throw new Error("Provided argument must be of type function, provided: "+r)},P=C(S({saveLayout:C(b())})),R=S({name:M}),_=S({type:C(W("window")),appName:C(M),windowId:C(M),context:C(k())}),j=S({type:W("window"),appName:C(M),windowId:C(M),context:C(k())}),U=C(S({type:C(B),children:C(E(()=>x(F(_,U))))})),$=S({type:B,children:C(E(()=>x(F(j,$))))}),G=(F(y().where(e=>"maximized"===e.toLowerCase(),"Expected a case insensitive variation of 'maximized'"),y().where(e=>"normal"===e.toLowerCase(),"Expected a case insensitive variation of 'normal'")),S({bounds:C(S({left:C(I()),top:C(I()),width:C(T),height:C(T)}))})),N=F(W("direct"),W("delayed"),W("lazy")),J=C(S({app:C(M),context:C(k()),restoreType:C(N),title:C(M),reuseWorkspaceId:C(M),frameId:C(M),lockdown:C(b()),activateFrame:C(b()),newFrame:C(F(G,b())),noTabHeader:C(b()),inMemoryLayout:C(b())})),H=S({name:M,restoreOptions:C(J)}),K=S({children:C(x(F(_,U))),context:C(k()),config:C(S({title:C(M),position:C(T),isFocused:C(b()),noTabHeader:C(b())})),frame:C(S({reuseFrameId:C(M),newFrame:C(F(b(),G))}))}),q=S({type:L,definition:C(F(K,U))}),Q=D(K,S({saveConfig:C(S({saveLayout:C(b())}))})),V=S({itemId:M}),X=S({id:M}),Y=(S({id:M,frameId:M,positionIndex:I(),title:M,focused:b(),layoutName:C(M)}),S({type:B,id:M,frameId:M,workspaceId:M,positionIndex:I()}),F(W("frame"),W("workspace"),W("container"),W("window"))),Z=S({type:Y,branch:M}),ee=F(W("opened"),W("closing"),W("closed"),W("focus"),W("added"),W("loaded"),W("removed"),W("childrenUpdate"),W("containerChange"),W("maximized"),W("minimized"),W("normal"),W("selected")),te=S({frameId:M,title:M,positionIndex:T,name:M,layoutName:C(M)}),re=S({frameId:M,workspaceId:M,positionIndex:T}),ie=k(),ne=D(re,S({windowId:C(M),isMaximized:b(),isFocused:b(),title:C(y()),appName:C(M)})),oe=S({id:M,config:F(ie,ne),children:C(E(()=>x(oe))),type:F(W("window"),W("row"),W("column"),W("group"))}),se=S({id:M,config:te,children:x(oe),frameSummary:X}),ae=S({id:C(M),config:F(ie,ne),children:C(E(()=>x(ae))),type:F(W("window"),W("row"),W("column"),W("group"))}),de=S({type:W("window"),config:S({appName:M,url:C(M)})}),ce=S({type:W("group"),config:k(),children:x(F(de))}),ue=S({type:W("column"),config:k(),children:x(F(ce,de,E(()=>ue),E(()=>le)))}),le=S({type:W("row"),config:k(),children:x(F(ue,ce,de,E(()=>le)))}),he=S({name:M,type:W("Workspace"),metadata:C(k()),components:x(S({type:W("Workspace"),state:S({config:k(),context:k(),children:x(F(le,ue,ce,de))})}))}),me=S({layouts:x(he)}),pe=S({id:M}),fe=S({summaries:x(pe)}),we=S({id:M,config:te}),ge=S({summaries:x(we)}),ve=S({id:M,config:k(),workspaces:x(se)}),ye=S({name:M}),Ie=S({summaries:x(ye)}),be=S({windowId:M}),ke=k(),We=S({state:O}),Se=S({width:C(T),height:C(T),relative:C(b())}),xe=S({top:C(I()),left:C(I()),relative:C(b())}),Ce=S({itemId:M}),Fe=S({frameId:M,requestedState:O}),De=S({itemId:M,title:M}),Ee=S({itemId:M,containerId:M}),Me=D(Ce,Se),Te=D(Ce,xe),Ae=(S({id:M,type:B}),S({definition:_,parentId:M,parentType:L})),Le=S({definition:$,parentId:M,parentType:L}),Be=S({itemId:M,windowId:C(M)}),Oe=S({live:b()}),ze=S({type:F(W("row"),W("column")),workspaceId:M}),Pe=S({itemId:M,config:ie}),Re=S({frameSummary:X}),_e=S({workspaceSummary:we,frameSummary:X}),je=S({containerSummary:Pe}),Ue=S({windowSummary:S({itemId:M,parentId:M,config:ne})}),$e=S({name:M,workspaceId:M,saveContext:C(b())}),Ge={control:{name:"T42.Workspaces.Control",isStream:!1},coreEvents:{name:"T42.Workspaces.Events",isStream:!1},frameStream:{name:"T42.Workspaces.Stream.Frame",isStream:!0},workspaceStream:{name:"T42.Workspaces.Stream.Workspace",isStream:!0},containerStream:{name:"T42.Workspaces.Stream.Container",isStream:!0},windowStream:{name:"T42.Workspaces.Stream.Window",isStream:!0}},Ne={frame:{name:"T42.Workspaces.Stream.Frame",payloadDecoder:Re},workspace:{name:"T42.Workspaces.Stream.Workspace",payloadDecoder:_e},container:{name:"T42.Workspaces.Stream.Container",payloadDecoder:je},window:{name:"T42.Workspaces.Stream.Window",payloadDecoder:Ue}},Je={ping:{name:"ping",resultDecoder:Oe},isWindowInWorkspace:{name:"isWindowInWorkspace",argsDecoder:Ce,resultDecoder:A},createWorkspace:{name:"createWorkspace",resultDecoder:se,argsDecoder:Q},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:fe},getFrameSummary:{name:"getFrameSummary",resultDecoder:X,argsDecoder:V},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:ge},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",resultDecoder:se,argsDecoder:Ce},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:Ie},openWorkspace:{name:"openWorkspace",argsDecoder:H,resultDecoder:se},deleteLayout:{name:"deleteLayout",resultDecoder:ke,argsDecoder:R},saveLayout:{name:"saveLayout",resultDecoder:he,argsDecoder:$e},importLayout:{name:"importLayout",resultDecoder:ke,argsDecoder:he},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:me},restoreItem:{name:"restoreItem",argsDecoder:Ce,resultDecoder:ke},maximizeItem:{name:"maximizeItem",argsDecoder:Ce,resultDecoder:ke},focusItem:{name:"focusItem",argsDecoder:Ce,resultDecoder:ke},closeItem:{name:"closeItem",argsDecoder:Ce,resultDecoder:ke},resizeItem:{name:"resizeItem",argsDecoder:Me,resultDecoder:ke},changeFrameState:{name:"changeFrameState",argsDecoder:Fe,resultDecoder:ke},getFrameState:{name:"getFrameState",argsDecoder:Ce,resultDecoder:We},moveFrame:{name:"moveFrame",argsDecoder:Te,resultDecoder:ke},getFrameSnapshot:{name:"getFrameSnapshot",argsDecoder:Ce,resultDecoder:ve},forceLoadWindow:{name:"forceLoadWindow",argsDecoder:Ce,resultDecoder:be},ejectWindow:{name:"ejectWindow",argsDecoder:Ce,resultDecoder:be},setItemTitle:{name:"setItemTitle",argsDecoder:De,resultDecoder:ke},moveWindowTo:{name:"moveWindowTo",argsDecoder:Ee,resultDecoder:ke},addWindow:{name:"addWindow",argsDecoder:Ae,resultDecoder:Be},addContainer:{name:"addContainer",argsDecoder:Le,resultDecoder:Be},bundleWorkspace:{name:"bundleWorkspace",argsDecoder:ze,resultDecoder:ke}};class He{constructor(e,t){this.bridge=e,this.base=t}checkIsWindowLoaded(e){return this.base.checkIsWindowLoaded(e)}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Je.isWindowInWorkspace.name,{itemId:t})).inWorkspace}))}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r});return yield this.base.createWorkspace(e)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);if(null==r?void 0:r.frameId){if(!(yield this.bridge.send(Je.getAllFramesSummaries.name)).summaries.some(e=>e.id===r.frameId))throw new Error(`Cannot reuse the frame with id: ${r.frameId}, because there is no frame with that ID found`)}return yield this.base.restoreWorkspace(t,r)}))}add(t,r,i,n){return e(this,void 0,void 0,(function*(){return yield this.base.add(t,r,i,n)}))}processLocalSubscription(t,r){if(t.scopeId=t.scopeId||r,"window"===t.eventType&&"loaded"===t.action){const r=t.callback,i=t=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(t.windowSummary.config.windowId),r(t)}));t.callback=i}return this.bridge.subscribe(t)}processGlobalSubscription(t,r,i){const n={eventType:r,callback:t,action:i,scope:"global"};if("window"===r&&"loaded"===i){const r=r=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(r.windowSummary.config.windowId),t(r)}));n.callback=r}return this.bridge.subscribe(n)}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId)return yield this.base.getFrame(t.windowId);if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Je.getAllFramesSummaries.name);return this.base.getFrames(e.summaries,t)}))}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Je.getAllWorkspacesSummaries.name,{});return this.base.getAllWorkspaceSummaries(e)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getWindow(t);n&&(e=n,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getBox(t);n&&(e=n,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Je.getAllLayoutsSummaries.name)).summaries}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.deleteLayout.name,{name:t})}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Je.exportAllLayouts.name)).layouts.reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}saveLayout(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(Je.saveLayout.name,t)}))}importLayout(t){return e(this,void 0,void 0,(function*(){yield Promise.all(t.map(e=>this.bridge.send(Je.importLayout.name,e)))}))}handleOnSaved(e){return this.base.handleOnSaved(e)}handleOnRemoved(e){return this.base.handleOnRemoved(e)}bundleTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.bundleTo(t,r)}))}getWorkspaceContext(e){return this.base.getWorkspaceContext(e)}setWorkspaceContext(e,t){return this.base.setWorkspaceContext(e,t)}updateWorkspaceContext(e,t){return this.base.updateWorkspaceContext(e,t)}subscribeWorkspaceContextUpdated(e,t){return this.base.subscribeWorkspaceContextUpdated(e,t)}restoreItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.restoreItem(t)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.maximizeItem(t)}))}focusItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.focusItem(t)}))}changeFrameState(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.changeFrameState.name,{frameId:t,requestedState:r})}))}getFrameState(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Je.getFrameState.name,{itemId:t})).state}))}closeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.closeItem(t)}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.resizeItem(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.base.forceLoadWindow(t);return yield this.base.notifyWindowAdded(e),e}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){const e=(yield this.base.ejectWindow(t)).windowId;return yield this.base.notifyWindowAdded(e),e}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveWindowTo(t,r)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.getSnapshot(t,r)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.setItemTitle(t,r)}))}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const n of i){if(e)return;const i=yield this.base.fetchWorkspace(n.id);t(i,r)}}))}}class Ke{constructor(e,t){this.transport=e,this.registry=t,this.activeSubscriptions=[]}createCoreEventMethod(){return e(this,void 0,void 0,(function*(){yield this.transport.coreEventMethodReady(this.handleCoreEventInvocation.bind(this))}))}handleCoreSubscription(e){const t=`${e.eventType}-${e.action}`,r=e.scope,i=e.scopeId;return this.registry.add(t,t=>{var n,o,s,a,d;const c={type:r,id:i},u={frame:(null===(n=t.frameSummary)||void 0===n?void 0:n.id)||(null===(o=t.windowSummary)||void 0===o?void 0:o.config.frameId),workspace:(null===(s=t.workspaceSummary)||void 0===s?void 0:s.id)||(null===(a=t.windowSummary)||void 0===a?void 0:a.config.workspaceId),window:null===(d=t.windowSummary)||void 0===d?void 0:d.config.windowId};this.checkScopeMatch(c,u)&&e.callback(t)})}send(t,r,i,n){return e(this,void 0,void 0,(function*(){if(!window.glue42gd&&!i)throw new Error(`Cannot complete operation: ${t} with args: ${JSON.stringify(r)}, because the environment is Glue42 Core and no frame target was provided`);const e=Object.values(Je).find(e=>e.name===t);if(!e)throw new Error("Cannot find definition for operation name: "+t);if(e.argsDecoder)try{e.argsDecoder.runWithException(r)}catch(e){throw new Error(`Unexpected internal outgoing validation error: ${e.message}, for input: ${JSON.stringify(e.input)}`)}let o;try{const t=yield this.transport.transmitControl(e.name,r,i,n);o=e.resultDecoder.runWithException(t)}catch(e){if(e.kind)throw new Error(`Unexpected internal incoming validation error: ${e.message}, for input: ${JSON.stringify(e.input)}`);throw new Error(e.message)}return o}))}subscribe(t){return e(this,void 0,void 0,(function*(){let e=this.getActiveSubscription(t);const r=this.getRegistryKey(t);if(!e){const r=Ne[t.eventType],i=yield this.transport.subscribe(r.name,this.getBranchKey(t),t.eventType);i.onData(e=>{const t=e.data,r=Z.run(e.requestArguments),i=ee.run(t.action);if(!r.ok||!i.ok)return;const n=r.result.type,o=r.result.branch,s=Ne[n].payloadDecoder.run(t.payload);if(!s.ok)return;const a=`${n}-${o}-${i.result}`;this.registry.execute(a,s.result)}),e={streamType:t.eventType,level:t.scope,levelId:t.scopeId,callbacksCount:0,gdSub:i},this.activeSubscriptions.push(e)}const i=this.registry.add(r,t.callback);return++e.callbacksCount,()=>{i(),--e.callbacksCount,0===e.callbacksCount&&(e.gdSub.close(),this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(e),1))}}))}checkScopeMatch(e,t){return"global"===e.type||("frame"===e.type&&e.id===t.frame||("workspace"===e.type&&e.id===t.workspace||"window"===e.type&&e.id===t.window))}handleCoreEventInvocation(e){const t=ee.runWithException(e.action),r=Y.runWithException(e.type),i=Ne[r].payloadDecoder.runWithException(e.payload),n=`${r}-${t}`;this.registry.execute(n,i)}getBranchKey(e){return"global"===e.scope?e.scope:`${e.scope}_${e.scopeId}`}getRegistryKey(e){return`${e.eventType}-${this.getBranchKey(e)}-${e.action}`}getActiveSubscription(e){return this.activeSubscriptions.find(t=>t.streamType===e.eventType&&t.level===e.scope&&t.levelId===e.scopeId)}}const qe=(e,t,r)=>new Promise((i,n)=>{let o=!0;const s=setTimeout(()=>{if(!o)return;o=!1;n(r||"Promise timeout hit: "+t)},t);e().then(e=>{o&&(o=!1,clearTimeout(s),i(e))}).catch(e=>{o&&(o=!1,clearTimeout(s),n(e))})});class Qe{constructor(e){this.agm=e,this.defaultTransportTimeout=3e4,this.coreEventMethodInitiated=!1}coreEventMethodReady(e){return this.coreEventMethodInitiated||this.registerCoreEventMethod(e),this.coreEventMethodRegistrationPromise}registerCoreEventMethod(e){this.coreEventMethodInitiated=!0,console.log("creating method"),this.coreEventMethodRegistrationPromise=this.agm.register(Ge.coreEvents.name,e)}initiate(){return e(this,void 0,void 0,(function*(){window.glue42gd&&(yield Promise.all(Object.values(Ge).map(e=>e.name===Ge.coreEvents.name?Promise.resolve():this.verifyMethodLive(e.name,e.isStream))))}))}subscribe(t,r,i){return e(this,void 0,void 0,(function*(){const e={branch:r,type:i};let n;try{n=yield this.agm.subscribe(t,{arguments:e})}catch(e){const i=`Internal subscription error! Error details: stream - ${t}, branch: ${r}. Internal message: ${e.message}`;throw new Error(i)}return n}))}transmitControl(t,r,i,n){return e(this,void 0,void 0,(function*(){if(!this.agm.methods().find(e=>e.name===Ge.control.name))throw new Error(`Cannot complete operation: ${t}, because no control method was found`);const e={operation:t,operationArguments:r};let o;const s=`Internal Workspaces Communication Error. Attempted operation: ${JSON.stringify(e)}. `;try{if(o=yield this.agm.invoke(Ge.control.name,e,i,{methodResponseTimeoutMs:n||this.defaultTransportTimeout}),!o)throw new Error("Received unsupported result from GD - empty result");if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error("Received unsupported result from GD - empty values collection")}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${s} -> Inner message: ${t}`)}throw new Error(`${s} -> Inner message: ${e.message}`)}return o.all_return_values[0].returned}))}verifyMethodLive(e,t){return qe(()=>new Promise(r=>{if(this.agm.methods().find(r=>r.name===e&&r.supportsStreaming===t))return void r();let i=this.agm.methodAdded(n=>{n.name===e&&n.supportsStreaming===t&&(i?(i(),i=null):setTimeout(()=>{i&&i()},0),r())})}),15e3,"Timeout waiting for the Workspaces communication channels")}}const Ve=new WeakMap;class Xe{constructor(e,t){const r=t.wrapChildren(e.children);delete e.children,Ve.set(this,{base:t,children:r,definition:e})}get type(){return Ve.get(this).definition.type}addColumn(e){return Ve.get(this).base.add("column",Ve.get(this).children,e)}addRow(e){return Ve.get(this).base.add("row",Ve.get(this).children,e)}addGroup(e){return Ve.get(this).base.add("group",Ve.get(this).children,e)}addWindow(e){return Ve.get(this).base.addWindow(Ve.get(this).children,e),this}serialize(){const e=Ve.get(this).definition;return e.children=Ve.get(this).base.serializeChildren(Ve.get(this).children),e}}class Ye{constructor(e){this.getBuilder=e}wrapChildren(e){return e.map(e=>"window"===e.type?e:this.getBuilder({type:e.type,definition:e}))}add(e,t,r){const i=U.runWithException(r),n=this.getBuilder({type:e,definition:i});return t.push(n),n}addWindow(e,t){const r=_.runWithException(t);r.type="window",e.push(r)}serializeChildren(e){return e.map(e=>e instanceof Xe?e.serialize():e)}}const Ze=new WeakMap;class et{constructor(e,t,r){const i=t.wrapChildren(e.children);delete e.children,Ze.set(this,{base:t,children:i,definition:e,controller:r})}addColumn(e){const t=Ze.get(this).children;if(!t.every(e=>e instanceof Xe&&"column"===e.type))throw new Error("Cannot add a column to this workspace, because there are already children of another type");return Ze.get(this).base.add("column",t,e)}addRow(e){const t=Ze.get(this).children;if(!t.every(e=>e instanceof Xe&&"row"===e.type))throw new Error("Cannot add a row to this workspace, because there are already children of another type");return Ze.get(this).base.add("row",t,e)}addGroup(e){const t=Ze.get(this).children;if(0!==t.length)throw new Error("Cannot add a group to this workspace, because there are already defined children.");return Ze.get(this).base.add("group",t,e)}addWindow(e){const t=Ze.get(this).children;if(0!==t.length)throw new Error("Cannot add a window to this workspace, because there are already defined children.");return Ze.get(this).base.addWindow(t,e),this}getChildAt(e){T.runWithException(e);return Ze.get(this).children[e]}create(t){return e(this,void 0,void 0,(function*(){const e=P.runWithException(t),r=Ze.get(this).definition;r.children=Ze.get(this).base.serializeChildren(Ze.get(this).children);return Ze.get(this).controller.createWorkspace(r,e)}))}}const tt=new WeakMap,rt=e=>tt.get(e).base;class it{constructor(e){tt.set(this,{base:e})}get type(){return"row"}get id(){return rt(this).getId(this)}get frameId(){return rt(this).getFrameId(this)}get workspaceId(){return rt(this).getWorkspaceId(this)}get positionIndex(){return rt(this).getPositionIndex(this)}get children(){return rt(this).getAllChildren(this)}get parent(){return rt(this).getMyParent(this)}get frame(){return rt(this).getMyFrame(this)}get workspace(){return rt(this).getMyWorkspace(this)}addWindow(e){return rt(this).addWindow(this,e,"row")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return rt(this).addParent(this,"group","row",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"column"!==t.type)throw new Error("Expected a column definition, but received "+t.type);return rt(this).addParent(this,"column","row",t)}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as row children is not supported")}))}removeChild(e){return rt(this).removeChild(this,e)}maximize(){return rt(this).maximize(this)}restore(){return rt(this).restore(this)}close(){return rt(this).close(this)}}const nt=new WeakMap,ot=e=>nt.get(e).base;class st{constructor(e){nt.set(this,{base:e})}get type(){return"column"}get id(){return ot(this).getId(this)}get frameId(){return ot(this).getFrameId(this)}get workspaceId(){return ot(this).getWorkspaceId(this)}get positionIndex(){return ot(this).getPositionIndex(this)}get children(){return ot(this).getAllChildren(this)}get parent(){return ot(this).getMyParent(this)}get frame(){return ot(this).getMyFrame(this)}get workspace(){return ot(this).getMyWorkspace(this)}addWindow(e){return ot(this).addWindow(this,e,"column")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return ot(this).addParent(this,"group","column",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as column children is not supported")}))}addRow(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"row"!==t.type)throw new Error("Expected a row definition, but received "+t.type);return ot(this).addParent(this,"row","column",t)}))}removeChild(e){return ot(this).removeChild(this,e)}maximize(){return ot(this).maximize(this)}restore(){return ot(this).restore(this)}close(){return ot(this).close(this)}}const at=new WeakMap,dt=e=>at.get(e).base;class ct{constructor(e){at.set(this,{base:e})}get type(){return"group"}get id(){return dt(this).getId(this)}get frameId(){return dt(this).getFrameId(this)}get workspaceId(){return dt(this).getWorkspaceId(this)}get positionIndex(){return dt(this).getPositionIndex(this)}get children(){return dt(this).getAllChildren(this)}get parent(){return dt(this).getMyParent(this)}get frame(){return dt(this).getMyFrame(this)}get workspace(){return dt(this).getMyWorkspace(this)}addWindow(e){return dt(this).addWindow(this,e,"group")}addGroup(){return e(this,void 0,void 0,(function*(){throw new Error("Adding groups as group child is not supported")}))}addColumn(){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as group child is not supported")}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as group child is not supported")}))}removeChild(e){return dt(this).removeChild(this,e)}maximize(){return dt(this).maximize(this)}restore(){return dt(this).restore(this)}close(){return dt(this).close(this)}}const ut=new WeakMap,lt=e=>ut.get(e).manager.getWorkspaceData(e),ht=e=>ut.get(e).manager;class mt{constructor(e){ut.set(this,{manager:e})}get id(){return lt(this).id}get frameId(){return lt(this).config.frameId}get positionIndex(){return lt(this).config.positionIndex}get title(){return lt(this).config.title}get layoutName(){return lt(this).config.layoutName}get children(){return lt(this).children}get frame(){return lt(this).frame}removeChild(t){return e(this,void 0,void 0,(function*(){z(t);const e=this.children.find(t);e&&(yield e.close(),yield this.refreshReference())}))}remove(t){return e(this,void 0,void 0,(function*(){z(t);const e=lt(this).controller.iterateFindChild(this.children,t);yield e.close(),yield this.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){yield lt(this).controller.focusItem(this.id),yield this.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=lt(this).controller,t=yield lt(this).frame.workspaces();if(1===t.length&&t.every(e=>e.id===this.id))return this.frame.close();yield e.closeItem(this.id)}))}snapshot(){return lt(this).controller.getSnapshot(this.id,"workspace")}saveLayout(t,r){return e(this,void 0,void 0,(function*(){M.runWithException(t),yield lt(this).controller.saveLayout({name:t,workspaceId:this.id,saveContext:null==r?void 0:r.saveContext})}))}setTitle(t){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=lt(this).controller;yield e.setItemTitle(this.id,t),yield this.refreshReference()}))}getContext(){return lt(this).controller.getWorkspaceContext(this.id)}setContext(e){return lt(this).controller.setWorkspaceContext(this.id,e)}updateContext(e){return lt(this).controller.updateWorkspaceContext(this.id,e)}onContextUpdated(e){return lt(this).controller.subscribeWorkspaceContextUpdated(this.id,e)}refreshReference(){return e(this,void 0,void 0,(function*(){const e=yield lt(this).controller.getSnapshot(this.id,"workspace"),t=e.children.reduce((e,t)=>{let r;return r="window"===t.type?this.getWindow(e=>e.id===t.id):this.getBox(e=>e.id===t.id),r&&e.push(r),e},[]),r=lt(this).controller.refreshChildren({existingChildren:t,workspace:this,parent:this,children:e.children}),i=this.frame;let n;if(i.id===e.config.frameId)ht(this).remapFrame(i,e.frameSummary),n=i;else{const t={summary:e.frameSummary};n=lt(this).ioc.getModel("frame",t)}ht(this).remapWorkspace(this,{config:e.config,children:r,frame:n})}))}getBox(e){z(e);const t=lt(this).children;return lt(this).controller.iterateFindChild(t,t=>"window"!==t.type&&e(t))}getAllBoxes(e){z(e,!0);const t=lt(this).children,r=lt(this).controller.iterateFilterChildren(t,e=>"window"!==e.type);return e?r.filter(e):r}getRow(e){return z(e),this.getBox(t=>"row"===t.type&&e(t))}getAllRows(e){return z(e,!0),e?this.getAllBoxes(t=>"row"===t.type&&e(t)):this.getAllBoxes(e=>"row"===e.type)}getColumn(e){return z(e),this.getBox(t=>"column"===t.type&&e(t))}getAllColumns(e){return z(e,!0),e?this.getAllBoxes(t=>"column"===t.type&&e(t)):this.getAllBoxes(e=>"column"===e.type)}getGroup(e){return z(e),this.getBox(t=>"group"===t.type&&e(t))}getAllGroups(e){return z(e,!0),e?this.getAllBoxes(t=>"group"===t.type&&e(t)):this.getAllBoxes(e=>"group"===e.type)}getWindow(e){z(e);const t=lt(this).children;return lt(this).controller.iterateFindChild(t,t=>"window"===t.type&&e(t))}getAllWindows(e){z(e,!0);const t=lt(this).children,r=lt(this).controller.iterateFilterChildren(t,e=>"window"===e.type);return e?r.filter(e):r}addRow(e){return lt(this).base.addParent(this,"row","workspace",e)}addColumn(e){return lt(this).base.addParent(this,"column","workspace",e)}addGroup(e){return lt(this).base.addParent(this,"group","workspace",e)}addWindow(e){return lt(this).base.addWindow(this,e,"workspace")}bundleToRow(){return e(this,void 0,void 0,(function*(){yield lt(this).controller.bundleTo("row",this.id),yield this.refreshReference()}))}bundleToColumn(){return e(this,void 0,void 0,(function*(){yield lt(this).controller.bundleTo("column",this.id),yield this.refreshReference()}))}onClosed(t){return e(this,void 0,void 0,(function*(){z(t);const r=lt(this).id,i={action:"closed",eventType:"workspace",scope:"workspace",scopeId:r,callback:()=>e(this,void 0,void 0,(function*(){t()}))};return yield lt(this).controller.processLocalSubscription(i,r)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){z(t);const r=lt(this).id,i={action:"added",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getBox(e=>e.id===r.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)}))};return yield lt(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const r=lt(this).id,i={action:"removed",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{windowId:e,workspaceId:i,frameId:n}=r.windowSummary.config;t({windowId:e,workspaceId:i,frameId:n})}))};return yield lt(this).controller.processLocalSubscription(i,r)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){z(t);const r=lt(this).id,i={action:"loaded",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getWindow(e=>e.id&&e.id===r.windowSummary.config.windowId);t(e)}))};return yield lt(this).controller.processLocalSubscription(i,r)}))}}const pt=new WeakMap,ft=e=>pt.get(e).manager.getWindowData(e);class wt{constructor(e){pt.set(this,{manager:e})}get id(){return ft(this).config.windowId}get type(){return"window"}get frameId(){return ft(this).frame.id}get workspaceId(){return ft(this).workspace.id}get positionIndex(){return ft(this).config.positionIndex}get isMaximized(){return ft(this).config.isMaximized}get isLoaded(){return ft(this).controller.checkIsWindowLoaded(this.id)}get focused(){return ft(this).config.isFocused}get title(){return ft(this).config.title}get workspace(){return ft(this).workspace}get frame(){return ft(this).frame}get parent(){return ft(this).parent}get appName(){return ft(this).config.appName}forceLoad(){return e(this,void 0,void 0,(function*(){if(this.isLoaded)return;const e=ft(this).controller,t=ft(this).id,r=yield e.forceLoadWindow(t);ft(this).config.windowId=r}))}focus(){return e(this,void 0,void 0,(function*(){const e=ft(this).id,t=ft(this).controller;yield t.focusItem(e)}))}close(){return e(this,void 0,void 0,(function*(){const e=ft(this).id,t=ft(this).controller;yield t.closeItem(e),yield ft(this).parent.removeChild(t=>t.id===e)}))}setTitle(t){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=ft(this).id,r=ft(this).controller;yield r.setItemTitle(e,t)}))}maximize(){return e(this,void 0,void 0,(function*(){const e=ft(this).id,t=ft(this).controller;yield t.maximizeItem(e)}))}restore(){return e(this,void 0,void 0,(function*(){const e=ft(this).id,t=ft(this).controller;yield t.restoreItem(e)}))}eject(){return e(this,void 0,void 0,(function*(){if(!this.isLoaded)throw new Error("Cannot eject this window, because it is not loaded yet");const e=ft(this).id,t=yield ft(this).controller.ejectWindow(e);return ft(this).config.windowId=t,this.getGdWindow()}))}getGdWindow(){if(!this.isLoaded)throw new Error("Cannot fetch this GD window, because the window is not yet loaded");const e=ft(this).config.windowId;return ft(this).controller.getGDWindow(e)}moveTo(t){return e(this,void 0,void 0,(function*(){if(!(t instanceof it||t instanceof st||t instanceof ct))throw new Error("Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group");const e=ft(this).id,r=ft(this).controller;if(!(yield r.getParent(e=>e.id===t.id)))throw new Error("Cannot move the window to the selected parent, because this parent does not exist.");return r.moveWindowTo(e,t.id)}))}onRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const r=ft(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"removed",eventType:"window",scope:"window"};return yield ft(this).controller.processLocalSubscription(i,r)}))}}const gt=new WeakMap,vt=e=>gt.get(e).manager.getFrameData(e);class yt{constructor(e){gt.set(this,{manager:e})}get id(){return vt(this).summary.id}resize(e){const t=Se.runWithException(e),r=vt(this).summary.id;return vt(this).controller.resizeItem(r,t)}move(e){const t=xe.runWithException(e),r=vt(this).summary.id;return vt(this).controller.moveFrame(r,t)}focus(){const e=vt(this).summary.id;return vt(this).controller.focusItem(e)}state(){return e(this,void 0,void 0,(function*(){const e=vt(this).summary.id;return vt(this).controller.getFrameState(e)}))}minimize(){return e(this,void 0,void 0,(function*(){const e=vt(this).summary.id;return vt(this).controller.changeFrameState(e,"minimized")}))}maximize(){return e(this,void 0,void 0,(function*(){const e=vt(this).summary.id;return vt(this).controller.changeFrameState(e,"maximized")}))}restore(){return e(this,void 0,void 0,(function*(){const e=vt(this).summary.id;return vt(this).controller.changeFrameState(e,"normal")}))}close(){const e=vt(this).summary.id;return vt(this).controller.closeItem(e)}snapshot(){const e=vt(this).summary.id;return vt(this).controller.getSnapshot(e,"frame")}workspaces(){return e(this,void 0,void 0,(function*(){return vt(this).controller.getWorkspaces(e=>e.frameId===this.id)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=J.runWithException(r);return vt(this).controller.restoreWorkspace(t,e)}))}createWorkspace(e,t){const r=K.runWithException(e),i=P.runWithException(t);return vt(this).controller.createWorkspace(r,i)}onClosed(t){return e(this,void 0,void 0,(function*(){z(t);const e=vt(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id})},action:"closed",eventType:"frame",scope:"frame"};return yield vt(this).controller.processLocalSubscription(r,e)}))}onMaximized(t){return e(this,void 0,void 0,(function*(){z(t);const e=vt(this).summary.id,r={callback:()=>{t()},action:"maximized",eventType:"frame",scope:"frame"};return yield vt(this).controller.processLocalSubscription(r,e)}))}onMinimized(t){return e(this,void 0,void 0,(function*(){z(t);const e=vt(this).summary.id,r={callback:()=>{t()},action:"minimized",eventType:"frame",scope:"frame"};return yield vt(this).controller.processLocalSubscription(r,e)}))}onNormal(t){return e(this,void 0,void 0,(function*(){z(t);const e=vt(this).summary.id,r={callback:()=>{t()},action:"normal",eventType:"frame",scope:"frame"};return yield vt(this).controller.processLocalSubscription(r,e)}))}onWorkspaceOpened(t){return e(this,void 0,void 0,(function*(){z(t);const r=vt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield vt(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"opened",eventType:"workspace",scope:"frame"};return yield vt(this).controller.processLocalSubscription(i,r)}))}onWorkspaceSelected(t){return e(this,void 0,void 0,(function*(){z(t);const r=vt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield vt(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"selected",eventType:"workspace",scope:"frame"};return yield vt(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosed(t){return e(this,void 0,void 0,(function*(){z(t);const e=vt(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},action:"closed",eventType:"workspace",scope:"frame"};return yield vt(this).controller.processLocalSubscription(r,e)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){z(t);const r=vt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield vt(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"added",eventType:"window",scope:"frame"};return yield vt(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const e=vt(this).summary.id,r={callback:e=>{const{windowId:r,workspaceId:i,frameId:n}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:n})},action:"removed",eventType:"window",scope:"frame"};return yield vt(this).controller.processLocalSubscription(r,e)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){z(t);const r=vt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield vt(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"loaded",eventType:"window",scope:"frame"};return yield vt(this).controller.processLocalSubscription(i,r)}))}}class It{constructor(){this.parentsData=new WeakMap,this.workspacesData=new WeakMap,this.windowsData=new WeakMap,this.framesData=new WeakMap,this.windowPlacementIdData={}}deleteData(e){if(e instanceof wt){const t=Object.keys(this.windowPlacementIdData).find(t=>this.windowPlacementIdData[t]===e);t&&delete this.windowPlacementIdData[t],this.windowsData.delete(e)}e instanceof mt&&this.workspacesData.delete(e),(e instanceof it||e instanceof st||e instanceof ct)&&this.parentsData.delete(e),e instanceof yt&&this.framesData.delete(e)}setWindowData(e,t){this.windowPlacementIdData[t.id]=e,this.windowsData.set(e,t)}setWorkspaceData(e,t){this.workspacesData.set(e,t)}setParentData(e,t){this.parentsData.set(e,t)}setFrameData(e,t){this.framesData.set(e,t)}getWindowData(e){return this.windowsData.get(e)}getWindowByPlacementId(e){return this.windowPlacementIdData[e]}getWorkspaceData(e){return this.workspacesData.get(e)}getParentData(e){return this.parentsData.get(e)}getFrameData(e){return this.framesData.get(e)}remapChild(e,t){if(e instanceof wt){const r=this.windowsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config}if(e instanceof it||e instanceof st||e instanceof ct){const r=this.parentsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config,r.children=t.children||r.children}}remapFrame(e,t){this.framesData.get(e).summary=t}remapWorkspace(e,t){const r=this.workspacesData.get(e);r.frame=t.frame||r.frame,r.config=t.config||r.config,r.children=t.children||r.children}}const bt=new WeakMap,kt=(e,t)=>{const r=bt.get(e).manager;return t instanceof mt?r.getWorkspaceData(t):bt.get(e).manager.getParentData(t)},Wt=(e,t)=>bt.get(e).manager.getWindowByPlacementId(t);class St{constructor(e){bt.set(this,{manager:e})}getId(e){return kt(this,e).id}getPositionIndex(e){return kt(this,e).config.positionIndex}getWorkspaceId(e){const t=kt(this,e);return t.config.workspaceId||t.workspace.id}getFrameId(e){return kt(this,e).frame.id}getAllChildren(e,t){z(t,!0);const r=kt(this,e).children;return void 0===t?r:r.filter(t)}getMyParent(e){if(!(e instanceof mt))return kt(this,e).parent}getMyFrame(e){return kt(this,e).frame}getMyWorkspace(e){if(!(e instanceof mt))return kt(this,e).workspace}addWindow(t,r,i){return e(this,void 0,void 0,(function*(){if(!r.appName&&!r.windowId)throw new Error("The window definition should contain either an appName or a windowId");const e=_.runWithException(r),n=kt(this,t).controller,o=yield n.add("window",kt(this,t).id,i,e);return t instanceof mt?(yield t.refreshReference(),Wt(this,o.itemId)):(yield this.getMyWorkspace(t).refreshReference(),Wt(this,o.itemId))}))}addParent(t,r,i,n){return e(this,void 0,void 0,(function*(){const e=this.transformDefinition(r,n),o=kt(this,t).controller,s=(yield o.add("container",kt(this,t).id,i,e)).itemId;if(t instanceof mt)return yield t.refreshReference(),t.getBox(e=>e.id===s);const a=this.getMyWorkspace(t);return yield a.refreshReference(),a.getBox(e=>e.id===s)}))}removeChild(t,r){return e(this,void 0,void 0,(function*(){z(r);const e=this.getAllChildren(t).find(r);e&&(yield e.close(),t instanceof mt?yield t.refreshReference():yield this.getMyWorkspace(t).refreshReference())}))}maximize(t){return e(this,void 0,void 0,(function*(){const e=kt(this,t).controller;yield e.maximizeItem(kt(this,t).id)}))}restore(t){return e(this,void 0,void 0,(function*(){const e=kt(this,t).controller;yield e.restoreItem(kt(this,t).id)}))}close(t){return e(this,void 0,void 0,(function*(){const e=kt(this,t),r=kt(this,t).controller;yield r.closeItem(e.id),e.parent instanceof mt?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}transformDefinition(e,t){let r;return void 0===t?r={type:e,children:[]}:t instanceof Xe?r=t.serialize():(void 0===t.type&&(t.type=e),r=$.runWithException(t),r.children=r.children||[]),r}}class xt{constructor(e,t,r,i){this.bridge=e,this.frameUtils=t,this.layouts=r,this.base=i}checkIsWindowLoaded(e){return this.base.checkIsWindowLoaded(e)}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getAllFrameInstances();if(!e.length)return!1;return(yield Promise.all(e.map(e=>this.bridge.send(Je.isWindowInWorkspace.name,{itemId:t},e)))).some(e=>e.inWorkspace)}))}createWorkspace(t,r){var i,n;return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r}),o={frameId:null===(i=t.frame)||void 0===i?void 0:i.reuseFrameId,newFrame:null===(n=t.frame)||void 0===n?void 0:n.newFrame},s=yield this.frameUtils.getFrameInstance(o),a=yield this.base.createWorkspace(e,s);return yield this.frameUtils.focusFrame(s),a}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);const e=yield this.frameUtils.getFrameInstance({frameId:null==r?void 0:r.frameId,newFrame:null==r?void 0:r.newFrame}),i=yield this.base.restoreWorkspace(t,r,e);return yield this.frameUtils.focusFrame(e),i}))}add(t,r,i,n){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(r);return yield this.base.add(t,r,i,n,e)}))}processLocalSubscription(t,r){return e(this,void 0,void 0,(function*(){if(yield this.bridge.createCoreEventMethod(),t.scopeId=t.scopeId||r,"window"===t.eventType&&"loaded"===t.action){const r=t.callback,i=t=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(t.windowSummary.config.windowId),r(t)}));t.callback=i}return this.bridge.handleCoreSubscription(t)}))}processGlobalSubscription(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.createCoreEventMethod();const n={eventType:r,callback:t,action:i,scope:"global"};if("window"===r&&"loaded"===i){const r=r=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(r.windowSummary.config.windowId),t(r)}));n.callback=r}return this.bridge.handleCoreSubscription(n)}))}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId){const e=yield this.frameUtils.getFrameInstanceByItemId(t.windowId);return yield this.base.getFrame(t.windowId,e)}if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getAllFrameInstances(),r=[];for(const t of e)try{const e=yield this.bridge.send(Je.getFrameSummary.name,{itemId:t.peerId},t);r.push(e)}catch(e){continue}return this.base.getFrames(r,t)}))}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getAllFrameInstances(),t=yield Promise.all(e.map(e=>this.bridge.send(Je.getAllWorkspacesSummaries.name,{},e)));return this.base.getAllWorkspaceSummaries(...t)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getWindow(t);n&&(e=n,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getBox(t);n&&(e=n,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.layouts.getAll("Workspace")).map(e=>({name:e.name}))}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.layouts.remove("Workspace",t)}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.layouts.export("Workspace")).reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}importLayout(t){return e(this,void 0,void 0,(function*(){yield this.layouts.import(t)}))}saveLayout(t){return e(this,void 0,void 0,(function*(){if(!(yield this.frameUtils.getAllFrameInstances()).length)throw new Error(`Cannot save the layout with config: ${JSON.stringify(t)}, because no active frames were found`);const e=yield this.frameUtils.getFrameInstanceByItemId(t.workspaceId);return yield this.bridge.send(Je.saveLayout.name,t,e)}))}handleOnSaved(e){return this.base.handleOnSaved(e)}handleOnRemoved(e){return this.base.handleOnRemoved(e)}bundleTo(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(r);return yield this.base.bundleTo(t,r,e)}))}getWorkspaceContext(e){return this.base.getWorkspaceContext(e)}setWorkspaceContext(e,t){return this.base.setWorkspaceContext(e,t)}updateWorkspaceContext(e,t){return this.base.updateWorkspaceContext(e,t)}subscribeWorkspaceContextUpdated(e,t){return this.base.subscribeWorkspaceContextUpdated(e,t)}restoreItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.restoreItem(t,e)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.maximizeItem(t,e)}))}focusItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.focusItem(t,e)}))}changeFrameState(){throw new Error("Changing the frame state is not supported in Glue42 Core")}getFrameState(){return e(this,void 0,void 0,(function*(){throw new Error("Frame state is not supported in Glue42 Core")}))}closeItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return t===e.peerId?this.frameUtils.closeFrame(e):this.base.closeItem(t,e)}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.resizeItem(t,r,e),yield this.frameUtils.resizeFrame(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.moveFrame(t,r,e),yield this.frameUtils.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t),r=yield this.base.forceLoadWindow(t,e);return yield this.base.notifyWindowAdded(r),r}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t),r=(yield this.base.ejectWindow(t,e)).windowId;return yield this.base.notifyWindowAdded(r),r}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.moveWindowTo(t,r,e)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.getSnapshot(t,r,e)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.setItemTitle(t,r,e)}))}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const n of i){if(e)return;const i=yield this.frameUtils.getFrameInstance({frameId:n.frameId}),o=yield this.base.fetchWorkspace(n.id,i);t(o,r)}}))}}class Ct{constructor(e,t,r,i){this.interop=e,this.windows=t,this.bridge=r,this.assetsBaseLocation=i,this.workspacesIndex="/workspaces/",this.defaultAssetsBase="/glue",this.defaultWidth=1280,this.defaultHeight=720;const n=location.href.includes("csb.app")?"/index.html":"";this.workspacesRoute=`${this.assetsBaseLocation||this.defaultAssetsBase}${this.workspacesIndex}${n}`}getAllFrameInstances(){return e(this,void 0,void 0,(function*(){const e=this.interop.servers().filter(e=>{var t;if(null==e?void 0:e.getMethods)return null===(t=e.getMethods())||void 0===t?void 0:t.some(e=>e.name===Ge.control.name)}),t=[];for(const r of e)try{(yield qe(()=>this.bridge.send(Je.ping.name,void 0,r),3e3)).live&&t.push(r)}catch(e){continue}return t}))}focusFrame(t){return e(this,void 0,void 0,(function*(){const e=this.windows.list().find(e=>e.id===t.windowId);yield e.focus()}))}getFrameInstance(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.frameId)&&(null==t?void 0:t.newFrame))throw new Error("Cannot retrieve the frame, because of over-specification: both frameId and newFrame were provided.");const e=yield this.getAllFrameInstances();if(null==t?void 0:t.frameId){const r=e.find(e=>e.peerId===t.frameId);if(!r)throw new Error(`Frame with id: ${t.frameId} was not found`);return r}return(null==t?void 0:t.newFrame)?this.openNewWorkspacesFrame(t.newFrame):e.length?this.getLastFrameInteropInstance():this.openNewWorkspacesFrame()}))}getFrameInstanceByItemId(t){return e(this,void 0,void 0,(function*(){const e=yield this.getAllFrameInstances();if(!e.length)throw new Error(`Cannot get frame by item id for: ${t}, because not frames were found`);const r=(yield Promise.all(e.map(e=>this.bridge.send(Je.getFrameSummary.name,{itemId:t},e)))).find(e=>"none"!==e.id);if(!r)throw new Error("Cannot find frame for item: "+t);return yield this.getFrameInstance({frameId:r.id})}))}getLastFrameInteropInstance(){return e(this,void 0,void 0,(function*(){return(yield this.getAllFrameInstances()).sort((e,t)=>{const r=(null==e?void 0:e.peerId)?+e.peerId.slice(e.peerId.lastIndexOf("-")+1):0;return((null==t?void 0:t.peerId)?+t.peerId.slice(t.peerId.lastIndexOf("-")+1):0)-r})[0]}))}openNewWorkspacesFrame(e){return new Promise((t,r)=>{var i,n;const o=100*Math.random()+0;let s;const a=this.interop.serverMethodAdded(e=>{if(!(null==e?void 0:e.server)||!(null==e?void 0:e.method))return;const r=e.method.name===Ge.control.name,i=e.server.windowId===(null==s?void 0:s.id);(null==s?void 0:s.id)&&r&&i&&(a(),t(e.server))}),d={url:this.workspacesRoute+"?emptyFrame=true",width:"object"==typeof e&&(null===(i=e.bounds)||void 0===i?void 0:i.width)||this.defaultWidth,height:"object"==typeof e&&(null===(n=e.bounds)||void 0===n?void 0:n.height)||this.defaultHeight};this.windows.open("frame_"+(o+1),d.url,d).then(e=>{s=e;const r=this.interop.servers().find(e=>{const t=e.windowId===s.id,r=e.getMethods().some(e=>e.name===Ge.control.name);return t&&r});r&&(a(),t(r))}).catch(r)})}closeFrame(t){return e(this,void 0,void 0,(function*(){const e=this.windows.list().find(e=>e.id===t.windowId);yield e.close()}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.getFrameInstanceByItemId(t);if(t!==e.peerId)return;const i=this.windows.list().find(t=>t.id===e.windowId);r.relative?yield i.moveTo(r.top,r.left):yield i.moveResize({top:r.top,left:r.left})}))}resizeFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.getFrameInstanceByItemId(t);if(t!==e.peerId)return;const i=this.windows.list().find(t=>t.id===e.windowId);r.relative?yield i.resizeTo(r.width,r.height):yield i.moveResize({width:r.width,height:r.height})}))}}class Ft{constructor(e,t,r,i){this.ioc=e,this.windows=t,this.contexts=r,this.layouts=i}get bridge(){return this.ioc.bridge}get privateDataManager(){return this.ioc.privateDataManager}checkIsWindowLoaded(e){return e&&this.windows.list().some(t=>t.id===e)}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Je.createWorkspace.name,t,r),i={summary:e.frameSummary},n={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",n)}))}restoreWorkspace(t,r,i){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Je.openWorkspace.name,{name:t,restoreOptions:r},i),n={summary:yield this.bridge.send(Je.getFrameSummary.name,{itemId:e.config.frameId},i)},o={frame:this.ioc.getModel("frame",n),snapshot:e};return this.ioc.getModel("workspace",o)}))}add(t,r,i,n,o){return e(this,void 0,void 0,(function*(){let e;const s={definition:n,parentId:r,parentType:i};if("window"===t)e=Je.addWindow.name;else{if("container"!==t)throw new Error("Unrecognized add type: "+t);e=Je.addContainer.name}return yield this.bridge.send(e,s,o)}))}getFrame(t,r){return e(this,void 0,void 0,(function*(){const e={summary:yield this.bridge.send(Je.getFrameSummary.name,{itemId:t},r)};return this.ioc.getModel("frame",e)}))}getFrames(e,t){return e.reduce((e,r)=>{const i={summary:r},n=this.ioc.getModel("frame",i);return t&&!t(n)||e.push(n),e},[])}getAllWorkspaceSummaries(...e){return e.reduce((e,t)=>(e.push(...t.summaries),e),[]).map(e=>({id:e.id,frameId:e.config.frameId,positionIndex:e.config.positionIndex,title:e.config.title,layoutName:e.config.layoutName}))}handleOnSaved(e){const t=t=>{"Workspace"===t.type&&e(t)},r=this.layouts.onAdded(t),i=this.layouts.onChanged(t);return()=>{r(),i()}}handleOnRemoved(e){return this.layouts.onRemoved(t=>{"Workspace"===t.type&&e(t)})}fetchWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Je.getWorkspaceSnapshot.name,{itemId:t},r),i={summary:e.frameSummary},n={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",n)}))}bundleTo(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.bundleWorkspace.name,{type:t,workspaceId:r},i)}))}getWorkspaceContext(e){const t="___workspace___"+e;return this.contexts.get(t)}setWorkspaceContext(e,t){const r="___workspace___"+e;return this.contexts.set(r,t)}updateWorkspaceContext(e,t){const r="___workspace___"+e;return this.contexts.update(r,t)}subscribeWorkspaceContextUpdated(e,t){const r="___workspace___"+e;return this.contexts.subscribe(r,t)}restoreItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.restoreItem.name,{itemId:t},r)}))}maximizeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.maximizeItem.name,{itemId:t},r)}))}focusItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.focusItem.name,{itemId:t},r)}))}closeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.closeItem.name,{itemId:t},r)}))}resizeItem(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.resizeItem.name,Object.assign({},{itemId:t},r),i)}))}moveFrame(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.moveFrame.name,Object.assign({},{itemId:t},r),i)}))}getGDWindow(e){return this.windows.list().find(t=>t.id===e)}forceLoadWindow(t,r){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Je.forceLoadWindow.name,{itemId:t},r)).windowId}))}ejectWindow(t,r){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(Je.ejectWindow.name,{itemId:t},r)}))}moveWindowTo(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.moveWindowTo.name,{itemId:t,containerId:r},i)}))}getSnapshot(t,r,i){return e(this,void 0,void 0,(function*(){let e;return"workspace"===r?e=yield this.bridge.send(Je.getWorkspaceSnapshot.name,{itemId:t},i):"frame"===r&&(e=yield this.bridge.send(Je.getFrameSnapshot.name,{itemId:t},i)),e}))}setItemTitle(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Je.setItemTitle.name,{itemId:t,title:r},i)}))}refreshChildren(e){const{parent:t,children:r,existingChildren:i,workspace:n}=e;if(t instanceof wt)return;const o=r.map(e=>{let r=i.find(t=>t.id===e.id);const o=e.type;if(r)this.privateDataManager.remapChild(r,{parent:t,children:[],config:e.config});else if("window"===o){const i={id:e.id,parent:t,frame:n.frame,workspace:n,config:e.config};r=this.ioc.getModel(o,i)}else{const i={id:e.id,children:[],parent:t,frame:n.frame,workspace:n,config:e.config};r=this.ioc.getModel(o,i)}return"window"!==o&&this.refreshChildren({workspace:n,existingChildren:i,children:e.children,parent:r}),r});return t instanceof mt||this.privateDataManager.remapChild(t,{children:o}),o}iterateFindChild(e,t){let r=e.find(e=>t(e));return r||(e.some(e=>!(e instanceof wt)&&(r=this.iterateFindChild(e.children,t),!!r||void 0)),r)}iterateFilterChildren(e,t){const r=e.filter(e=>t(e)),i=e.reduce((e,r)=>(r instanceof wt||e.push(...this.iterateFilterChildren(r.children,t)),e),[]);return r.push(...i),r}notifyWindowAdded(e){return new Promise(t=>{if(this.windows.list().some(t=>t.id===e))return t();const r=this.windows.onWindowAdded(i=>{i.id===e&&(r&&r(),t())})})}}class Dt{constructor(e,t,r,i,n){this.agm=e,this.windows=t,this.layouts=r,this.contexts=i,this.assetsBaseLocation=n}get baseController(){return this._baseController||(this._baseController=new Ft(this,this.windows,this.contexts,this.layouts)),this._baseController}get controller(){return this._controllerInstance||(this._controllerInstance=window.glue42gd?new He(this.bridge,this.baseController):new xt(this.bridge,new Ct(this.agm,this.windows,this.bridge,this.assetsBaseLocation),this.layouts,this.baseController)),this._controllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new Ke(this.transport,r())),this._bridgeInstance}get transport(){return this._transportInstance||(this._transportInstance=new Qe(this.agm)),this._transportInstance}get privateDataManager(){return this._privateDataManagerInstance||(this._privateDataManagerInstance=new It),this._privateDataManagerInstance}get parentBase(){return this._parentBaseInstance||(this._parentBaseInstance=new St(this.privateDataManager)),this._parentBaseInstance}initiate(){return e(this,void 0,void 0,(function*(){yield this.transport.initiate()}))}getModel(e,t){switch(e){case"frame":{const e=new yt(this.privateDataManager),{summary:r}=t,i={summary:r,controller:this.controller};return this.privateDataManager.setFrameData(e,i),e}case"window":{const{id:e,parent:r,frame:i,workspace:n,config:o}=t,s={type:"window",controller:this.controller,config:o,id:e,parent:r,frame:i,workspace:n},a=new wt(this.privateDataManager);return this.privateDataManager.setWindowData(a,s),a}case"row":case"column":case"group":{const{id:r,children:i,parent:n,frame:o,workspace:s,config:a}=t,d="column"===e?new st(this.parentBase):"row"===e?new it(this.parentBase):new ct(this.parentBase),c=this.buildChildren(i,o,s,d),u={id:r,parent:n,frame:o,workspace:s,config:a,type:e,controller:this.controller,children:c};return this.privateDataManager.setParentData(d,u),d}case"workspace":{const{snapshot:e,frame:r}=t,i=new mt(this.privateDataManager),n=this.buildChildren(e.children,r,i,i),o={id:e.id,type:"workspace",config:e.config,base:this.parentBase,controller:this.controller,children:n,frame:r,ioc:this};return this.privateDataManager.setWorkspaceData(i,o),i}default:throw new Error("Unrecognized type: "+e)}}getBuilder(e){e.definition=e.definition||{},Array.isArray(e.definition.children)||(e.definition.children=[]);const t=new Ye(this.getBuilder.bind(this));switch(e.type){case"workspace":return new et(e.definition,t,this.controller);case"row":case"column":case"group":return e.definition.type=e.type,new Xe(e.definition,t);default:throw new Error("Unexpected Builder creation error, provided config: "+JSON.stringify(e))}}buildChildren(e,t,r,i){return e.map(e=>{switch(e.type){case"window":return this.getModel("window",{id:e.id,config:e.config,frame:t,workspace:r,parent:i});case"column":case"row":case"group":return this.getModel(e.type,{id:e.id,config:e.config,children:e.children,frame:t,workspace:r,parent:i});default:throw new Error("Unsupported child type: "+e.type)}})}}const Et=(t,r)=>e(void 0,void 0,void 0,(function*(){var i;const n=new Dt(t.agm,t.windows,t.layouts,t.contexts,null===(i=null==r?void 0:r.assets)||void 0===i?void 0:i.location);yield n.initiate(),t.workspaces=((t,r)=>{const i=r.controller;return{inWorkspace:()=>{const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");return i.checkIsInSwimlane(e)},getBuilder:e=>{const t=q.runWithException(e);return r.getBuilder(t)},getMyFrame:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your frame, because this window is not in a workspace");return i.getFrame({windowId:e})})),getFrame:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getFrame({predicate:t})})),getAllFrames:t=>e(void 0,void 0,void 0,(function*(){return z(t,!0),i.getFrames(t)})),getAllWorkspacesSummaries:()=>i.getAllWorkspaceSummaries(),getMyWorkspace:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my workspace, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your workspace, because this window is not in a workspace");return(yield i.getWorkspaces(t=>!!t.getWindow(t=>t.id===e)))[0]})),getWorkspace:t=>e(void 0,void 0,void 0,(function*(){return z(t),(yield i.getWorkspaces(t))[0]})),getAllWorkspaces:e=>(z(e,!0),i.getWorkspaces(e)),getWindow:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getWindow(t)})),getBox:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getParent(t)})),restoreWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){M.runWithException(t);const e=J.runWithException(r);return i.restoreWorkspace(t,e)})),createWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){const e=K.runWithException(t),n=P.runWithException(r);return i.createWorkspace(e,n)})),layouts:{getSummaries:()=>i.getLayoutSummaries(),delete:t=>e(void 0,void 0,void 0,(function*(){return M.runWithException(t),i.deleteLayout(t)})),export:t=>e(void 0,void 0,void 0,(function*(){return z(t,!0),i.exportLayout(t)})),import:t=>e(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))throw new Error("The provided layouts argument is not an array: "+JSON.stringify(t));return t.forEach(e=>he.runWithException(e)),i.importLayout(t)})),save:t=>e(void 0,void 0,void 0,(function*(){const e=$e.runWithException(t);return i.saveLayout(e)})),onSaved:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.handleOnSaved(t)})),onRemoved:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.handleOnRemoved(t)}))},onFrameOpened:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","opened")})),onFrameClosed:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id})},"frame","closed")})),onWorkspaceOpened:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","opened")})),onWorkspaceClosed:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},"workspace","closed")})),onWindowAdded:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getBox(e=>e.id===n.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===n.windowSummary.config.positionIndex);t(a)})),"window","added")})),onWindowLoaded:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===n.windowSummary.config.windowId);t(a)})),"window","loaded")})),onWindowRemoved:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{const{windowId:r,workspaceId:i,frameId:n}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:n})},"window","removed")}))}})(t,n)}));return"undefined"!=typeof window&&(window.GlueWorkspaces=Et),Et}));
//# sourceMappingURL=workspaces.umd.min.js.map
